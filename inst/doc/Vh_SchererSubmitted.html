<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Meredith N. Scherer, Katie Paul-Friedman, and John F. Wambaugh" />

<meta name="date" content="2025-07-23" />

<title>Characterizing Accuracy of Model Predictions for Concentration in High Throughput Screening Assays</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Characterizing Accuracy of Model
Predictions for Concentration in High Throughput Screening Assays</h1>
<h4 class="author">Meredith N. Scherer, Katie Paul-Friedman, and John F.
Wambaugh</h4>
<h4 class="date">2025-07-23</h4>



<p><em>Please send questions to <a href="mailto:wambaugh.john@epa.gov" class="email">wambaugh.john@epa.gov</a></em></p>
<p>from “Characterizing Accuracy of Model Predictions for Concentration
in High Throughput Screening Assays”</p>
<p>Meredith Scherer, Madison Feshuk, James M. Armitage, Jon A. Arnot,
David Crizer, Michael Devito, Stephen S. Ferguson, Kimberly Freeman,
Josh Harrill, Nynke Kramer, Alessandro Sangion, Caroline Stevens,<br />
Katie Paul Friedman, John F. Wambaugh</p>
<div id="update-wpaper-info-link-to-cleared-dataset" class="section level3">
<h3>update w/paper info + link to cleared dataset</h3>
</div>
<div id="abstract" class="section level2">
<h2>Abstract</h2>
<p>The aim of toxicological in vitro - in vivo extrapolation (IVIVE) is
to predict whole animal effects from perturbations observed in vitro.
Reliance on nominal (administered) concentration does not account for
chemical distribution to cellular and non-cellular elements of the in
vitro assay system. This chemical distribution reduces the free
concentration available to cause effects and can result in an inaccurate
estimate of the intracellular concentration causing any observed
perturbations. There are mathematical, chemical property-based
partitioning models for predicting cellular concentrations when not
measured experimentally. This work evaluated two of these in vitro
disposition models: Armitage et al., 2014 and Kramer et al., 2010 using
a total of 153 experimental intracellular concentration measurements of
43 chemicals, along with parameters describing measurement conditions,
from 12 peer reviewed studies in addition to data generated for this
study. Intracellular concentrations were more accurately predicted by
both the Armitage model (root mean squared log10 error (RMSLE) = 1.12)
and the Kramer model (RMSLE = 1.30) than by the nominal concentration
(RMSLE = 1.45). Although limited by the amount of available measurement
data, these results indicate that mathematical modeling of in vitro
distribution can improve the accuracy of IVIVE.</p>
</div>
<div id="httk-version" class="section level2">
<h2>HTTK Version</h2>
<p>This vignette was created with <strong>httk</strong> v2.X.0. Although
we attempt to maintain backward compatibility, if you encounter issues
with the latest release of <strong>httk</strong> and cannot easily
address the changes, historical versions of httk are available from: <a href="https://cran.r-project.org/src/contrib/Archive/httk/" class="uri">https://cran.r-project.org/src/contrib/Archive/httk/</a></p>
</div>
<div id="prepare-for-session" class="section level2">
<h2>Prepare for session</h2>
<p>R package <strong>knitr</strong> generates html and PDF documents
from this RMarkdown file, Each bit of code that follows is known as a
“chunk”. We start by telling <strong>knitr</strong> how we want our
chunks to look.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">collapse =</span> <span class="cn">TRUE</span>, <span class="at">comment =</span> <span class="st">&#39;#&gt;&#39;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">rmarkdown.html_vignette.check_title =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="clear-the-memory" class="section level3">
<h3>Clear the memory</h3>
<p>It is a bad idea to let variables and other information from previous
R sessions float around, so we first remove everything in the R
memory.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) </span></code></pre></div>
</div>
<div id="eval-execute.vignette" class="section level3">
<h3>eval = execute.vignette</h3>
<p>If you are using the RMarkdown version of this vignette (extension,
.RMD) you will be able to see that several chunks of code in this
vignette have the statement “eval = execute.vignette”. The next chunk of
code, by default, sets execute.vignette = FALSE. This means that the
code is included (and necessary) but was not run when the vignette was
built. We do this because some steps require extensive computing time
and the checks on CRAN limit how long we can spend building the package.
If you want this vignette to work, you must run all code, either by
cutting and pasting it into R. Or, if viewing the .RMD file, you can
either change execute.vignette to TRUE or press “play” (the green arrow)
on each chunk in RStudio.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set whether or not the following chunks will be executed (run):</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>execute.vignette <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
</div>
<div id="load-the-relevant-libraries" class="section level3">
<h3>Load the relevant libraries</h3>
<p>We use the command ‘library()’ to load various R packages for our
analysis. If you get the message “Error in library(X) : there is no
package called ‘X’” then you will need to install that package:</p>
<p>From the R command prompt:</p>
<p>install.packages(“X”)</p>
<p>Or, if using RStudio, look for ‘Install Packages’ under ‘Tools’
tab.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httk)        <span class="co"># run Armitage.R in vitro distribution model</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># data wrangling</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)  <span class="co"># data table functionality</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)     <span class="co"># plotting</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)     <span class="co"># jitter labels in plots</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)      <span class="co"># arrange plots for publication</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)     <span class="co"># colorblind palette</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)      <span class="co"># required for label_log</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#save figures and tables to working directory: yes/no</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>save_output <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#for saving outputs</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>data.date <span class="ot">&lt;-</span> <span class="st">&quot;16JUL2025&quot;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>path_out <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/mscherer/OneDrive - Environmental Protection Agency (EPA)</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="st">/Profile/Desktop/IVDManuscriptData/manuscript figures 16JUL25/&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#function to calculate RMSLE</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>sle <span class="ot">&lt;-</span> <span class="cf">function</span> (actual, predicted) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    log.act <span class="ot">&lt;-</span> <span class="fu">log10</span>(actual)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    log.pred <span class="ot">&lt;-</span> <span class="fu">log10</span>(predicted)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    good <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(log.act) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(log.act) <span class="sc">&amp;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(log.pred) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(log.pred)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    log.act <span class="ot">&lt;-</span> log.act[good]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    log.pred <span class="ot">&lt;-</span> log.pred[good]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((log.act <span class="sc">-</span> log.pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>msle <span class="ot">&lt;-</span> <span class="cf">function</span> (actual, predicted) </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">sle</span>(actual, predicted))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>rmsle <span class="ot">&lt;-</span><span class="cf">function</span> (actual, predicted) </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">msle</span>(actual, predicted))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="data-collection" class="section level1">
<h1>Data Collection</h1>
<p>Data sets were curated from the literature and combined with two in
house experiments to evaluate the in vitro distribution models.</p>
</div>
<div id="load-and-format-the-data" class="section level1">
<h1>Load and format the data</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>IVD_Manuscript_data <span class="ot">&lt;-</span> httk<span class="sc">::</span>Scherer2025.IVD</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Summarized data from &quot;</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">length</span>(<span class="fu">unique</span>(IVD_Manuscript_data<span class="sc">$</span>Citation)),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot; studies covering &quot;</span>, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">length</span>(<span class="fu">unique</span>(IVD_Manuscript_data<span class="sc">$</span>ChemicalName)),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot; unique chemicals &quot;</span>, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;with &quot;</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">length</span>(IVD_Manuscript_data<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot; observations total.&quot;</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#14 studies, 43 chemicals, 153 observations</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#number each row</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>IVD_Manuscript_data[,X<span class="sc">:</span><span class="er">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(IVD_Manuscript_data<span class="sc">$</span>ChemicalName)]</span></code></pre></div>
<p>#In vitro assay descriptors (optional step) In vitro assay
descriptors for the measurements in Supplemental Materials Table S2 were
added as additional assays into httk:invitro.assay.params using the AENM
“IVD” + Author + Year (that is, Smith et al. (2000) would be AENM
“IVDSmith2000”.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Create assay_component_endpoint_name columns for assay parameters </span><span class="al">###</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create assay_name column</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>IVD_Manuscript_data[, assay_name <span class="sc">:</span><span class="er">=</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">gsub</span>(<span class="st">&quot;, &quot;</span>, <span class="st">&quot;&quot;</span>, IVD_Manuscript_data<span class="sc">$</span>Citation)]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#create the assay_component_endpoint_name column</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>IVD_Manuscript_data[, assay_component_endpoint_name <span class="sc">:</span><span class="er">=</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">paste</span>(<span class="st">&quot;IVD&quot;</span>, <span class="fu">gsub</span>(<span class="st">&quot;, &quot;</span>, <span class="st">&quot;&quot;</span>, assay_name), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#tack on the &quot;interesting&quot; part for each assay to create the endpoint_name </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>IVD_Manuscript_data[assay_component_endpoint_name<span class="sc">==</span><span class="st">&quot;IVDBellwon2015b&quot;</span> <span class="sc">|</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                      assay_component_endpoint_name <span class="sc">==</span> <span class="st">&quot;IVDBroeders2013&quot;</span> <span class="sc">|</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                      assay_component_endpoint_name <span class="sc">==</span> <span class="st">&quot;IVDWei2010&quot;</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                    assay_component_endpoint_name <span class="sc">:</span><span class="er">=</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">paste</span>(assay_component_endpoint_name, CellType, <span class="at">sep=</span><span class="st">&quot;_&quot;</span>)]</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#these two have multiple concentrations or time points</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>IVD_Manuscript_data[assay_component_endpoint_name<span class="sc">==</span><span class="st">&quot;IVDMundy2004&quot;</span> <span class="sc">|</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                      assay_component_endpoint_name<span class="sc">==</span><span class="st">&quot;IVDLundquist2014&quot;</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                assay_component_endpoint_name <span class="sc">:</span><span class="er">=</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste</span>(<span class="fu">paste</span>(assay_component_endpoint_name, </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">paste</span>(ExposureDuration_hrs, <span class="st">&quot;hr&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>), </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sep=</span><span class="st">&quot;_&quot;</span>), <span class="fu">paste</span>(FBSf, <span class="st">&quot;FBSf&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>), </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)]</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#create a copy with the assay parameters for the options table (Table S7)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>options.IVD_Manuscript_data<span class="ot">&lt;-</span><span class="fu">copy</span>(IVD_Manuscript_data)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="do">### Pull in httk assay parameter table </span><span class="al">###</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>invitro.assay.params <span class="ot">&lt;-</span> <span class="fu">copy</span>(invitro.assay.params)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#copy the experimental data frame to pull out the parameter lines</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>parameters_only<span class="ot">&lt;-</span><span class="fu">copy</span>(IVD_Manuscript_data)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="do">### Set up assay parameters to match with invitro.assay.params.RData </span><span class="al">###</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#rename columns to align with the names in invitro.assay.params.RData</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>parameters_only[, timepoint_hr <span class="sc">:</span><span class="er">=</span> ExposureDuration_hrs] <span class="sc">%&gt;%</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  .[, media_serum <span class="sc">:</span><span class="er">=</span> SerumType] <span class="sc">%&gt;%</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  .[, cell_type <span class="sc">:</span><span class="er">=</span> CellType] </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co"># get the list of columns we need</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>ivpnames<span class="ot">&lt;-</span><span class="fu">names</span>(invitro.assay.params)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">#add on the extra columns to match invitro.assay.params and parameters_only</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(ivpnames<span class="sc">%in%</span><span class="fu">names</span>(parameters_only))){</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    parameters_only[,ivpnames[<span class="sc">!</span>(ivpnames <span class="sc">%in%</span> <span class="fu">names</span>(parameters_only))]] <span class="ot">&lt;-</span> </span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.double</span>(<span class="cn">NA</span>)}</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">#filter parameters_only to match up with ivpnames and only the unique rows</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>parameters_only<span class="ot">&lt;-</span>parameters_only <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">as.character</span>(ivpnames)) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co"># reassign own parameters table to pass to armitage and kramer functions</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>user_assay_parameters<span class="ot">&lt;-</span>parameters_only</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co"># should have 29 + 1649 = 1678 rows</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co">#remove parameter columns since we will be pulling from &quot;user_assay_parameters&quot;</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>ivpnames[<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span> <span class="co">#remove endpoint_name bc we need to be able to reference it</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>IVD_Manuscript_data[,ivpnames[(ivpnames <span class="sc">%in%</span> <span class="fu">names</span>(IVD_Manuscript_data))]]<span class="ot">&lt;-</span> </span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code></pre></div>
</div>
<div id="run-the-in-vitro-distribution-models" class="section level1">
<h1>Run the in vitro distribution models</h1>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># run Armitage model, output concentrations in umol/L (e.g. uM)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>armitageOutput_data.dt <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>IVD_Manuscript_data,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">user_assay_parameters =</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                                         user_assay_parameters,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">restrict.ion.partitioning =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># run Kramer model, output concentrations in umol/L (e.g. uM)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>kramerOutput_data.dt <span class="ot">&lt;-</span> <span class="fu">kramer_eval</span>(<span class="at">tcdata=</span>IVD_Manuscript_data, </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">user_assay_parameters =</span> </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                                      user_assay_parameters,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">restrict.ion.partitioning =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="manipulate-data-and-prep-for-plotting" class="section level1">
<h1>Manipulate data and prep for plotting</h1>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#delete nomconc column</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>Armitage.dt<span class="ot">&lt;-</span><span class="fu">subset</span>(armitageOutput_data.dt, <span class="at">select=</span><span class="sc">-</span><span class="fu">c</span>(nomconc))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#pull ioc types from armitage since kramer doesn&#39;t generate them</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>IOC_Type_output<span class="ot">&lt;-</span>Armitage.dt[,.(ChemicalName, IOC_Type)] <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#delete nomconc column and add in the IOC type column for Kramer</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>Kramer.dt_subset<span class="ot">&lt;-</span><span class="fu">subset</span>(kramerOutput_data.dt, <span class="at">select=</span><span class="sc">-</span><span class="fu">c</span>(nomconc))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>Kramer.dt<span class="ot">&lt;-</span>Kramer.dt_subset[IOC_Type_output, on <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#delete cellconc column and add in the IOC type column for Nominal</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>Nominal.dt_subset<span class="ot">&lt;-</span><span class="fu">subset</span>(kramerOutput_data.dt, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(concentration_cells))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>Nominal.dt<span class="ot">&lt;-</span>Nominal.dt_subset[IOC_Type_output, on <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#add tags</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>Armitage.dt[,label<span class="sc">:</span><span class="er">=</span> <span class="st">&quot;Armitage&quot;</span>]</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>Kramer.dt[,label<span class="sc">:</span><span class="er">=</span> <span class="st">&quot;Kramer&quot;</span>]</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>Nominal.dt[,label<span class="sc">:</span><span class="er">=</span> <span class="st">&quot;Nominal&quot;</span>]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#combine data for plotting (datasets are side by side)</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>combodata<span class="ot">&lt;-</span><span class="fu">merge</span>(Armitage.dt, kramerOutput_data.dt, <span class="at">by =</span> <span class="st">&quot;X&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>) </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#kramer output still has nomconc values </span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(combodata, <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;ManuscriptOutput_&quot;</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                                     data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#set default theme elements for visually consistent manuscript plots</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>personal_theme <span class="ot">&lt;-</span> <span class="cf">function</span>(){ </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth=</span><span class="dv">1</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>)),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.15</span>)),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.5</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#set plot colors to correspond with each chemica</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>plotcolors<span class="ot">&lt;-</span>scales<span class="sc">::</span><span class="fu">viridis_pal</span>()(<span class="fu">length</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(armitageOutput_data.dt<span class="sc">$</span>ChemicalName)))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plotcolors)<span class="ot">&lt;-</span>armitageOutput_data.dt<span class="sc">$</span>ChemicalName <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span></code></pre></div>
</div>
<div id="main-paper-plots" class="section level1">
<h1>Main Paper Plots:</h1>
<div id="figure-1" class="section level2">
<h2>Figure 1:</h2>
<p>In Vitro Distribution Diagram (no code)</p>
</div>
<div id="figure-2" class="section level2">
<h2>Figure 2:</h2>
<p>Predicted and experimental intracellular concentrations from the
Nominal = Cfree (left panel), Armitage (middle panel), and Kramer (right
panel) models. Dashed line shows unity.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ARMITAGE:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage RMSLE:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>arm_rmsle_long<span class="ot">&lt;-</span><span class="fu">rmsle</span>((Armitage.dt<span class="sc">$</span>CellConcentration_uM),(Armitage.dt<span class="sc">$</span>ccells))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>arm_rmsle<span class="ot">&lt;-</span><span class="fu">round</span>(arm_rmsle_long, <span class="dv">2</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#1.12</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage r^2:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>ml_arm_overall <span class="ot">=</span> <span class="fu">lm</span>(CellConcentration_uM<span class="sc">~</span>ccells, <span class="at">data =</span> Armitage.dt)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ml_arm_overall)<span class="sc">$</span>r.squared </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#0.33</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#plot set up</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>yrng <span class="ot">&lt;-</span> <span class="fu">range</span>(Armitage.dt<span class="sc">$</span>CellConcentration_uM)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>xrng <span class="ot">&lt;-</span> <span class="fu">range</span>(Armitage.dt<span class="sc">$</span>ccells)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>n_chems<span class="ot">&lt;-</span><span class="fu">n_distinct</span>(Nominal.dt<span class="sc">$</span>ChemicalName)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>n_data<span class="ot">&lt;-</span><span class="fu">nrow</span>(Nominal.dt)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># now plot</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>Armitage_ccell<span class="ot">&lt;-</span><span class="fu">ggplot</span>(Armitage.dt) <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(ccells, CellConcentration_uM, <span class="at">color =</span> ChemicalName)) <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Armitage Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Experimental &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.00001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.00001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;N[data] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_data)), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;N[chemicals] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_chems)), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">1.2</span>, <span class="at">size =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], </span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;RMSLE =&quot;</span>, arm_rmsle), </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co">#KRAMER:</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Kramer RMSLE:</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>kram_rmsle_long<span class="ot">&lt;-</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmsle</span>((Kramer.dt<span class="sc">$</span>CellConcentration_uM),(Kramer.dt<span class="sc">$</span>concentration_cells))</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>kram_rmsle<span class="ot">&lt;-</span><span class="fu">format</span>(<span class="fu">round</span>(kram_rmsle_long, <span class="at">digits=</span><span class="dv">2</span>), <span class="at">nsmall =</span> <span class="dv">2</span>) </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="co">#1.30</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co">#Kramer r^2:</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>ml_kram_overall <span class="ot">=</span> <span class="fu">lm</span>(CellConcentration_uM<span class="sc">~</span>concentration_cells, <span class="at">data =</span> Kramer.dt)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ml_kram_overall)<span class="sc">$</span>r.squared </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co">#0.03</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>Kramer_ccell<span class="ot">&lt;-</span><span class="fu">ggplot</span>(Kramer.dt)<span class="sc">+</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(concentration_cells, CellConcentration_uM, </span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colour =</span> ChemicalName)) <span class="sc">+</span> </span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.00001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.00001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Kramer Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Experimental &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;N[data] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_data)), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;N[chemicals] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_chems)), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">1.2</span>, <span class="at">size =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], </span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;RMSLE =&quot;</span>, kram_rmsle), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a><span class="co">#NOMINAL:</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="co">#Nominal RMSLE:</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>nom_rmsle_long<span class="ot">&lt;-</span><span class="fu">rmsle</span>((Nominal.dt<span class="sc">$</span>CellConcentration_uM),(Nominal.dt<span class="sc">$</span>nomconc))</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>nom_rmsle<span class="ot">&lt;-</span><span class="fu">round</span>(nom_rmsle_long, <span class="dv">2</span>)</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co">#1.45</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>Nominal_ccell<span class="ot">&lt;-</span><span class="fu">ggplot</span>(Nominal.dt) <span class="sc">+</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(nomconc, CellConcentration_uM, <span class="at">colour =</span> ChemicalName))<span class="sc">+</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.00001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.00001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;nominal&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Experimental &quot;</span><span class="sc">~</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;N[data] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_data)), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;N[chemicals] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_chems)), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">1.2</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng[<span class="dv">2</span>], <span class="at">y =</span> yrng[<span class="dv">1</span>], </span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;RMSLE =&quot;</span>, nom_rmsle), </span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;mm&#39;</span>),</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.spacing =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))<span class="sc">+</span></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">col =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors)</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a><span class="co">#Combine the three plots w RMSLE</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>Ccells_comboplot<span class="ot">&lt;-</span><span class="fu">ggarrange</span>(Nominal_ccell, Armitage_ccell, Kramer_ccell, </span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ncol=</span><span class="dv">3</span> , <span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a><span class="co">#save</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;Figure2_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>         <span class="at">path =</span> path_out,</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>         Ccells_comboplot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Ccells_comboplot)</span></code></pre></div>
</div>
<div id="figure-3" class="section level2">
<h2>Figure 3:</h2>
<p>Predicted and experimental intracellular concentrations from the
Armitage (left panel) and Kramer (right panel) models for the ten
chemicals with multiple observations. Solid lines connect multiple
measurements for a single chemical. The dashed line shows unity.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage.multobs.dt %&gt;% count(ChemicalName, NominalDose_uM, Citation)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#some of these have super close nomconcs because they are experimentally </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#measured - not really relevant for this comparison because they are replicates</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#chemicals to remove:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Hexachlorobenzene, Malathion, Pentachlorophenol, Propiconazole </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#(all of the chemicals from Stadnicka, 2014)</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>multiObsChemnameList<span class="ot">&lt;-</span>Armitage.dt <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Citation <span class="sc">!=</span> <span class="st">&quot;Stadnicka, 2014&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ChemicalName, NominalDose_uM) <span class="sc">%&gt;%</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ChemicalName) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(n<span class="sc">&gt;=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ChemicalName) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#10 chemicals with multiple nominal doses measured</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#filter measured data to just these chemicals</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>Armitage.multobs.dt_og <span class="ot">&lt;-</span> Armitage.dt <span class="sc">%&gt;%</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ChemicalName <span class="sc">%in%</span> multiObsChemnameList<span class="sc">$</span>ChemicalName)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>Kramer.multobs.dt_og <span class="ot">&lt;-</span> Kramer.dt <span class="sc">%&gt;%</span> </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ChemicalName <span class="sc">%in%</span> multiObsChemnameList<span class="sc">$</span>ChemicalName)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>Nominal.multobs.dt_og <span class="ot">&lt;-</span> Nominal.dt <span class="sc">%&gt;%</span> </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ChemicalName <span class="sc">%in%</span> multiObsChemnameList<span class="sc">$</span>ChemicalName)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">#each have 89 observations</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co">#merge the lines with multiple observations for the same nomconc (ie tox21)</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>Armitage.multobs.dt<span class="ot">&lt;-</span>Armitage.multobs.dt_og <span class="sc">%&gt;%</span> </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ChemicalName, NominalDose_uM) <span class="sc">%&gt;%</span> </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_measuredccell =</span> <span class="fu">mean</span>(CellConcentration_uM),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_predictedccell =</span> <span class="fu">mean</span>(ccells)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ChemicalName, NominalDose_uM, mean_measuredccell, </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>         mean_predictedccell) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>Kramer.multobs.dt<span class="ot">&lt;-</span>Kramer.multobs.dt_og <span class="sc">%&gt;%</span> </span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ChemicalName, NominalDose_uM) <span class="sc">%&gt;%</span> </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_measuredccell =</span> <span class="fu">mean</span>(CellConcentration_uM),</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_predictedccell =</span> <span class="fu">mean</span>(concentration_cells)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ChemicalName, NominalDose_uM, mean_measuredccell, </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>         mean_predictedccell) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>Nominal.multobs.dt<span class="ot">&lt;-</span>Nominal.multobs.dt_og <span class="sc">%&gt;%</span> </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ChemicalName, NominalDose_uM) <span class="sc">%&gt;%</span> </span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_measuredccell =</span> <span class="fu">mean</span>(CellConcentration_uM),</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_predictedccell =</span> <span class="fu">mean</span>(NominalDose_uM)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ChemicalName, NominalDose_uM, mean_measuredccell, </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>         mean_predictedccell) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co">#down to 50 observations because the duplicates have been averaged</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="do">### Plotting </span><span class="al">###</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="co">#plot set up</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>yrng_mult <span class="ot">&lt;-</span> <span class="fu">range</span>(Armitage.multobs.dt<span class="sc">$</span>mean_measuredccell)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>xrng_mult <span class="ot">&lt;-</span> <span class="fu">range</span>(Armitage.multobs.dt<span class="sc">$</span>mean_predictedccell)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>n_chems_mult<span class="ot">&lt;-</span><span class="fu">n_distinct</span>(Armitage.multobs.dt<span class="sc">$</span>ChemicalName)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>n_data_mult<span class="ot">&lt;-</span><span class="fu">nrow</span>(Armitage.multobs.dt)</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="co">#ARMITAGE</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage RMSLE:</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>arm_mult_rmsle_long<span class="ot">&lt;-</span><span class="fu">rmsle</span>((Armitage.multobs.dt<span class="sc">$</span>mean_measuredccell),</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>                           (Armitage.multobs.dt<span class="sc">$</span>mean_predictedccell))</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>arm_mult_rmsle<span class="ot">&lt;-</span><span class="fu">round</span>(arm_mult_rmsle_long, <span class="dv">2</span>)</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="co">#1.27</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="co">#r squared </span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>ml_arm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mean_measuredccell<span class="sc">~</span>mean_predictedccell, <span class="at">data =</span> Armitage.multobs.dt)</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>rsq_armitage_mult <span class="ot">&lt;-</span> <span class="fu">summary</span>(ml_arm)<span class="sc">$</span>r.squared</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="co">#0.87</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a><span class="co"># now plot</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>Armitage_ccell_mult<span class="ot">&lt;-</span><span class="fu">ggplot</span>(Armitage.multobs.dt) <span class="sc">+</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(mean_predictedccell, mean_measuredccell, </span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colour =</span> ChemicalName)) <span class="sc">+</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(mean_predictedccell, mean_measuredccell, </span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>                  <span class="at">colour =</span> ChemicalName), <span class="at">method=</span>lm, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Armitage Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Experimental &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng_mult[<span class="dv">2</span>], <span class="at">y =</span> yrng_mult[<span class="dv">1</span>], </span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;N[data] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_data_mult)), </span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng_mult[<span class="dv">2</span>], <span class="at">y =</span> yrng_mult[<span class="dv">1</span>], </span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;N[chemicals] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_chems_mult)), </span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">1.2</span>, <span class="at">size =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng_mult[<span class="dv">2</span>], <span class="at">y =</span> yrng_mult[<span class="dv">1</span>], </span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;RMSLE =&quot;</span>, arm_mult_rmsle), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>()  <span class="sc">+</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors)</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a><span class="co">#KRAMER</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a><span class="co">#Kramer RMSLE:</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>kram_mult_rmsle_long<span class="ot">&lt;-</span><span class="fu">rmsle</span>((Kramer.multobs.dt<span class="sc">$</span>mean_measuredccell),</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>                            (Kramer.multobs.dt<span class="sc">$</span>mean_predictedccell))</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>kram_mult_rmsle<span class="ot">&lt;-</span><span class="fu">round</span>(kram_mult_rmsle_long, <span class="dv">2</span>)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.58</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a><span class="co">#r squared </span></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>ml_kram <span class="ot">&lt;-</span> <span class="fu">lm</span>(mean_measuredccell<span class="sc">~</span>mean_predictedccell, <span class="at">data =</span> Kramer.multobs.dt)</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>rsq_kramer_mult <span class="ot">&lt;-</span> <span class="fu">summary</span>(ml_kram)<span class="sc">$</span>r.squared</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="co">#0.87</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a><span class="co"># now plot</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>Kramer_ccell_mult<span class="ot">&lt;-</span><span class="fu">ggplot</span>(Kramer.multobs.dt) <span class="sc">+</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(mean_predictedccell, mean_measuredccell, </span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colour =</span> ChemicalName)) <span class="sc">+</span></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(mean_predictedccell, mean_measuredccell, </span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>                  <span class="at">colour =</span> ChemicalName), <span class="at">method=</span>lm, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">400000</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), </span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Kramer Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Experimental &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng_mult[<span class="dv">2</span>], <span class="at">y =</span> yrng_mult[<span class="dv">1</span>], </span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;N[data] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_data_mult)), </span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng_mult[<span class="dv">2</span>], <span class="at">y =</span> yrng_mult[<span class="dv">1</span>], </span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;N[chemicals] &quot;</span>, <span class="st">&quot;~&#39;=&#39;~&quot;</span>, n_chems_mult)), </span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">1.2</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> xrng_mult[<span class="dv">2</span>], <span class="at">y =</span> yrng_mult[<span class="dv">1</span>], </span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;RMSLE =&quot;</span>, kram_mult_rmsle), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>()  <span class="sc">+</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors) <span class="sc">+</span></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;mm&#39;</span>),</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a><span class="co">#arrange</span></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>Ccells_comboplot_mult<span class="ot">&lt;-</span><span class="fu">ggarrange</span>(Armitage_ccell_mult, Kramer_ccell_mult, <span class="at">ncol=</span><span class="dv">2</span>,</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;Figure3_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>         <span class="at">path =</span> path_out,</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>         Ccells_comboplot_mult, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Ccells_comboplot_mult)</span></code></pre></div>
</div>
<div id="figure-4" class="section level2">
<h2>Figure 4:</h2>
<p>Chemical partitioning into water, air, cell, and plastic compartments
for the Armitage and Kramer models. Dashed line shows unity.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Cwat_uM -------- Cwat_R</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>Cwater_comparison<span class="ot">&lt;-</span><span class="fu">ggplot</span>(combodata) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(concentration_medium, cwat_s, <span class="at">colour =</span> ChemicalName.x)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Medium Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Kramer Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;medium&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Armitage Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;medium&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Cair_uM -------- Cair_R</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>Cair_comparison<span class="ot">&lt;-</span><span class="fu">ggplot</span>(combodata) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(concentration_air, cair, <span class="at">colour =</span> ChemicalName.x)) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Air Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Kramer Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;air&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Armitage Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;air&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">#C_cells_uM ----- Ccells</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>Ccells_comparison<span class="ot">&lt;-</span><span class="fu">ggplot</span>(combodata) <span class="sc">+</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(concentration_cells, ccells, <span class="at">colour =</span> ChemicalName.x)) <span class="sc">+</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Cell Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Kramer Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Armitage Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>), <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>), </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>), <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>), </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Aplastic_uM_m2 - (Cplastic_R / Sarea_R)</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>Aplastic_comparison<span class="ot">&lt;-</span><span class="fu">ggplot</span>(combodata) <span class="sc">+</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(concentration_plastic, cplastic, <span class="at">colour =</span> ChemicalName.x)) <span class="sc">+</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Plastic Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Kramer Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;plastic&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Armitage Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;plastic&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>), </span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^-</span><span class="dv">6</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>plotcolors) <span class="sc">+</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&#39;mm&#39;</span>),</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>compartment_plots<span class="ot">&lt;-</span><span class="fu">ggarrange</span>(Ccells_comparison, Aplastic_comparison, </span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>                             Cwater_comparison, Cair_comparison, </span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>                             <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;Figure4_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">path =</span> path_out,</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>         compartment_plots, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi=</span> <span class="dv">300</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(compartment_plots)</span></code></pre></div>
</div>
<div id="figure-5" class="section level2">
<h2>Figure 5:</h2>
<p>Comparison of Armitage model using curated vs dashboard physchem
values.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#load curated data info</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>original_curated.data.dt <span class="ot">&lt;-</span> httk<span class="sc">::</span>Dimitrijevic.IVD</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#first - run using the default/dashboard values</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>default.dt<span class="ot">&lt;-</span><span class="fu">copy</span>(original_curated.data.dt <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>( <span class="st">&quot;Arnot_pka&quot;</span>, <span class="st">&quot;Arnot_pkb&quot;</span>, <span class="st">&quot;Chemaxon_pKa&quot;</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Chemaxon_pKb&quot;</span>, <span class="st">&quot;log.KOW.N&quot;</span>, <span class="st">&quot;log.KAW.N&quot;</span>, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Predicted_Ccell_µM&quot;</span>, <span class="st">&quot;FoA&quot;</span>)))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model, output concentrations in umol/L (e.g. uM)</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>armitageOutput_default.dt <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>default.dt,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">restrict.ion.partitioning =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">surface.area.switch =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#next- run using curated values (EAS-E Suite)</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>curated.data.dt<span class="ot">&lt;-</span><span class="fu">copy</span>(original_curated.data.dt)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#overwrite using curated physchem properties</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>curated.data.dt[, pKa_Donor <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(Arnot_pka)] <span class="sc">%&gt;%</span> <span class="co">#acidic</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  .[, pKa_Accept <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(Arnot_pkb)] <span class="sc">%&gt;%</span> <span class="co">#basic</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  .[, gkow <span class="sc">:</span><span class="er">=</span> log.KOW.N] <span class="sc">%&gt;%</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  .[, gkaw_n <span class="sc">:</span><span class="er">=</span> log.KAW.N] </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model, output concentrations in umol/L (e.g. uM)</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>armitageOutput_curated.data.dt <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>curated.data.dt,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">restrict.ion.partitioning =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">surface.area.switch =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">#save output with these values (Supplemental Materials T9)</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>defaultvals<span class="ot">&lt;-</span> armitageOutput_default.dt <span class="sc">%&gt;%</span> </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, casrn, gkow_n, gkaw_n, pKa_Donor, pKa_Accept)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>curatedvals<span class="ot">&lt;-</span>armitageOutput_curated.data.dt <span class="sc">%&gt;%</span> </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, casrn, gkow_n, gkaw_n, pKa_Donor, pKa_Accept)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">#tie the two tables together for the supplement</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>s9_table<span class="ot">&lt;-</span><span class="fu">rbind</span>(curatedvals, defaultvals)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate rmsle</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co">#default values</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="co">#individual</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>armitageOutput_default.dt[,rmsle_ccell_default<span class="sc">:</span><span class="er">=</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rmsle</span>(Reported_Ccell_µM, ccells), by <span class="ot">=</span> Name]</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co">#total</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>RMSLE_default.dt<span class="ot">&lt;-</span><span class="fu">rmsle</span>(armitageOutput_default.dt<span class="sc">$</span>Reported_Ccell_µM, </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>                        armitageOutput_default.dt<span class="sc">$</span>ccells)</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>RMSLE_default.dt<span class="ot">&lt;-</span><span class="fu">round</span>(RMSLE_default.dt, <span class="dv">3</span>)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co">#0.586</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co">#curated values</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="co">#individual</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>armitageOutput_curated.data.dt[,rmsle_ccell_curated<span class="sc">:</span><span class="er">=</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rmsle</span>(Reported_Ccell_µM, ccells), by <span class="ot">=</span> Name]</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="co">#total</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>RMSLE_curated.data.dt<span class="ot">&lt;-</span><span class="fu">rmsle</span>(armitageOutput_curated.data.dt<span class="sc">$</span>Reported_Ccell_µM, </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>                             armitageOutput_curated.data.dt<span class="sc">$</span>ccells)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>RMSLE_curated.data.dt<span class="ot">&lt;-</span><span class="fu">round</span>(RMSLE_curated.data.dt, <span class="dv">3</span>)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="co">#0.570</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="co">#improvement when using curated data:</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>RMSLE_default.dt<span class="sc">-</span>RMSLE_curated.data.dt</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="co">#0.016</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="do">## difference between the two on a per-chemical basis ##</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>curated_data.dt<span class="ot">&lt;-</span><span class="fu">merge</span>(armitageOutput_default.dt, </span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>                       armitageOutput_curated.data.dt, <span class="at">by =</span> <span class="st">&quot;Name&quot;</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate rmsle difference for each chemical</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>curated_data.dt[,rmsle_difference<span class="sc">:</span><span class="er">=</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>                  rmsle_ccell_curated<span class="sc">-</span>rmsle_ccell_default, by <span class="ot">=</span> Name]</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="co">#which chemicals had the greatest magnitude of difference</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="co">#largest improvement when using curated data</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(curated_data.dt <span class="sc">%&gt;%</span> </span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rmsle_difference, Name) <span class="sc">%&gt;%</span> </span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rmsle_difference), <span class="dv">2</span>)</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="co">#largest improvement when using default data</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(curated_data.dt <span class="sc">%&gt;%</span> </span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rmsle_difference, Name) <span class="sc">%&gt;%</span> </span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rmsle_difference), <span class="dv">2</span>)</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>curated_difference_httk_plot<span class="ot">&lt;-</span><span class="fu">ggplot</span>(curated_data.dt) <span class="sc">+</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(ccells.y, Reported_Ccell_µM.y, <span class="at">colour =</span> Name), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(ccells.y, Reported_Ccell_µM.y, </span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>                       <span class="at">label =</span> <span class="fu">round</span>(rmsle_difference, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="st">&quot;Armitage Predicted &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot;C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="st">&quot;Experimental &quot;</span><span class="sc">*</span><span class="fu">italic</span>(<span class="st">&quot; C&quot;</span>[<span class="st">&quot;cell&quot;</span>])<span class="sc">~</span><span class="st">&quot;(\u03BCM)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10000</span>), <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">lim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10000</span>), <span class="at">labels =</span> <span class="fu">label_log</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">personal_theme</span>() <span class="sc">+</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete=</span><span class="cn">TRUE</span>)<span class="sc">+</span> </span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;mm&#39;</span>),</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.spacing =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;Figure5_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>         <span class="at">path =</span> path_out,</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>         curated_difference_httk_plot, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(s9_table, <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s9_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="main-paper-calculations" class="section level1">
<h1>Main paper Calculations:</h1>
<div id="overunderestimation" class="section level2">
<h2>Over/underestimation</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The Armitage model resulted in a slight over prediction of Ccell whereas </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the Kramer model had the greatest spread but most evenly over and </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># underpredicted Ccell (Figure 2). </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(Armitage.dt<span class="sc">$</span>ccells)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#1.555754e-02 4.845393e+04</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(Kramer.dt<span class="sc">$</span>concentration_cells)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#5.838149e-04 2.663947e+04</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Kramer has a larger spread of predictions</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="do">##create datatable with both outputs stacked </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>stacked.data<span class="ot">&lt;-</span><span class="fu">rbind</span>(Armitage.dt, Kramer.dt, <span class="at">fill=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#overpredict or underpredict for each model compared to experimental</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>stacked.data_HL<span class="ot">&lt;-</span><span class="fu">copy</span>(stacked.data)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>stacked.data_HL[ccells<span class="sc">&gt;</span>CellConcentration_uM, </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                ARMITAGE_ccellcomp<span class="sc">:</span><span class="er">=</span><span class="st">&quot;ARMITAGE higher&quot;</span>] <span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  .[ccells<span class="sc">&lt;</span>CellConcentration_uM, </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    ARMITAGE_ccellcomp<span class="sc">:</span><span class="er">=</span><span class="st">&quot;ARMITAGE lower&quot;</span>] <span class="sc">%&gt;%</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  .[concentration_cells<span class="sc">&gt;</span>CellConcentration_uM, </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    KRAMER_ccellcomp<span class="sc">:</span><span class="er">=</span><span class="st">&quot;KRAMER higher&quot;</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  .[concentration_cells<span class="sc">&lt;</span>CellConcentration_uM, </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    KRAMER_ccellcomp<span class="sc">:</span><span class="er">=</span><span class="st">&quot;KRAMER lower&quot;</span>] </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>stacked.data_HL <span class="sc">%&gt;%</span> <span class="fu">count</span>(ARMITAGE_ccellcomp, KRAMER_ccellcomp)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage model more often over predicts</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Kramer is pretty even split of over and under predictions</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co">#pick out where armitage prediction or kramer prediction is larger</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>sidebyside.data_HL<span class="ot">&lt;-</span><span class="fu">copy</span>(combodata)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>sidebyside.data_HL[ccells<span class="sc">&gt;</span>concentration_cells, ARMITAGE<span class="sc">:</span><span class="er">=</span><span class="st">&quot;ARMITAGE higher&quot;</span>] <span class="sc">%&gt;%</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  .[ccells<span class="sc">&lt;</span>concentration_cells, KRAMER<span class="sc">:</span><span class="er">=</span><span class="st">&quot;KRAMER higher&quot;</span>]</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co">#count which is higher or lower by chemical</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>sidebyside.data_HL <span class="sc">%&gt;%</span> <span class="fu">select</span>(ChemicalName.x, ARMITAGE, KRAMER) <span class="sc">%&gt;%</span> </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">count</span>(ARMITAGE, KRAMER)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co">#armitage: higher for 38 chemicals</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="co">#kramer: higher for 5 chemicals</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co">#38+5 = 43 chemicals overall</span></span></code></pre></div>
</div>
<div id="effect-of-experimentally-measured-nominal-dose" class="section level2">
<h2>Effect of experimentally measured nominal dose</h2>
<p>Change in accuracy of intracellular concentration predicted by
studies reporting experimentally measured nominal dose</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#pull observations that did experimentally measure the nominal dose</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>exp_nom.dt<span class="ot">&lt;-</span><span class="fu">copy</span>(IVD_Manuscript_data[<span class="sc">!</span>(<span class="fu">is.na</span>(ExperimentalDose_uM)),]) </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#6 citations did measure experimental dose</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#42 observations</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#run armitage with nomconc as NominalDose_uM.x (not experimentally measured)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>arm_nomconc<span class="ot">&lt;-</span><span class="fu">copy</span>(exp_nom.dt[, <span class="at">nomconc :=</span> NominalDose_uM])</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># run Armitage model, output concentrations in umol/L (e.g. uM)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>armitageOutput_arm_nomconc <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>arm_nomconc,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">user_assay_parameters =</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                                              user_assay_parameters,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">restrict.ion.partitioning =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#run armitage with nomconc as ExperimentalDose_uM.x (experimentally measured)</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>arm_expconc<span class="ot">&lt;-</span><span class="fu">copy</span>(exp_nom.dt[, <span class="at">nomconc :=</span> ExperimentalDose_uM])</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>armitageOutput_arm_expconc <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>arm_expconc, </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">user_assay_parameters =</span> </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                                              user_assay_parameters,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">restrict.ion.partitioning =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage NOMCONC RMSLE:</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>arm_nomconc_rmsle_long<span class="ot">&lt;-</span><span class="fu">rmsle</span>((armitageOutput_arm_nomconc<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                              (armitageOutput_arm_nomconc<span class="sc">$</span>ccells))</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>arm_nomconc_rmsle<span class="ot">&lt;-</span><span class="fu">round</span>(arm_nomconc_rmsle_long, <span class="dv">2</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">#1.62</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage EXPCONC RMSLE:</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>arm_expconc_rmsle_long<span class="ot">&lt;-</span><span class="fu">rmsle</span>((armitageOutput_arm_expconc<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>                              (armitageOutput_arm_expconc<span class="sc">$</span>ccells))</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>arm_expconc_rmsle<span class="ot">&lt;-</span><span class="fu">round</span>(arm_expconc_rmsle_long, <span class="dv">2</span>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co">#1.53</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co">#improvement between the experimental and nomconc rmsles</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>arm_nomconc_rmsle<span class="sc">-</span> arm_expconc_rmsle</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co">#0.09</span></span></code></pre></div>
<p>#Supplement:</p>
</div>
<div id="table-s1." class="section level2">
<h2>Table S1.</h2>
<p>Physicochemical properties of test chemicals and Ccell/Cnominal
ratios from each reference.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#create datatable to hold the info</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>table1.dt<span class="ot">&lt;-</span><span class="fu">copy</span>(Nominal.dt)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pull out the columns we need</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>data.dt<span class="ot">&lt;-</span>table1.dt[, <span class="fu">c</span>(<span class="st">&quot;Citation&quot;</span>, <span class="st">&quot;casrn&quot;</span>, <span class="st">&quot;ChemicalName&quot;</span>, <span class="st">&quot;IOC_Type&quot;</span>, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;nomconc&quot;</span>, <span class="st">&quot;CellConcentration_uM&quot;</span>), with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pull dtxsids, log P, henry&#39;s law, and pka:</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#dtxsids</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>cheminfo.dt<span class="ot">&lt;-</span><span class="fu">as.data.table</span>(<span class="fu">get_chem_id</span>(<span class="at">chem.cas=</span><span class="fu">unique</span>(data.dt<span class="sc">$</span>casrn)))</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>cheminfo.dt[, casrn<span class="sc">:</span><span class="er">=</span>chem.cas] <span class="sc">%&gt;%</span> <span class="co">#rename</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  .[,chem.cas<span class="sc">:</span><span class="er">=</span><span class="cn">NULL</span>] <span class="sc">%&gt;%</span> <span class="co">#delete</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  .[,chem.name<span class="sc">:</span><span class="er">=</span><span class="cn">NULL</span>] <span class="co">#delete</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">#add dtxsid info to the storage file</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>data.dt2<span class="ot">&lt;-</span>data.dt[cheminfo.dt,on<span class="ot">=</span><span class="st">&quot;casrn&quot;</span>]</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#collect log P, henry&#39;s law, and pka values</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>data.dt2[, <span class="fu">c</span>(<span class="st">&quot;logP&quot;</span>,<span class="st">&quot;logHenry&quot;</span>, <span class="st">&quot;pKa_Donor&quot;</span>, <span class="st">&quot;pKa_Accept&quot;</span>) <span class="sc">:</span><span class="er">=</span> </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.data.frame</span>(<span class="fu">get_physchem_param</span>(<span class="at">param =</span> <span class="fu">c</span>(<span class="st">&quot;logP&quot;</span>,<span class="st">&quot;logHenry&quot;</span>, </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                                                      <span class="st">&quot;pKa_Donor&quot;</span>, </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                                                      <span class="st">&quot;pKa_Accept&quot;</span>), </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">chem.cas =</span> casrn))] </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate median CellConcentration_uM:cnom ratio </span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># (for each citation if multiple) and number of observations per chemical</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co">#get ccell : cnom ratio</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>data.dt2[,cellconc_cnom_ratio<span class="sc">:</span><span class="er">=</span>CellConcentration_uM<span class="sc">/</span>nomconc]</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co">#for each chemical/citation combination, calculate the median ccell:cnom ratio</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>data.dt2[, median_ratio <span class="sc">:</span><span class="er">=</span> <span class="fu">median</span>(cellconc_cnom_ratio), </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>         by<span class="ot">=</span><span class="fu">list</span>(Citation, ChemicalName)]</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co">#count the number of observations by citation and chemname</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>data.dt2[, number_of_obs<span class="sc">:</span><span class="er">=</span>.N, by<span class="ot">=</span><span class="fu">list</span>(Citation, ChemicalName)]</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co">#filter down to one observation per citation/casrn combo</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>final_output<span class="ot">&lt;-</span>data.dt2 <span class="sc">%&gt;%</span> </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logP=</span><span class="fu">round</span>(logP, <span class="dv">2</span>),</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">logHenry=</span><span class="fu">round</span>(logHenry, <span class="dv">2</span>),</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_ratio=</span><span class="fu">round</span>(median_ratio, <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;casrn&quot;</span>, <span class="st">&quot;nomconc&quot;</span>, <span class="st">&quot;CellConcentration_uM&quot;</span>, </span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;cellconc_cnom_ratio&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co">#get rid of extra rows</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Citation, ChemicalName, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="co">#1 obs per citation/chem pair</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="co">#save the output</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(final_output, <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s1_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="table-s2.-in-vitro-assay-descriptors-for-the-measurements" class="section level2">
<h2>Table S2. In vitro assay descriptors for the measurements</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#copy table to manipulate</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>parameter_table<span class="ot">&lt;-</span><span class="fu">copy</span>(Nominal.dt)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>table_s2<span class="ot">&lt;-</span>parameter_table[, <span class="fu">c</span>(<span class="st">&quot;Citation&quot;</span>, <span class="st">&quot;ChemicalName&quot;</span>, <span class="st">&quot;nomconc&quot;</span>, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;NominalDose_uM&quot;</span>, <span class="st">&quot;v_total&quot;</span>, <span class="st">&quot;v_working&quot;</span>, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;sarea&quot;</span>, <span class="st">&quot;well_number&quot;</span>, <span class="st">&quot;cell_yield&quot;</span>, <span class="st">&quot;FBSf&quot;</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;FigureNumber&quot;</span>, <span class="st">&quot;CellType&quot;</span>)] <span class="co">#subset columns</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#save the output</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(table_s2, </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s2_raw_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="table-s3." class="section level2">
<h2>Table S3.</h2>
<p>Root mean squared log error (RMSLE) and coefficient of determination
(r2) for the chemicals with multiple observations. Note: Atrazine,
Flusilazole, N-Phenyl-1,4-benzenediamine, Rosiglitazone, Thiacloprid,
and Triphenyl phosphate each only reflect two data points.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Armitage</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#copy for editing</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>multobs_rmsle_armitage<span class="ot">&lt;-</span><span class="fu">copy</span>(<span class="fu">as.data.table</span>(Armitage.multobs.dt))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#group by chemname, calc RMSLE, r^2, and number of obs</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>multobs_rmsle_armitage[, RMSLE_armitage_mult<span class="sc">:</span><span class="er">=</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rmsle</span>(mean_measuredccell, mean_predictedccell), </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                       by <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#rmsle</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  .[, rsq_armitage_mult<span class="sc">:</span><span class="er">=</span> </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>(<span class="fu">lm</span>(mean_measuredccell<span class="sc">~</span>mean_predictedccell))<span class="sc">$</span>r.squared, </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#r^2</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  .[, numberofpoints<span class="sc">:</span><span class="er">=</span> .N, by <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>] </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#numberofpoints = number of datapoints considered (includes averaged points)</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#repeat for kramer</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">#copy for editing</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>multobs_rmsle_kramer<span class="ot">&lt;-</span><span class="fu">copy</span>(<span class="fu">as.data.table</span>(Kramer.multobs.dt))</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co">#group by chemname, calc RMSLE, r^2, and number of obs</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>multobs_rmsle_kramer[, RMSLE_kramer_mult<span class="sc">:</span><span class="er">=</span> </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rmsle</span>(mean_measuredccell, mean_predictedccell), </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                       by <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#rmsle</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  .[, rsq_kramer_mult<span class="sc">:</span><span class="er">=</span> </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>(<span class="fu">lm</span>(mean_measuredccell<span class="sc">~</span>mean_predictedccell))<span class="sc">$</span>r.squared, </span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#r^2</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  .[, numberofpoints<span class="sc">:</span><span class="er">=</span> .N, by <span class="ot">=</span> <span class="st">&quot;ChemicalName&quot;</span>] </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co">#cut down both to the columns we need and only 1 obs per chemical</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>mult.dt<span class="ot">&lt;-</span><span class="fu">merge</span>(multobs_rmsle_armitage[, <span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;NominalDose_uM&quot;</span>, </span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;mean_measuredccell&quot;</span>, </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;mean_predictedccell&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">distinct</span>() , </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>               multobs_rmsle_kramer[, <span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;NominalDose_uM&quot;</span>, </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;mean_measuredccell&quot;</span>, </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;mean_predictedccell&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">distinct</span>())</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="co">#for higher/lower rmsle comparison</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>mult_HL<span class="ot">&lt;-</span><span class="fu">copy</span>(mult.dt[RMSLE_kramer_mult<span class="sc">&gt;</span>RMSLE_armitage_mult, </span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>                      <span class="at">higherorlower:=</span><span class="st">&quot;Kramer higher&quot;</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  .[RMSLE_kramer_mult<span class="sc">&lt;</span>RMSLE_armitage_mult, </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">higherorlower:=</span><span class="st">&quot;kramer lower&quot;</span>])</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>mult_HL <span class="sc">%&gt;%</span> <span class="fu">count</span>(higherorlower)</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="co">#armitage predictions have lower error for 6 chemicals</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="co">#kramer predictions are lower error for the other 4</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="co">#save the output</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(mult.dt, </span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s3_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="table-s4" class="section level2">
<h2>Table S4:</h2>
<p>RMSLE and r^2 for acids and bases.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#copy for editing</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ionization_rmsle<span class="ot">&lt;-</span><span class="fu">copy</span>(stacked.data)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate RMSLSE and r^2 for each model and ionization type</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ionization_rmsle_output<span class="ot">&lt;-</span> <span class="fu">copy</span>(ionization_rmsle[label<span class="sc">==</span><span class="st">&quot;Armitage&quot;</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">RMSLE_armitage_ionization:=</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rmsle</span>(CellConcentration_uM, ccells), </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="st">&quot;IOC_Type&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#RMSLE</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  .[label<span class="sc">==</span><span class="st">&quot;Armitage&quot;</span>, <span class="at">rsq_armitage_ionization:=</span> </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>(<span class="fu">lm</span>(CellConcentration_uM<span class="sc">~</span>ccells))<span class="sc">$</span>r.squared, </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;IOC_Type&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#r^2</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  .[label<span class="sc">==</span><span class="st">&quot;Kramer&quot;</span>, <span class="at">RMSLE_kramer_ionization:=</span> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rmsle</span>(CellConcentration_uM, concentration_cells), </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="st">&quot;IOC_Type&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#RMSLE</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  .[label<span class="sc">==</span><span class="st">&quot;Kramer&quot;</span>, <span class="at">rsq_kramer_ionization:=</span> </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>(<span class="fu">lm</span>(CellConcentration_uM<span class="sc">~</span>concentration_cells))<span class="sc">$</span>r.squared, </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;IOC_Type&quot;</span>] <span class="sc">%&gt;%</span> <span class="co">#r^2</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  .[,<span class="at">numberofpoints:=</span> .N, <span class="at">by =</span> <span class="st">&quot;IOC_Type&quot;</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  .[, <span class="fu">c</span>(<span class="st">&quot;IOC_Type&quot;</span>, <span class="st">&quot;RMSLE_armitage_ionization&quot;</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;rsq_armitage_ionization&quot;</span>, <span class="st">&quot;RMSLE_kramer_ionization&quot;</span>, </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;rsq_kramer_ionization&quot;</span>, <span class="st">&quot;numberofpoints&quot;</span>)] <span class="sc">%&gt;%</span> <span class="co">#select columns we want</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>())</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ionization_rmsle_output)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#number of points is overall, not for each calculation</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co">#save the output</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(ionization_rmsle_output, </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s4_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="table-s5.-rmsle-across-lipophilicity." class="section level2">
<h2>Table S5. RMSLE across lipophilicity.</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#cut up into chunks</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>gkowbins<span class="ot">&lt;-</span>stacked.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">LogP_bins =</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">cut</span>(gkow, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">1.30</span>, <span class="fl">3.36</span>, <span class="cn">Inf</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Hydrophilic&quot;</span>, <span class="st">&quot;Moderate Lipophilic&quot;</span>, <span class="st">&quot;Lipophilic&quot;</span>)))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate rmsle for each model and logP bin combo</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>gkowbins_rmsle_output<span class="ot">&lt;-</span><span class="fu">suppressWarnings</span>(<span class="fu">copy</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  gkowbins[label <span class="sc">==</span> <span class="st">&quot;Armitage&quot;</span>, <span class="at">Armitage_RMSLE :=</span> <span class="fu">rmsle</span>(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  CellConcentration_uM, ccells), <span class="at">by =</span> LogP_bins] <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  .[label <span class="sc">==</span> <span class="st">&quot;Kramer&quot;</span>, <span class="at">Kramer_RMSLE :=</span> <span class="fu">rmsle</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  CellConcentration_uM, concentration_cells), <span class="at">by =</span> LogP_bins] <span class="sc">%&gt;%</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  .[, <span class="at">numberofpoints :=</span> .N, <span class="at">by =</span> <span class="fu">list</span>(LogP_bins, label)] <span class="sc">%&gt;%</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  .[, <span class="fu">c</span>(<span class="st">&quot;LogP_bins&quot;</span>, <span class="st">&quot;Armitage_RMSLE&quot;</span>, <span class="st">&quot;Kramer_RMSLE&quot;</span>, </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;numberofpoints&quot;</span>, <span class="st">&quot;label&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gkowbins_rmsle_output)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#number of points is overall, not for each calculation</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">#save the output</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(gkowbins_rmsle_output, </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s5_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="table-s6.-rmsle-across-volatility." class="section level2">
<h2>Table S6. RMSLE across volatility.</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#source for chunks is table 2 Volatility class in water: </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#https://www.epa.gov/pesticide-science-and-assessing-pesticide-risks/</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#guidance-reporting-environmental-fate-and-transport#:~:text=is%20very%20low.-,</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Volatility%20from%20Water,the%20reciprocal%20of%20KAW.&amp;text=GMW%20=%20gram%20</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#molecular%20weight%20in%20g/mole.&amp;text=This%20value%20is%20the%20inverse,as%20</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Cwater/Cair.&amp;text=Note%20that%20all%20chemicals%20may,volatility%20potential%20</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#is%20very%20low.</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#cut up kaw into relevant bins</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>kawbins<span class="ot">&lt;-</span>stacked.data <span class="sc">%&gt;%</span> </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Kaw_bins =</span> <span class="fu">cut</span>(DR_kaw, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="cn">Inf</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>, <span class="dv">10</span><span class="sc">^-</span><span class="dv">5</span>, <span class="sc">-</span><span class="cn">Inf</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Rapidly lost from a water surface&quot;</span>, </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Volatile from a water surface&quot;</span>, </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Slightly volatile from a water surface&quot;</span>, <span class="st">&quot;Non-volatile&quot;</span>)))</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate rmsle for each model and logP bin combo</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>kaw_rmsle_output<span class="ot">&lt;-</span><span class="fu">suppressWarnings</span>(kawbins[label <span class="sc">==</span> <span class="st">&quot;Armitage&quot;</span>, </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Armitage_RMSLE :=</span> <span class="fu">rmsle</span>(</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  CellConcentration_uM, ccells), <span class="at">by =</span> Kaw_bins] <span class="sc">%&gt;%</span> </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  .[label <span class="sc">==</span> <span class="st">&quot;Kramer&quot;</span>, <span class="at">Kramer_RMSLE :=</span> <span class="fu">rmsle</span>(</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  CellConcentration_uM, concentration_cells), <span class="at">by =</span> Kaw_bins] <span class="sc">%&gt;%</span> </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  .[, <span class="at">numberofpoints :=</span> .N, <span class="at">by =</span> <span class="fu">list</span>(Kaw_bins, label)] <span class="sc">%&gt;%</span> </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  .[, <span class="fu">c</span>(<span class="st">&quot;Kaw_bins&quot;</span>, <span class="st">&quot;Armitage_RMSLE&quot;</span>, <span class="st">&quot;Kramer_RMSLE&quot;</span>, </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;numberofpoints&quot;</span>, <span class="st">&quot;label&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>())</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co">#save the output</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(kaw_rmsle_output, </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s6_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="table-s7.-effect-of-options-on-rmsle-in-the-armitage-model." class="section level2">
<h2>Table S7. Effect of “options” on rmsle in the Armitage model.</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#list of options that can be changed in the armitage model:</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       - this.option.kbsa2 Use alternative bovine-serum-albumin partitioning</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#       - this.option.swat2 Use alternative water solubility correction</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#       - this.option.kpl2 Use alternative plastic-water partitioning model</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#       - option.plastic == TRUE (default) gives nonzero surface area</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#       - option.bottom == TRUE (default) includes surface area of the bottom of </span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#       the well in determining sarea</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#       - restrict.ion.partitioning </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#           § False (default):  Treat entire chemical as neutral and allow it all </span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#       to partition normally as such</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#           § True: Restrict so only the neutral fraction of the chemical is </span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       available to partition normally but the ionized portion is scaled</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="do">##filter to just the ones we can run with the surface area calculation since </span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">#option.plastic and option.bottom require that function:</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>options.IVD_Manuscript_data_2<span class="ot">&lt;-</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  options.IVD_Manuscript_data[<span class="sc">!</span><span class="fu">is.na</span>(well_number), ] <span class="sc">%&gt;%</span> </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  .[,sarea<span class="sc">:</span><span class="er">=</span><span class="cn">NULL</span>]  <span class="co">#delete sarea so the surface area function will run </span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">#126 out of the original 153 observations</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># length(options.IVD_Manuscript_data$Citation %&gt;% unique()) #14 citations</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># length(options.IVD_Manuscript_data_2$Citation %&gt;% unique()) #12 citations</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 153-126 data points; 27 data points total removed</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># create table to append the results to </span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>options.table <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co"># run basic armitage, only setting the surface area switch</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>option.basic <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>options.IVD_Manuscript_data_2,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">user_assay_parameters =</span> user_assay_parameters)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>option.basic_RMSLE<span class="ot">&lt;-</span><span class="fu">rmsle</span>((option.basic<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>                          (option.basic<span class="sc">$</span>ccells))</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="co">#1.148</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co">#append to table</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>options.table<span class="ot">&lt;-</span><span class="fu">rbind</span>(options.table, <span class="fu">c</span>(<span class="fu">round</span>(option.basic_RMSLE ,<span class="dv">3</span>), </span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;All Default&quot;</span>))</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="co"># run with this.option.kbsa2 == TRUE (default is false)</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>option.kbsa <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>options.IVD_Manuscript_data_2,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>                             <span class="at">this.option.kbsa2 =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>                             <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>                             <span class="at">user_assay_parameters =</span> user_assay_parameters)</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>option.kbsa_RMSLE<span class="ot">&lt;-</span><span class="fu">rmsle</span>((option.kbsa<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>                         (option.kbsa<span class="sc">$</span>ccells))</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="co">#1.150</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="co">#append to table</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>options.table<span class="ot">&lt;-</span><span class="fu">rbind</span>(options.table, <span class="fu">c</span>(<span class="fu">round</span>(option.kbsa_RMSLE, <span class="dv">3</span>), </span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;option.kbsa=TRUE&quot;</span>))</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a><span class="co"># run with this.option.swat2 == TRUE (default is false)</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>option.swat <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>options.IVD_Manuscript_data_2,</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>                             <span class="at">this.option.swat2 =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>                             <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>                             <span class="at">user_assay_parameters =</span> user_assay_parameters)</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>option.swat_RMSLE<span class="ot">&lt;-</span><span class="fu">rmsle</span>((option.swat<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>                         (option.swat<span class="sc">$</span>ccells))</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a><span class="co">#3.585</span></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a><span class="co">#append to table</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>options.table<span class="ot">&lt;-</span><span class="fu">rbind</span>(options.table, <span class="fu">c</span>(<span class="fu">round</span>(option.swat_RMSLE, <span class="dv">3</span>), </span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;option.swat2=TRUE&quot;</span>))</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="co"># run with this.option.kpl2 == TRUE (Fischer) (default is false/kramer)</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>option.kpl <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>options.IVD_Manuscript_data_2,</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>                             <span class="at">this.option.kpl2 =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>                            <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>                            <span class="at">user_assay_parameters =</span> user_assay_parameters)</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>option.kpl_RMSLE<span class="ot">&lt;-</span><span class="fu">rmsle</span>((option.kpl<span class="sc">$</span>CellConcentration_uM),(option.kpl<span class="sc">$</span>ccells))</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a><span class="co">#1.101</span></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="co">#append to table</span></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>options.table<span class="ot">&lt;-</span><span class="fu">rbind</span>(options.table, <span class="fu">c</span>(<span class="fu">round</span>(option.kpl_RMSLE, <span class="dv">3</span>), </span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;option.kpl2=TRUE&quot;</span>))</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a><span class="co"># run with option.plastic == FALSE (default is true)</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>opt.plast_input<span class="ot">&lt;-</span> <span class="fu">copy</span>(options.IVD_Manuscript_data_2)</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>opt.plast_input[,option.plastic <span class="sc">:</span><span class="er">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>option.plast <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>opt.plast_input,</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>                              <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>                              <span class="at">user_assay_parameters =</span> user_assay_parameters)</span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>option.plast_RMSLE<span class="ot">&lt;-</span><span class="fu">rmsle</span>((option.plast<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>                          (option.plast<span class="sc">$</span>ccells))</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a><span class="co">#1.178</span></span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a><span class="co">#append to table</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>options.table<span class="ot">&lt;-</span><span class="fu">rbind</span>(options.table, <span class="fu">c</span>(<span class="fu">round</span>(option.plast_RMSLE, <span class="dv">3</span>), </span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;option.plastic=FALSE&quot;</span>))</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a><span class="co"># run with option.bottom == FALSE (default is true)</span></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>option.bottom_input<span class="ot">&lt;-</span> <span class="fu">copy</span>(options.IVD_Manuscript_data_2)</span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>option.bottom_input[,option.bottom <span class="sc">:</span><span class="er">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>option.bottom <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>option.bottom_input,</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>                               <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>                              <span class="at">user_assay_parameters =</span> user_assay_parameters)</span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>option.bottom_RMSLE<span class="ot">&lt;-</span><span class="fu">rmsle</span>((option.bottom<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>                           (option.bottom<span class="sc">$</span>ccells))</span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a><span class="co">#3.956</span></span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a><span class="co">#append to table</span></span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a>options.table<span class="ot">&lt;-</span><span class="fu">rbind</span>(options.table, <span class="fu">c</span>(<span class="fu">round</span>(option.bottom_RMSLE,<span class="dv">3</span>), </span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;option.bottom=FALSE&quot;</span>))</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a><span class="co"># run with restrict.ion.partitioning == TRUE (default is FALSE)</span></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a>option.restion <span class="ot">&lt;-</span> <span class="fu">armitage_eval</span>(<span class="at">tcdata=</span>options.IVD_Manuscript_data_2,</span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a>                             <span class="at">restrict.ion.partitioning =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a>                             <span class="at">surface.area.switch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a>                              <span class="at">user_assay_parameters =</span> user_assay_parameters)</span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a>option.restion_RMSLE<span class="ot">&lt;-</span><span class="fu">rmsle</span>((option.restion<span class="sc">$</span>CellConcentration_uM),</span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a>                            (option.restion<span class="sc">$</span>ccells))</span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a><span class="co">#1.152</span></span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a><span class="co">#append to table</span></span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a>options.table<span class="ot">&lt;-</span><span class="fu">rbind</span>(options.table, <span class="fu">c</span>(<span class="fu">round</span>(option.restion_RMSLE,<span class="dv">3</span>), </span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&quot;restrict.ion.partitioning = TRUE&quot;</span>))</span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a><span class="co">#save the output</span></span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(options.table, </span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">paste0</span>(path_out,<span class="st">&quot;table_s7_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="figure-s1.-4" class="section level2">
<h2>Figure S1. 4</h2>
<p>Histogram showing chemical-specific RMSLE for Armitage Ccell vs
Measured Ccell and Kramer Ccell vs Measured Ccell:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate RMSLE for each row of data</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>combodata[, RMSLE_armitage_by_chem<span class="sc">:</span><span class="er">=</span> <span class="fu">rmsle</span>(CellConcentration_uM.x, ccells), </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          by <span class="ot">=</span> <span class="st">&quot;ChemicalName.x&quot;</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>combodata[, RMSLE_kramer_by_chem<span class="sc">:</span><span class="er">=</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmsle</span>(CellConcentration_uM.x, concentration_cells), </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>          by <span class="ot">=</span> <span class="st">&quot;ChemicalName.x&quot;</span>]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>combodata[, RMSLE_nominal_by_chem<span class="sc">:</span><span class="er">=</span> <span class="fu">rmsle</span>(CellConcentration_uM.x, nomconc), </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>          by <span class="ot">=</span> <span class="st">&quot;ChemicalName.x&quot;</span>]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#cut down to one observation per chemical</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>histo.data<span class="ot">&lt;-</span><span class="fu">copy</span>(combodata <span class="sc">%&gt;%</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">select</span>(ChemicalName.x, RMSLE_armitage_by_chem, </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                          RMSLE_kramer_by_chem, RMSLE_nominal_by_chem) <span class="sc">%&gt;%</span> </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">unique</span>())</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">#plot histograms</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>nominal_histogram_by_chem <span class="ot">&lt;-</span><span class="fu">ggplot</span>(histo.data, <span class="fu">aes</span>(<span class="at">x=</span>RMSLE_nominal_by_chem)) <span class="sc">+</span> </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Nominal RMSLE&quot;</span>,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span> </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">17</span>) <span class="sc">+</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span>  </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>armitage_histogram_by_chem <span class="ot">&lt;-</span><span class="fu">ggplot</span>(histo.data, <span class="fu">aes</span>(<span class="at">x=</span>RMSLE_armitage_by_chem)) <span class="sc">+</span> </span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Armitage RMSLE&quot;</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">17</span>) <span class="sc">+</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>kramer_histogram_by_chem <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(histo.data, <span class="fu">aes</span>(<span class="at">x=</span>RMSLE_kramer_by_chem)) <span class="sc">+</span> </span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Kramer RMSLE&quot;</span>,</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">17</span>) <span class="sc">+</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>))</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>histogram_comboplot_by_chem<span class="ot">&lt;-</span><span class="fu">ggarrange</span>(nominal_histogram_by_chem <span class="sc">+</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>)), </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>                                       armitage_histogram_by_chem <span class="sc">+</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>, </span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>                                                                    <span class="at">l =</span> <span class="dv">1</span>)), </span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>                                       kramer_histogram_by_chem <span class="sc">+</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>, </span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>                                                                    <span class="at">l =</span> <span class="dv">1</span>)), </span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(save_output){</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;Figure_S1_by_chem_&quot;</span>,data.date,<span class="st">&quot;_&quot;</span>,<span class="fu">Sys.Date</span>(),<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">path =</span> path_out,</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>         histogram_comboplot_by_chem, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(histogram_comboplot_by_chem)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
