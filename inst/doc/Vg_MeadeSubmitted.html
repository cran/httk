<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Annabel Meade, Celia Schacht, Alex George" />

<meta name="date" content="2025-08-18" />

<title>Meade (submitted): High Throughput Dermal Exposure Model</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Meade (submitted): High Throughput Dermal
Exposure Model</h1>
<h4 class="author">Annabel Meade, Celia Schacht, Alex George</h4>
<h4 class="date">2025-08-18</h4>



<p><em>Please send questions to <a href="mailto:wambaugh.john@epa.gov" class="email">wambaugh.john@epa.gov</a> or <a href="mailto:aemeade7@gmail.com" class="email">aemeade7@gmail.com</a></em></p>
<p>from “Development and analysis of high throughput physiologically
based pharmacokinetic/toxicokinetic (PBPK/TK) dermal exposure model”</p>
<p>Annabel E. Meade, Celia M.Schacht, Marina V Evans, Alex George,
Rachael Cogbill, Risa R. Sayre, and John F. Wambaugh</p>
<div id="abstract" class="section level2">
<h2>Abstract</h2>
<p>Dermal absorption of chemicals represents an important route of
exposure in pharmaceutical, occupational, and environmental settings.
There are thousands of chemicals in use with little or no toxicity or
toxicokinetic data, and dermal absorption data are lacking,
unsurprisingly, for many of these chemicals. One alternative is to
estimate human toxicokinetics using high-throughput methods.
Accordingly, the aim of this study was to develop a generalized
physiologically based pharmacokinetic/toxicokinetic (PBPK/TK) dermal
exposure model for the R package httk. For dermal exposures this model
can be used in a high-throughput manner to estimate human blood and
tissue concentrations and estimate risk for many chemicals. The
structure of the dermal PBPK/TK model was based on Campbell, Clewell,
Gentry, Anderson, and Clewell, Computational Toxicology, 929, 439
(2012). Chemical-specific metabolism and protein binding data were
obtained from the literature as collected by R package httk. The
physiochemical property data needed for the model were obtained from the
EPA CompTox Chemicals Dashboard. Here we have compared two different in
vitro methods for estimating chemical-specific and vehicle-specific
permeability in the skin: 1) Potts-Guy [Potts and Guy, Pharm Res, 9, 663
(1992)] and 2) Surrey [Chen, Han, Saib, and Lian, Pharm Res, 32, 1779
(2015)]. The model was constructed to allow comparison of dermal, oral,
and intravenous exposures. Over 26 exposure scenarios across 13
chemicals were modeled and compared to published concentration-time in
vivo data from the EPA CvT database [Sayre, Wambaugh, and Grulke,
Scientific Data, 7, 122 (2020)]. Of these 13 chemicals, four are
pharmaceuticals while the other 9 are occupationally or environmentally
relevant, 9 of the 13 are lipophilic (log of the octanol to water
partition coefficient, logP &gt; 2), three of the 13 have low water
solubility (&lt; 10 mg/L), four of the 13 have high water solubility
(&gt; 1,000 mg/L), and eight of the 13 are considered volatile. The Root
Mean Squared Log10 Error (RMSLE) between log-transformed simulated and
observed concentrations was calculated to determine how well the model
captures the behavior of this data when using the methods for dermal
permeability. Based on these results, the Potts-Guy methods slightly
out-perform the Surrey method of calculating dermal permeability for
more volatile chemicals and the vehicle is a large factor in method
success, where Potts-Guy/octanol and Surrey/water combinations generated
the best fits. We also found that exhalation is an important route of
excretion for volatiles, in particular. The views expressed in this
abstract are those of the authors and do not necessarily represent the
views or the policies of the U.S. Environmental Protection Agency.</p>
</div>
<div id="httk-version" class="section level2">
<h2>HTTK Version</h2>
<p>This vignette was created with <strong>httk</strong> v2.3.3. Although
we attempt to maintain backward compatibility, if you encounter issues
with the latest release of <strong>httk</strong> and cannot easily
address the changes, historical versions of httk are available from: <a href="https://cran.r-project.org/src/contrib/Archive/httk/" class="uri">https://cran.r-project.org/src/contrib/Archive/httk/</a></p>
</div>
<div id="table-of-contents-added-by-ag-01022024" class="section level2">
<h2>Table of Contents (added by AG 01/02/2024)</h2>
<p>Prepare for session Result 1: Model Verification Usint <em>In
Vivo</em> Data Step One: Load Data Display which chemicals are being
looked at Step Two: Clean and Format Data</p>
</div>
<div id="prepare-for-session" class="section level2">
<h2>Prepare for session</h2>
<div id="eval-false" class="section level3">
<h3>eval = FALSE</h3>
<p>If you are using the RMarkdown version of this vignette (has the file
extension .RMD) you will be able to see that several chunks of code in
this vignette have the statement <code>eval = FALSE</code>. The next
chunk of code, by default, sets <code>run.simulations = FALSE</code>.
This means that the code is included (and necessary) but was not run
when the vignette was built. We do this because some steps require
extensive computing time and CRAN has limits how long we can spend
building the package. If you want this vignette to work, you must run
all code, either by cutting and pasting it into R. Or, open the .RMD
file in RStudio and either change run.simulations to TRUE or press
“play” (the green arrow) on each chunk in RStudio.</p>
<p>We set a variable <code>run.simulations</code>. This will run
simulations and regenerate data files. If this is set to
<code>TRUE</code>, make sure you have the following data file:</p>
<ul>
<li>R_CvT_Database/CvT_all_tables_2202-08-17.Rdata: CvT data inside the
<a href="https://doi.org/10.1038%2Fs41597-020-0455-1">CvTdb</a></li>
<li>R_CvT_Database/CvT_all_tables_2202-09-14_noSQL.Rdata: CvT data
outside the <a href="https://doi.org/10.1038%2Fs41597-020-0455-1">CvTdb</a> which had
to be curated and loaded manually.</li>
<li>CCD-Batch-Search_2022-11-29_07_06_35.xlsx: Excel file loaded from
CompTox Dashboard for thirteen chemicals of interest. #Note - also need
file invitrodb_3_5_mc5.Rdata - downloaded ToxCast data. AG
12/7/2023</li>
</ul>
<p>and if <code>run.simulations = FALSE</code>, make sure to have the
following files in your working directory:</p>
<ul>
<li><em>meade2023_Aug_18_2025.Rdata</em>:
<ul>
<li><em>concentration_data_meade2023</em>: concentration vs time and
dosing data</li>
</ul></li>
<li><em>conc_predictions_meade2023fDF</em> : simulations with and
without exhalation included in the model, joined with concentration
data.</li>
<li><em>supptab1_meade2023</em>: Supplementary Table 1 which contains
chemical data used for each of the simulated 13 chemicals saved in your
working directory.</li>
<li><em>ivive_meade2023</em> : IVIVE information for part 2 (if
run.simulations.2 = FALSE)</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set whether or not the following chunks will be executed (run):</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>run.simulations <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># Change FALSE to TRUE here to make the vignette work</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>make.plots <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># change to TRUE to make the plots</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>run.simulations<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co">#for second part of vignette</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>make.plots<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># change to TRUE to make the plots</span></span></code></pre></div>
</div>
<div id="set-working-directory-and-install-packages" class="section level3">
<h3>Set working directory and install packages</h3>
<p>Here, we set our working directory (the location of this file and the
necessary data files) and load necessary packages. <strong>Please reset
your working directory below to <code>loc.wd</code> or the code will
produce an error.</strong></p>
<p>We also set the location of the R package <code>httk</code> using the
name <code>loc.httk</code> so that we can run the functions
<code>modelinfo_dermal.R</code> and
<code>modelinfo_dermal_1subcomp.R</code> file later in the code. Note
that if you have <code>run.simulations = FALSE</code>, the variable
<code>loc.httk</code> is not used, so you do not need to provide or
change it.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>loc.wd <span class="ot">&lt;-</span> <span class="st">&quot;C:/Users/jwambaug/OneDrive - Environmental Protection Agency (EPA)/Profile/Documents/Research Projects/DermalTK/vingette&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#loc.wd &lt;- &quot;/Users/ameade/Library/CloudStorage/GoogleDrive-aemeade7@gmail.com/My Drive/EPA/HTTK-Dermal/HTTK-Dermal-Vignette&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#loc.wd = &quot;C:/Users/cschacht/OneDrive - Environmental Protection Agency (EPA)/Profile/Documents/CCTE_2023_2024/dermal/thisone&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set location of httk package</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#loc.httk &lt;- &quot;C:/Users/jwambaug/git/httk-dev/httk&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;httk&quot;</span>,<span class="st">&quot;dplyr&quot;</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tidyverse&quot;</span>,<span class="st">&quot;xlsx&quot;</span>,<span class="st">&quot;Metrics&quot;</span>, <span class="co">#for data manipulation</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;ggplot2&quot;</span>,<span class="st">&quot;ggforce&quot;</span>,<span class="st">&quot;ggpubr&quot;</span>,<span class="st">&quot;ggrepel&quot;</span>,<span class="st">&quot;viridis&quot;</span>, <span class="co">#for plotting</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;ggpubr&quot;</span>,<span class="st">&quot;grid&quot;</span>,<span class="st">&quot;ggh4x&quot;</span>,<span class="st">&quot;readr&quot;</span>,<span class="st">&quot;ggforce&quot;</span>,<span class="st">&quot;knitr&quot;</span>,<span class="st">&quot;tidyr&quot;</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;stringr&quot;</span>) <span class="co">#to make pretty visual tables</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(packages, require, <span class="at">character.only=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: dplyr</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: tidyverse</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ lubridate 1.9.4     ✔ tibble    3.2.1</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ purrr     1.0.4     ✔ tidyr     1.3.1</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ readr     2.1.5     </span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: xlsx</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: Metrics</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: ggforce</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: ggpubr</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: ggrepel</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: viridis</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: viridisLite</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: knitr</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: grid</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: ggh4x</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      httk     dplyr tidyverse      xlsx   Metrics   ggplot2   ggforce    ggpubr </span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE </span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ggrepel   viridis     knitr    ggpubr      grid     ggh4x     readr   ggforce </span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE </span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     knitr     tidyr   stringr </span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      TRUE      TRUE      TRUE</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure we&#39;re using a clean version of the httk chemical library:</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co">#reset_httk()</span></span></code></pre></div>
</div>
</div>
<div id="result-1-model-verification-using-in-vivo-data" class="section level1">
<h1>Result 1: Model Verification using <em>In Vivo</em> Data</h1>
<p>First, we want to verify our model by testing it against <em>in
vivo</em> data from literature.</p>
<div id="step-one-load-data" class="section level2">
<h2>Step One: Load Data</h2>
<p>We have some data which is taken from the CvT Database (<a href="https://doi.org/10.1038%2Fs41597-020-0455-1">Sayre, Wambaugh, and
Grulke, 2020</a>) and some data which has been prepared for the database
but is not yet added to the Database, denoted as <code>noSQL</code>
since it is not yet in the SQL space. The CvT Database contains
structured data in the form of separate datasets linked with foreign
keys (“fk”). Below is the entity-relationship for each of the
databases.</p>
<p>To learn more about where these datasets come from, please see
<code>R_CvT_Database</code> folder, which contains files used to
generate the data below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load CvT table database</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/R_CvT_Database/CvT_all_tables_2022-08-17.Rdata&quot;</span>)) <span class="co">#Necessary file that is not included yet</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load CvT data that is not yet in CvT database (Annabel did this)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/R_CvT_Database/CvT_all_tables_2023-07-05_noSQL.Rdata&quot;</span>)) <span class="co">#Necessary file that is not included yet</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Add cumulative_amount column in SQL DB_series (we don&#39;t use any cumulative amounts from SQL data in final results)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  DB_series <span class="ot">&lt;-</span> DB_series <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cumulative_amount=</span><span class="cn">NA</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind data sets from database and noSQL collection.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>DB_documents_noSQL<span class="ot">&lt;-</span>DB_documents_noSQL[<span class="fu">colnames</span>(DB_documents_noSQL) <span class="sc">%in%</span> <span class="fu">colnames</span>(DB_documents)] <span class="co">#Keep only columns from DB_documents_noSQL that are also found in DB_documents</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>DB_documents <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DB_documents,DB_documents_noSQL)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>DB_studies_noSQL<span class="ot">&lt;-</span>DB_studies_noSQL[<span class="fu">colnames</span>(DB_studies_noSQL) <span class="sc">%in%</span> <span class="fu">colnames</span>(DB_studies)]</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>DB_studies <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DB_studies,DB_studies_noSQL)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>DB_chemicals <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DB_chemicals,DB_chemicals_noSQL)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>DB_subjects <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DB_subjects,DB_subjects_noSQL)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>DB_series <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DB_series,DB_series_noSQL)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>DB_conc_time_values_noSQL<span class="ot">&lt;-</span>DB_conc_time_values_noSQL[<span class="fu">colnames</span>(DB_conc_time_values_noSQL) <span class="sc">%in%</span> <span class="fu">colnames</span>(DB_conc_time_values)]</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>DB_conc_time_values <span class="ot">&lt;-</span> <span class="fu">rbind</span>(DB_conc_time_values,DB_conc_time_values_noSQL)</span></code></pre></div>
<p>Next, we need to clean the data and filter out <code>NA</code>
results. First, we join the needed data sets using their foreign keys. *
<code>DB_conc_time_values</code> * <code>DB_series</code> *
<code>DB_studies</code> * <code>DB_subjects</code> *
<code>DB_documents</code>: Note that only the PubMed ID (PMID) of each
extraction article is saved from this data set.</p>
<p>Next, we remove columns that are duplicated in each data set and are
not used here. These columns in each data set, listed below, tell the
user who created and updated the SQL files and additional comments by
the data curator or article author. * <code>created_by</code> *
<code>updated_by</code> * <code>rec_update_dt</code> *
<code>rec_created_dt</code> * <code>curator_comment</code> *
<code>author_comment</code> ( not in <code>DB_conc_time_values</code> or
<code>DB_subjects</code>) We also remove any data that: * does not have
a defined DTXSID for the chemical * does not have a recorded
concentration * does not have a defined recorded medium (e.g., plasma,
blood, urine, etc.) * where the analyte measured does not match the test
substance used to dose the individual</p>
<p>Finally, after cleaning this data set, called <code>df.full</code>,
we filter so that we only have data for chemicals that have dermal data.
Our final data set is called <code>df</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join necessary DBs: conc_time_values, series, studies, subjects</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.full <span class="ot">&lt;-</span> DB_conc_time_values <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(DB_series,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;fk_series_id&quot;</span><span class="ot">=</span><span class="st">&quot;id&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(DB_studies,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;fk_study_id&quot;</span><span class="ot">=</span><span class="st">&quot;id&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(DB_subjects,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;fk_subject_id&quot;</span><span class="ot">=</span><span class="st">&quot;id&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(DB_documents[,<span class="fu">c</span>(<span class="st">&quot;id&quot;</span>,<span class="st">&quot;pmid&quot;</span>)],<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;fk_extraction_document_id&quot;</span> <span class="ot">=</span> <span class="st">&quot;id&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">extraction_document_pmid=</span>pmid) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>(<span class="fu">ends_with</span>(<span class="st">&quot;.x&quot;</span>) <span class="sc">|</span> <span class="fu">ends_with</span>(<span class="st">&quot;.y&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(test_substance_dtxsid)) <span class="sc">%&gt;%</span> <span class="co">#remove series w/o defined chemicals (Changed from study to series AG)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="sc">!</span><span class="fu">is.na</span>(conc)) <span class="sc">%&gt;%</span> <span class="co">#filter out NA data</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(conc_medium_normalized)) <span class="sc">%&gt;%</span> <span class="co">#remove series w/o defined medium (i.e., plasma, blood, urine, etc.)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(test_substance_dtxsid<span class="sc">==</span>analyte_dtxsid <span class="sc">|</span> <span class="fu">is.na</span>(analyte_dtxsid)) <span class="co">#analyte (measured substance) and test substance must be the same</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>df.full <span class="ot">&lt;-</span> <span class="fu">distinct</span>(df.full)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove empty cells</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>df.full <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(df.full)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>df.full <span class="ot">&lt;-</span> df.full <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(conc))</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of chemicals that have dermal data</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>df.dermal <span class="ot">&lt;-</span> df.full <span class="sc">%&gt;%</span> <span class="fu">filter</span>(administration_route_normalized<span class="sc">==</span><span class="st">&quot;dermal&quot;</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>dermal_dtxsid <span class="ot">&lt;-</span> <span class="fu">unique</span>(df.dermal<span class="sc">$</span>test_substance_dtxsid)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Only keep data for chemicals that have dermal data</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df.full <span class="sc">%&gt;%</span> <span class="fu">filter</span>(test_substance_dtxsid <span class="sc">%in%</span> dermal_dtxsid) </span></code></pre></div>
</div>
<div id="display-which-chemicals-are-being-looked-at" class="section level2">
<h2>Display which chemicals are being looked at</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Chemical =</span> <span class="fu">get_chem_id</span>(<span class="at">dtxsid=</span>test_substance_dtxsid)<span class="sc">$</span>chem.name) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(Chemical,test_substance_dtxsid,extraction_document_pmid,<span class="at">sort=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Number.of.Data.Points =</span> n)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(table)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table, <span class="at">row.names=</span><span class="cn">TRUE</span>,<span class="at">caption=</span><span class="st">&quot;List of chemicals with dermal data before cleaning data.&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(table,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/ChemicalswDermalData.txt&quot;</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<p>Next, We look at several chemical factors with respect to our data.
Thus, we ran a batch search of the 13 chemicals in our study in the
CompTox Dashboard and now load information about these chemicals
(Boiling point, Volatility, etc.) and save this as
‘supptab1_meade2023’.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load chemical info</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>supptab1_meade2023 <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/CCD-Batch-Search_2022-11-29_07_06_35.xlsx&quot;</span>),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sheetName=</span><span class="st">&quot;Main Data&quot;</span>) <span class="co">#A separate download was needed for this file AG 12/6/23</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename chemical properties and change units</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>supptab1_meade2023 <span class="ot">&lt;-</span> supptab1_meade2023 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Water.Solubility.mg.L =</span> WATER_SOLUBILITY_MOL.L_OPERA_PRED<span class="sc">*</span>AVERAGE_MASS<span class="sc">*</span><span class="dv">1000</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">Vapor.Pressure.mmHg =</span> VAPOR_PRESSURE_MMHG_OPERA_PRED,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">Boiling.Point.C =</span> BOILING_POINT_DEGC_OPERA_PRED,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">logP =</span> OCTANOL_WATER_PARTITION_LOGP_OPERA_PRED,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">MW =</span> AVERAGE_MASS,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(PREFERRED_NAME,DTXSID,Water.Solubility.mg.L,Vapor.Pressure.mmHg,Boiling.Point.C,logP,MW))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add column for &quot;Volatility</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>supptab1_meade2023 <span class="ot">&lt;-</span> supptab1_meade2023 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Volatility =</span> <span class="fu">ifelse</span>(Boiling.Point.C<span class="sc">&lt;=</span><span class="dv">75</span>,<span class="st">&quot;Very Volatile&quot;</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="fu">ifelse</span>(Boiling.Point.C<span class="sc">&gt;</span><span class="dv">400</span>,<span class="st">&quot;Not Volatile&quot;</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                                                                               <span class="fu">ifelse</span>((Boiling.Point.C<span class="sc">&gt;=</span><span class="dv">250</span>)<span class="sc">&amp;</span>(Boiling.Point.C<span class="sc">&lt;=</span><span class="dv">400</span>),<span class="st">&quot;Semi-Volatile&quot;</span>,<span class="st">&quot;Volatile&quot;</span>))),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># Rename long chemicals to nick-names</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">PREFERRED_NAME =</span> <span class="fu">ifelse</span>(PREFERRED_NAME<span class="sc">==</span><span class="st">&quot;Methyl tert-butyl ether&quot;</span>,<span class="st">&quot;MBTE&quot;</span>,PREFERRED_NAME),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">PREFERRED_NAME =</span> <span class="fu">ifelse</span>(PREFERRED_NAME<span class="sc">==</span><span class="st">&quot;3,3&#39;,5,5&#39;-Tetrabromobisphenol A&quot;</span>,<span class="st">&quot;Bromdian&quot;</span>,PREFERRED_NAME),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">PREFERRED_NAME =</span> <span class="fu">ifelse</span>(PREFERRED_NAME<span class="sc">==</span><span class="st">&quot;4,4&#39;-Sulfonyldiphenol&quot;</span>,<span class="st">&quot;Bisphenol S&quot;</span>,PREFERRED_NAME),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">PREFERRED_NAME =</span> <span class="fu">ifelse</span>(PREFERRED_NAME<span class="sc">==</span><span class="st">&quot;Dichloromethane&quot;</span>,<span class="st">&quot;DCM&quot;</span>,PREFERRED_NAME),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">PREFERRED_NAME =</span> <span class="fu">ifelse</span>(PREFERRED_NAME<span class="sc">==</span><span class="st">&quot;Tetrachloroethylene&quot;</span>,<span class="st">&quot;PERC/TCE&quot;</span>,PREFERRED_NAME),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">PREFERRED_NAME =</span> <span class="fu">ifelse</span>(PREFERRED_NAME<span class="sc">==</span><span class="st">&quot;1-Methylbenzene&quot;</span>,<span class="st">&quot;Toluene&quot;</span>,PREFERRED_NAME))</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>supptab1_meade2023<span class="sc">$</span>Volatility <span class="ot">&lt;-</span> <span class="fu">factor</span>(supptab1_meade2023<span class="sc">$</span>Volatility, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;Not Volatile&quot;</span>,<span class="st">&quot;Semi-Volatile&quot;</span>,<span class="st">&quot;Volatile&quot;</span>,<span class="st">&quot;Very Volatile&quot;</span>))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#save chemical dataframe</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(supptab1_meade2023,<span class="at">file=</span><span class="fu">paste0</span>(<span class="st">&quot;meade2023_&quot;</span>,<span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%b_%d_%Y&quot;</span>),<span class="st">&quot;.Rdata&quot;</span>))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>supptab1_meade2023[,<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)]<span class="ot">=</span><span class="fu">signif</span>(supptab1_meade2023[,<span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)],<span class="dv">3</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(supptab1_meade2023, </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>             <span class="co">#row.names=TRUE,</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption=</span><span class="st">&quot;Chemical properties&quot;</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">floating.environment=</span><span class="st">&quot;sidewaystable&quot;</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">align=</span><span class="st">&quot;c&quot;</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(supptab1_meade2023,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/ChemicalProperties.txt&quot;</span>),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
<div id="step-two-clean-and-format-data" class="section level2">
<h2>Step Two: Clean and Format Data</h2>
<p>Next we clean the data by looking only at data that can be simulated
using the httk dermal model. First, we load the most recent QSAR in
<em>silico data</em> (<a href="https://doi.org/10.1021/acs.est.1c05924">Dawson et al., 2021</a>)
from <code>httk</code>. #Add a statement about why QSAR values are
needed - there are many chemicals for which httk does not have
experimentally derived Clint and Fup. - AG 01/01/2024</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load_dawson2021</span>() <span class="co">#get QSAR data, overwrite for p-values greater than 0.05</span></span></code></pre></div>
<p>Next, we only load data for routes <code>iv</code>,
<code>oral</code>, and of course <code>dermal</code>. We also must
remove the chemicals: dibromomethane, halothane, and isoflurane, because
these chemicals do not have <em>in silico</em> or <em>in vitro</em> data
to inform necessary parameters for the httk dermal model.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select route (dermal/iv/oral)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>route.ls <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;iv&quot;</span>,<span class="st">&quot;dermal&quot;</span>,<span class="st">&quot;oral&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce data based on available in vitro data</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df.reduced &lt;- df %&gt;% filter(administration_route_normalized %in% route.ls) %&gt;% #only iv, oral, dermal routes</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(test_substance_dtxsid %!in% c(&quot;DTXSID4021557&quot;,&quot;DTXSID4025371&quot;,&quot;DTXSID3020752&quot;)) #no metabolism data for: dibromomethane, halothane, isoflurane</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>df.reduced <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(administration_route_normalized <span class="sc">%in%</span> route.ls) <span class="sc">%&gt;%</span> <span class="co">#only iv, oral, dermal routes</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(test_substance_dtxsid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID4021557&quot;</span>,<span class="st">&quot;DTXSID4025371&quot;</span>,<span class="st">&quot;DTXSID3020752&quot;</span>))) <span class="co">#no metabolism data for: dibromomethane, halothane, isoflurane</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>df.reduced <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(df.reduced) <span class="co">#change dose_level_normalized to numeric </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Join df.reduced with the Volatility/chemical info from supptab1_meade2023</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>df.reduced <span class="ot">=</span> df.reduced <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(supptab1_meade2023,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;test_substance_dtxsid&quot;</span><span class="ot">=</span><span class="st">&quot;DTXSID&quot;</span>))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="ot">=</span><span class="fu">subset</span>(df.reduced, <span class="sc">!</span>(conc_medium_normalized <span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;feces&quot;</span>,<span class="st">&quot;urine&quot;</span>)))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display which chemicals are being looked at</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> df.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chemical =</span> <span class="fu">get_chem_id</span>(<span class="at">dtxsid=</span>test_substance_dtxsid)<span class="sc">$</span>chem.name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(Chemical,test_substance_dtxsid,extraction_document_pmid,conc_medium_normalized,<span class="at">sort=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;Number.of.Data.Points&quot;</span> <span class="ot">=</span> n)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(table)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table, </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">row.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption=</span><span class="st">&quot;List of chemicals with dermal data after cleaning data.&quot;</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(table,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/ChemicalswDermalDataCleaned.txt&quot;</span>),</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<p>Next, we clean up the data so we can match experimental conditions to
simulation conditions. We start by normalizing concentration and
concentration units (where concentration refers to the experimental
concentration vs. time data)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set dummy column for Concentration units </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>conc_normalized <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>conc_units_normalized <span class="ot">=</span> df.reduced<span class="sc">$</span>conc_units_original</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>allset <span class="ot">=</span> <span class="fu">which</span>(df.reduced<span class="sc">$</span>conc_units_original <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ug/mL&quot;</span>,<span class="st">&quot;ug/g&quot;</span>,<span class="st">&quot;mg/kg&quot;</span>, <span class="st">&quot;mcg/mL&quot;</span>,<span class="st">&quot;mg/L&quot;</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>conc_units_normalized[allset]<span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>; df.reduced<span class="sc">$</span>conc_normalized[allset]<span class="ot">=</span>df.reduced<span class="sc">$</span>conc_original[allset]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ngml <span class="ot">=</span> <span class="fu">which</span>(df.reduced<span class="sc">$</span>conc_units_original<span class="sc">==</span><span class="st">&quot;ng/ml&quot;</span>);df.reduced<span class="sc">$</span>conc_normalized[ngml]<span class="ot">=</span>  df.reduced<span class="sc">$</span>conc_original[ngml]<span class="sc">*</span><span class="fl">0.001</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>conc_units_normalized[ngml]<span class="ot">=</span><span class="st">&quot;mg/L&quot;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>ngl <span class="ot">=</span> <span class="fu">which</span>(df.reduced<span class="sc">$</span>conc_units_original<span class="sc">==</span><span class="st">&quot;ng/l&quot;</span>);df.reduced<span class="sc">$</span>conc_normalized[ngl]<span class="ot">=</span>  df.reduced<span class="sc">$</span>conc_original[ngl]<span class="sc">*</span><span class="fl">1e-06</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>conc_units_normalized[ngl]<span class="ot">=</span><span class="st">&quot;mg/L&quot;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>molunts <span class="ot">=</span> <span class="fu">which</span>(df.reduced<span class="sc">$</span>conc_units_original <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;uM&quot;</span>,<span class="st">&quot;nmol/L&quot;</span>,<span class="st">&quot;umol/L&quot;</span>))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>dtx<span class="ot">=</span><span class="fu">unique</span>(df.reduced[molunts,<span class="fu">c</span>(<span class="st">&quot;test_substance_dtxsid&quot;</span>,<span class="st">&quot;conc_units_original&quot;</span>)])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>dtx<span class="sc">$</span>mw <span class="ot">=</span> <span class="fu">get_physchem_param</span>(<span class="at">param=</span><span class="st">&quot;MW&quot;</span>, <span class="at">dtxsid=</span>dtx<span class="sc">$</span>test_substance_dtxsid)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(z <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(dtx)[<span class="dv">1</span>]){</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  these.rows<span class="ot">=</span><span class="fu">which</span>(df.reduced<span class="sc">$</span>test_substance_dtxsid<span class="sc">==</span>dtx<span class="sc">$</span>test_substance_dtxsid[z] <span class="sc">&amp;</span> df.reduced<span class="sc">$</span>conc_units_original<span class="sc">==</span>dtx<span class="sc">$</span>conc_units_original[z])</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  conversion_val <span class="ot">=</span> <span class="fu">convert_units</span>(<span class="at">input.units =</span> dtx<span class="sc">$</span>conc_units_original[z],<span class="at">output.units =</span> <span class="st">&quot;mg/L&quot;</span>,<span class="at">dtxsid=</span>dtx<span class="sc">$</span>test_substance_dtxsid[z])</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  df.reduced[these.rows,<span class="st">&quot;conc_normalized&quot;</span>] <span class="ot">=</span> df.reduced[these.rows,<span class="st">&quot;conc_original&quot;</span>] <span class="sc">*</span> conversion_val</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  df.reduced<span class="sc">$</span>conc_units_normalized[these.rows] <span class="ot">=</span> <span class="st">&quot;mg/L&quot;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>perc.dose<span class="ot">=</span><span class="fu">which</span>(df.reduced<span class="sc">$</span>conc_units_original <span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;% dose&quot;</span>, <span class="st">&quot;% dose/h&quot;</span>))</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>df.reduced[perc.dose, <span class="st">&quot;conc_normalized&quot;</span>]<span class="ot">=</span>df.reduced[perc.dose, <span class="st">&quot;conc_original&quot;</span>]<span class="sc">*</span>df.reduced[perc.dose, <span class="st">&quot;dose_level_original&quot;</span>]</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">#df.reduced[perc.dose,&quot;conc_units_normalized&quot;]=df.reduced[perc.dose,&quot;dose_level_original_units&quot;]</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>df.reduced[perc.dose,<span class="st">&quot;conc_units_normalized&quot;</span>]<span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>                                                                                       </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ppbv</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>ppbv <span class="ot">=</span> <span class="fu">which</span>(df.reduced<span class="sc">$</span>conc_units_original<span class="sc">==</span><span class="st">&quot;ppbv&quot;</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>df.reduced[ppbv, <span class="st">&quot;conc_normalized&quot;</span>] <span class="ot">=</span> <span class="fu">convert_units</span>(<span class="at">input.units =</span> <span class="st">&quot;ppbv&quot;</span>,<span class="at">output.units =</span> <span class="st">&quot;mg/L&quot;</span>,<span class="at">dtxsid=</span><span class="fu">unique</span>(df.reduced<span class="sc">$</span>analyte_dtxsid[ppbv]),<span class="at">state=</span><span class="st">&quot;gas&quot;</span>) <span class="sc">*</span> df.reduced[ppbv, <span class="st">&quot;conc_original&quot;</span>]</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>conc_units_normalized[ppbv] <span class="ot">=</span> <span class="st">&quot;mg/L&quot;</span></span></code></pre></div>
<p>We also convert the dose units from the database to be in amounts
(not concentrations) using the vehicle volumes. After doing this, all
unique dosing scenarios are listed in a table.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ug/mL to mg</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df.reduced <span class="ot">&lt;-</span> df.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(dose_volume,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">into=</span><span class="fu">c</span>(<span class="st">&quot;dose_volume&quot;</span>,<span class="st">&quot;dose_volume_units&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> <span class="co">#separate dose volume into number and units, units either NA or ml/mL</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_volume=</span><span class="fu">as.numeric</span>(dose_volume)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_level_new =</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(<span class="fu">tolower</span>(dose_level_original_units)<span class="sc">==</span><span class="st">&quot;ug/ml&quot;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                  dose_level_original<span class="sc">*</span>dose_volume<span class="sc">/</span><span class="fl">1e+3</span>, <span class="co"># ug &gt;- mg, vol in mL</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                  dose_level_original), <span class="co">#convert ug/ml to mg</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">dose_level_new_units =</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(<span class="fu">tolower</span>(dose_level_original_units)<span class="sc">==</span><span class="st">&quot;ug/ml&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;mg&quot;</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                  dose_level_original_units))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ppm units to mg/L (assuming ppm is in air) - add MW to dataframe to do this</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>df.reduced <span class="ot">&lt;-</span> df.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(chem.physical_and_invitro.data[,<span class="fu">c</span>(<span class="st">&quot;DTXSID&quot;</span>,<span class="st">&quot;MW&quot;</span>)], </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;test_substance_dtxsid&quot;</span><span class="ot">=</span><span class="st">&quot;DTXSID&quot;</span>))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>MW.y<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df.reduced)<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">&quot;MW.x&quot;</span>,<span class="st">&quot;MW&quot;</span>,<span class="fu">colnames</span>(df.reduced)) <span class="co">#fix MW </span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>df.reduced  <span class="ot">=</span> df.reduced <span class="sc">%&gt;%</span> <span class="co">#</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MW =</span> <span class="fu">as.numeric</span>(MW)) <span class="sc">%&gt;%</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(test_substance_dtxsid) <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_level_new =</span> </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(dose_level_original_units<span class="sc">==</span><span class="st">&quot;ppm&quot;</span> ,</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                  dose_level_new <span class="sc">*</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">convert_units</span>(<span class="at">input.units=</span><span class="st">&quot;ppmw&quot;</span>, <span class="co">#?? whatever</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">output.units =</span> <span class="st">&quot;mg/l&quot;</span>,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">MW =</span> <span class="fu">unique</span>(MW)),</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                  dose_level_new),</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>         <span class="co"># dose_level_new = </span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>         <span class="co">#   ifelse(dose_level_original_units==&quot;ppm&quot; &amp; administration_route_original!=&quot;dermal vapor&quot;,</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>         <span class="co">#          dose_level_new *</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>         <span class="co">#            convert_units(input.units=&quot;ppmw&quot;, #?? whatever</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>         <span class="co">#                          output.units = &quot;mg/l&quot;,</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>         <span class="co">#                          MW = unique(MW), state=&quot;liquid&quot;),</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>         <span class="co">#          dose_level_new),</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">dose_level_new_units =</span> </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(<span class="fu">tolower</span>(dose_level_original_units)<span class="sc">==</span><span class="st">&quot;ppm&quot;</span>,</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;mg/L&quot;</span>,</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>                  dose_level_new_units))</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>df.reduced<span class="sc">$</span>dose_level_new_units[<span class="fu">which</span>(df.reduced<span class="sc">$</span>dose_level_new_units<span class="sc">==</span><span class="st">&quot;ppm&quot;</span>)]<span class="ot">=</span><span class="st">&quot;mg/L&quot;</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Set normalized vehicle</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>df.reduced <span class="ot">&lt;-</span> df.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_vehicle_normalized =</span> </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;corn oil&quot;</span>,dose_vehicle) <span class="sc">|</span> </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">grepl</span>(<span class="st">&quot;ethanol&quot;</span>,dose_vehicle),<span class="st">&quot;octanol&quot;</span>, </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(dose_vehicle) <span class="sc">&amp;</span> </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;Cookie&quot;</span>,dose_vehicle),</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;water&quot;</span>,</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">NA</span>)))</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove added chemical MW column for now</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>df.reduced <span class="ot">&lt;-</span> df.reduced <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span>MW)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Display dosing scenarios</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> df.reduced <span class="sc">%&gt;%</span> </span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_level_original=</span><span class="fu">signif</span>(dose_level_original,<span class="dv">3</span>),</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">dose_level_new =</span> <span class="fu">signif</span>(dose_level_new,<span class="dv">3</span>),</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">Chemical =</span> <span class="fu">get_chem_id</span>(<span class="at">dtxsid=</span>test_substance_dtxsid)<span class="sc">$</span>chem.name) <span class="sc">%&gt;%</span> </span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Chemical,dose_level_original,</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>        dose_level_original_units,</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>        dose_level_new,</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>        dose_level_new_units,</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>        dose_volume,</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>        dose_volume_units,</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>        dose_vehicle,</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>        dose_vehicle_normalized,</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>        dermal_applied_area,</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>        dermal_applied_area_units,<span class="at">sort=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Number.of.Data.Points&quot;</span> <span class="ot">=</span> n)</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(table)</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table, </span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>             <span class="co">#row.names=TRUE,</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption=</span><span class="st">&quot;Dosing Scenarios in CvT Data&quot;</span>,</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>             <span class="at">floating.environment=</span><span class="st">&quot;sidewaystable&quot;</span>,</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>             <span class="at">align=</span><span class="st">&quot;c&quot;</span>)</span></code></pre></div>
</div>
<div id="display-which-chemicals-are-being-looked-at-1" class="section level2">
<h2>Display which chemicals are being looked at</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Chemical =</span> <span class="fu">get_chem_id</span>(<span class="at">dtxsid=</span>test_substance_dtxsid)<span class="sc">$</span>chem.name) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(Chemical,test_substance_dtxsid,extraction_document_pmid,<span class="at">sort=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Number.of.Data.Points =</span> n)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(table)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table, <span class="at">row.names=</span><span class="cn">TRUE</span>,<span class="at">caption=</span><span class="st">&quot;List of chemicals with dermal data before cleaning data.&quot;</span>)</span></code></pre></div>
<p>Now, update certain experimental parameters. If body weight is not
reported, set it as the population mean, calculate skin area, and
specify the model output name that corresponds to each medium. Also, we
need to extract dose duration information for explicit values for the
length of duration and the length of duration units (in hours, making
conversions when necessary).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df.new<span class="ot">=</span>df.reduced</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df.new<span class="sc">$</span>species <span class="ot">=</span> <span class="fu">tolower</span>(df.new<span class="sc">$</span>species)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get dose duration in numbers and time units</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>df.new<span class="sc">$</span>dose_duration_num <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(df.new<span class="sc">$</span>dose_duration, <span class="st">&quot;[0-9]+&quot;</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df.new<span class="sc">$</span>dose_duration_units <span class="ot">=</span> <span class="fu">str_extract</span>(df.new<span class="sc">$</span>dose_duration, <span class="st">&quot;[aA-zZ]+&quot;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>df.cases <span class="ot">&lt;-</span> df.new <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">BW =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight_kg),weight_kg,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="fu">case_when</span>(</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                                      species<span class="sc">==</span><span class="st">&quot;rat&quot;</span> <span class="sc">~</span> <span class="fl">0.4</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                                                      species<span class="sc">==</span><span class="st">&quot;human&quot;</span> <span class="sc">~</span> <span class="dv">70</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                                                      species<span class="sc">==</span><span class="st">&quot;mouse&quot;</span> <span class="sc">~</span> <span class="fl">0.025</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                                                      species<span class="sc">==</span><span class="st">&quot;rabbit&quot;</span> <span class="sc">~</span> <span class="fl">1.6</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                                                    )),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># Set human default height to 175 cm if not listed</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">height_cm =</span> <span class="fu">ifelse</span>(species<span class="sc">==</span><span class="st">&quot;human&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(height_cm),<span class="dv">175</span>,height_cm),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">totalSA =</span> <span class="fu">case_when</span>( </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                                          species<span class="sc">==</span><span class="st">&quot;rat&quot;</span> <span class="sc">~</span> <span class="fl">9.83</span><span class="sc">*</span>(BW<span class="sc">*</span><span class="dv">1000</span>)<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>), <span class="co"># formula from Gouma et al., 2012, 195-240grams</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                                          species<span class="sc">==</span><span class="st">&quot;human&quot;</span> <span class="sc">~</span> <span class="fu">sqrt</span>(height_cm <span class="sc">*</span> BW<span class="sc">/</span><span class="dv">3600</span>) <span class="sc">*</span> <span class="dv">100</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                                          species<span class="sc">==</span><span class="st">&quot;mouse&quot;</span> <span class="sc">~</span> <span class="fl">9.83</span><span class="sc">*</span>(BW<span class="sc">*</span><span class="dv">1000</span>)<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                                          species<span class="sc">==</span><span class="st">&quot;rabbit&quot;</span> <span class="sc">~</span> <span class="dv">100</span><span class="sc">*</span><span class="dv">11</span><span class="sc">*</span>(BW)<span class="sc">^</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)  <span class="co"># formula from Tadashi et al., 2018</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                                        ),</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="co">#Assume Fskin_exposed = 10% if not stated</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Fskin_exposed =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(dermal_applied_area),dermal_applied_area<span class="sc">/</span>totalSA,<span class="fl">0.1</span>),</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="co">#Infinite Dose if dosing units are concentration mg/l AJG 4/13/24: Double check that mg/l are listed in the correct places in the previous chunk.</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">InfiniteDose =</span> <span class="fu">ifelse</span>(dose_level_new_units<span class="sc">==</span><span class="st">&quot;mg/L&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="co"># omg</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">Vvehicle =</span> <span class="fu">ifelse</span>(<span class="fu">tolower</span>(dose_volume_units)<span class="sc">==</span><span class="st">&quot;ml&quot;</span>,dose_volume<span class="sc">/</span><span class="fl">1e3</span>,dose_volume),</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                                        <span class="co">#Standardize time units for dose duration AJG 5/7/24</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">dose_duration_units =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                                          dose_duration_units <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;hr&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;hour&quot;</span>,<span class="st">&quot;hrs&quot;</span>,<span class="st">&quot;hours&quot;</span>) <span class="sc">~</span> <span class="st">&quot;hours&quot;</span>,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                                          dose_duration_units <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;min&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;minute&quot;</span>,<span class="st">&quot;minutes&quot;</span>,<span class="st">&quot;mins&quot;</span>) <span class="sc">~</span> <span class="st">&quot;mins&quot;</span>,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                                          dose_duration_units <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;day&quot;</span>,<span class="st">&quot;d&quot;</span>,<span class="st">&quot;days&quot;</span>) <span class="sc">~</span> <span class="st">&quot;days&quot;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                                        ),</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">dose_duration_num2 =</span> <span class="fu">ifelse</span>(dose_duration_units<span class="sc">==</span><span class="st">&quot;mins&quot;</span>, dose_duration_num<span class="sc">/</span><span class="dv">60</span>, dose_duration_num),</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                              <span class="at">dose_duration_units2 =</span> <span class="fu">ifelse</span>(dose_duration_units<span class="sc">==</span><span class="st">&quot;mins&quot;</span>, <span class="st">&quot;hours&quot;</span>, dose_duration_units)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># remove experiments where conc_medium_normalized = feces and set observation to collect</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>df.cases <span class="ot">=</span> <span class="fu">subset</span>(df.cases, <span class="sc">!</span>(conc_medium_normalized <span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;urine&quot;</span>,<span class="st">&quot;feces&quot;</span>)))</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>df.cases <span class="ot">=</span> df.cases<span class="sc">%&gt;%</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_medium_obs =</span> <span class="fu">recode</span>(conc_medium_normalized,</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;blood&quot;</span><span class="ot">=</span><span class="st">&quot;Cven&quot;</span>,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;liver&quot;</span><span class="ot">=</span><span class="st">&quot;Cliver&quot;</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;lung&quot;</span><span class="ot">=</span><span class="st">&quot;Clung&quot;</span>,</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;kidney&quot;</span><span class="ot">=</span><span class="st">&quot;Ckidney&quot;</span>,</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;plasma&quot;</span><span class="ot">=</span><span class="st">&quot;Cplasma&quot;</span>,</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;serum&quot;</span><span class="ot">=</span><span class="st">&quot;Cplasma&quot;</span>,</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;expired air&quot;</span> <span class="ot">=</span> <span class="st">&quot;Aexhaled&quot;</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Display dosing scenarios</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> df.cases <span class="sc">%&gt;%</span> </span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dose_level_original=</span><span class="fu">signif</span>(dose_level_original,<span class="dv">3</span>),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">dose_level_new =</span> <span class="fu">signif</span>(dose_level_new,<span class="dv">3</span>),</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">Chemical =</span> <span class="fu">get_chem_id</span>(<span class="at">dtxsid=</span>test_substance_dtxsid)<span class="sc">$</span>chem.name) <span class="sc">%&gt;%</span> </span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Chemical, species,dose_level_original,</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>        dose_level_original_units,</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>        dose_level_new,</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>        dose_level_new_units,</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>        dose_volume,</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>        dose_volume_units,</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>        dose_vehicle,</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>        dose_vehicle_normalized,</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        dose_duration_num2,</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        dermal_applied_area,</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        dermal_applied_area_units,</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>        extraction_document_pmid,<span class="at">sort=</span>F)</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(table) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(table)</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(table, </span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>             <span class="co">#row.names=TRUE,</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption=</span><span class="st">&quot;Dosing Scenarios in CvT Data&quot;</span>,</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>             <span class="at">floating.environment=</span><span class="st">&quot;sidewaystable&quot;</span>,</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>             <span class="at">align=</span><span class="st">&quot;c&quot;</span>)</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(table,</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/CvTdbDosingScenarios.txt&quot;</span>),</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)  </span></code></pre></div>
<p>Finally, we clarify exhalation (depending on chemical volatility) and
set vehicle volume parameters and save the entire cleaned datasheet as
concentration_data_meade2023.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df.cases_new <span class="ot">=</span> df.cases</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df.cases_new<span class="sc">$</span>Kvehicle2water <span class="ot">=</span> df.cases_new<span class="sc">$</span>dose_vehicle_normalized <span class="co"># set this parameter</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df.cases_new <span class="ot">=</span>  df.cases_new <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">administration_route_normalized =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    administration_route_normalized <span class="sc">==</span> <span class="st">&quot;oral&quot;</span> <span class="sc">~</span> <span class="st">&quot;Oral&quot;</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    administration_route_normalized <span class="sc">==</span> <span class="st">&quot;iv&quot;</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    administration_route_normalized <span class="sc">==</span> <span class="st">&quot;dermal&quot;</span> <span class="sc">~</span> <span class="st">&quot;Dermal&quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Add exhalation for volatile compounds</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Exhalation =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">levels</span>(Volatility)[Volatility] <span class="sc">==</span> <span class="st">&quot;Very Volatile&quot;</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">levels</span>(Volatility)[Volatility] <span class="sc">==</span> <span class="st">&quot;Volatile&quot;</span> <span class="sc">~</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">levels</span>(Volatility)[Volatility] <span class="sc">==</span> <span class="st">&quot;Semi-Volatile&quot;</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">levels</span>(Volatility)[Volatility] <span class="sc">==</span> <span class="st">&quot;Not Volatile&quot;</span> <span class="sc">~</span> <span class="cn">FALSE</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set default vehicle volume when it is unknown. Assume a uniform 1 mm layer of vehicle on skin. Then there is 0.0001 L vehicle per cm^2 of exposed skin. For cases with non-dermal routes of exposure, these values are NA.</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Vvehicle =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>      administration_route_normalized<span class="sc">==</span><span class="st">&quot;Dermal&quot;</span> <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Vvehicle), Vvehicle, Fskin_exposed<span class="sc">*</span>totalSA<span class="sc">*</span><span class="fl">0.0001</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      administration_route_normalized<span class="sc">==</span><span class="st">&quot;Oral&quot;</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>      administration_route_normalized<span class="sc">==</span><span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="cn">NA</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># save what we want</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>concentration_data_meade2023 <span class="ot">=</span> df.cases_new</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>cgwtools<span class="sc">::</span><span class="fu">resave</span>(concentration_data_meade2023,<span class="at">file=</span><span class="fu">paste0</span>(<span class="st">&quot;meade2023_&quot;</span>,<span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%b_%d_%Y&quot;</span>),<span class="st">&quot;.Rdata&quot;</span>))</span></code></pre></div>
</div>
<div id="step-three-simulate-data" class="section level2">
<h2>Step Three: Simulate Data</h2>
<p>Now, we will simulate the <em>in vivo</em> concentration vs time data
using the httk dermal model. Using
<code>concentration_data_meade2023</code>, which is clean and filtered
above, we create a new data set called <code>df.simulations</code> which
will contain simulation data. We simulate 6 different dermal scenarios:
* Potts-Guy, vehicle=octanol * Potts-Guy, vehicle=water * Surrey,
vehicle=octanol * Surrey, vehicle=water * 2 Compartment, vehicle=octanol
* 2 Compartment, vehicle=water</p>
<div id="simulation-set-up" class="section level3">
<h3>Simulation Set-Up</h3>
<p>Specify the units we want returned and set up simulation data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set output units for dermal model to be same as data</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>output.units.original <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&quot;Agut&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Agutlumen&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Aliver&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Aven&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Alung&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Arest&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Akidney&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Atubules&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Ametabolized&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Avehicle&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>, <span class="st">&quot;Ain&quot;</span><span class="ot">=</span><span class="st">&quot;mg&quot;</span>,  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Cgut&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Cliver&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Cven&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Clung&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Cart&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Crest&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Ckidney&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Cplasma&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Cvehicle&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>, <span class="st">&quot;Cvehicle_infinite&quot;</span><span class="ot">=</span><span class="st">&quot;mg/L&quot;</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>df.simulation <span class="ot">=</span> concentration_data_meade2023</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Find experiments with unique dosing regimes/species/etc and average those that had multiple time points</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for the same type of experiment. Rename each experiment with new_id.</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>keep.cols<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;PREFERRED_NAME&quot;</span>,<span class="st">&quot;test_substance_dtxsid&quot;</span>, <span class="st">&quot;conc_medium_obs&quot;</span>, <span class="st">&quot;conc_medium_normalized&quot;</span>, <span class="st">&quot;administration_route_normalized&quot;</span>, <span class="st">&quot;species&quot;</span>, <span class="st">&quot;BW&quot;</span>, <span class="st">&quot;dose_level_new&quot;</span>, <span class="st">&quot;dose_level_new_units&quot;</span>,<span class="st">&quot;totalSA&quot;</span>,<span class="st">&quot;Vvehicle&quot;</span>,<span class="st">&quot;InfiniteDose&quot;</span>,<span class="st">&quot;dose_duration_num2&quot;</span>,<span class="st">&quot;dose_duration_units2&quot;</span>,<span class="st">&quot;Fskin_exposed&quot;</span>,<span class="st">&quot;Exhalation&quot;</span>,<span class="st">&quot;dose_vehicle_normalized&quot;</span>,<span class="st">&quot;Water.Solubility.mg.L&quot;</span>, <span class="st">&quot;Vapor.Pressure.mmHg&quot;</span>,<span class="st">&quot;Boiling.Point.C&quot;</span>,<span class="st">&quot;logP&quot;</span>, <span class="st">&quot;Volatility&quot;</span>, <span class="st">&quot;Kvehicle2water&quot;</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>df.simulation_red<span class="ot">=</span><span class="fu">data.frame</span>(df.simulation<span class="sc">%&gt;%</span><span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;time_hr&quot;</span>,keep.cols) )))<span class="sc">%&gt;%</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">conc_normalized=</span><span class="fu">mean</span>(conc_normalized),<span class="at">.groups=</span><span class="st">&quot;drop&quot;</span>)<span class="sc">%&gt;%</span><span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(keep.cols)))<span class="sc">%&gt;%</span> <span class="fu">arrange</span>(time_hr)<span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">new_id=</span><span class="fu">cur_group_id</span>())<span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>())</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>df.simulation_red2<span class="ot">=</span>df.simulation_red<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(dose_duration_num2,dose_duration_units2,Vvehicle),<span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x),<span class="fu">list</span>(<span class="cn">NULL</span>),.x)))</span></code></pre></div>
</div>
<div id="simulations-nested-for-loops" class="section level3">
<h3>Simulations: Nested For Loops</h3>
<p>We have nested for loops to account for each aspect of the data that
needs to be simulated. Each ID number (or “new_id”) in
df.simulation_red2 corresponds to a single experiment (or experiment
with averaged concentration data if the subject species, dose, route,
etc. was the same), where we have defined the necessary variables:
species, chemical, dose, dose duration (when applicable), whether or not
an Infinite dose is applicable, route of exposure, the collected
medium/tissue being sampled (i.e., plasma, blood, liver) and subject
parameters such as body mass (kg) and surface area of skin. Thus, we run
through each unique ID and first parameterize the model using
parameterize_dermal_pbtk() and then solve the model using
solve_dermal_pbtk(). For each ID, we simulate each permeability method
(Surrey and Potts-Guy); for each ID/permeability method, we simulate
either a water or octanol vehicle; then for each combination, we
simulate the model both with and without exhalation. Note that some
experimental data indicate the vehicle used, but we still test both
vehicles for simulation to compare. Likewise, we calculated volatility
for each chemical (which indicate whether or not exhalation actually
occurs), but we still generate for all options. Note that
solve_dermal_pbtk() can handle IV or oral exposure by setting the
“route” input variable. Each model output is saved to a list called
conc_predictions_meade2023LIST. Then this list is converted to a data
frame.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.run.sims <span class="ot">=</span> df.simulation_red2</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fkID <span class="ot">=</span> <span class="fu">unique</span>(df.run.sims<span class="sc">$</span>new_id)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>method.perm <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Potts-Guy&quot;</span>, <span class="st">&quot;UK-Surrey&quot;</span>)<span class="co"># for</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>Kvehicle2water<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;octanol&quot;</span>,<span class="st">&quot;water&quot;</span>) <span class="co"># for</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>exhalation_for_simulation <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span>,<span class="st">&quot;FALSE&quot;</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>conc_predictions_meade2023LIST<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (include.e <span class="cf">in</span> exhalation_for_simulation){</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fkID)){</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(mp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(method.perm)){</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Kvehicle2water)){</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        sub.df <span class="ot">=</span> <span class="fu">subset</span>(df.run.sims, new_id <span class="sc">==</span> fkID[i])</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        specs <span class="ot">=</span> <span class="fu">unique</span>(sub.df[,<span class="fu">c</span>(<span class="st">&quot;test_substance_dtxsid&quot;</span>,<span class="st">&quot;conc_medium_obs&quot;</span>,<span class="st">&quot;administration_route_normalized&quot;</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;species&quot;</span>,<span class="st">&quot;BW&quot;</span>,<span class="st">&quot;dose_level_new&quot;</span>,<span class="st">&quot;dose_level_new_units&quot;</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;totalSA&quot;</span>,<span class="st">&quot;Vvehicle&quot;</span>,<span class="st">&quot;InfiniteDose&quot;</span>,<span class="st">&quot;dose_duration_num2&quot;</span>,<span class="st">&quot;dose_duration_units2&quot;</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;Fskin_exposed&quot;</span>,<span class="st">&quot;Exhalation&quot;</span>)])</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># check for experiments with only 1 timepoint and reset sub.df</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(sub.df<span class="sc">$</span>time_hr)<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>            sub.df<span class="ot">=</span><span class="fu">rbind</span>(sub.df, sub.df[<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">1</span>),])</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>            sub.df[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">&quot;conc_normalized&quot;</span>,<span class="st">&quot;time_hr&quot;</span>)]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        parms <span class="ot">=</span> <span class="fu">parameterize_dermal_pbtk</span>(<span class="at">dtxsid =</span> specs<span class="sc">$</span>test_substance_dtxsid,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">species =</span> specs<span class="sc">$</span>species,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">totalSA =</span> specs<span class="sc">$</span>totalSA,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">default.to.human=</span>T,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Kvehicle2water =</span> Kvehicle2water[k],</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">InfiniteDose =</span> specs<span class="sc">$</span>InfiniteDose,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">method.permeability =</span> method.perm[mp],</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>                                 </span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">model.type=</span><span class="st">&quot;dermal_1subcomp&quot;</span>,</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">clint.pvalue.threshold =</span> <span class="cn">Inf</span>,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">suppress.messages =</span> T</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        parms<span class="sc">$</span>BW <span class="ot">=</span> specs<span class="sc">$</span>BW</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>        parms<span class="sc">$</span>Fskin_exposed <span class="ot">=</span> specs<span class="sc">$</span>Fskin_exposed</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove exhalation or keep exhalation (except for collected air which is )</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(include.e <span class="sc">==</span> <span class="cn">FALSE</span>) {parms<span class="sc">$</span>Qalvc <span class="ot">=</span> <span class="dv">0</span>}</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">unique</span>(sub.df<span class="sc">$</span>PREFERRED_NAME<span class="sc">!=</span><span class="st">&quot;DCM&quot;</span>))</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>          { <span class="co"># tolerance is bad for DCM, so set tolerance to default values for all other compounds.</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>           rtol<span class="ot">=</span><span class="fl">1e-5</span>; atol<span class="ot">=</span><span class="fl">1e-5</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span>{</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>           rtol<span class="ot">=</span><span class="fl">1e-4</span>; atol<span class="ot">=</span><span class="fl">1e-4</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>        sub.df<span class="ot">=</span>sub.df[<span class="fu">order</span>(sub.df<span class="sc">$</span>time_hr),]</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>        timey <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="dv">0</span>,sub.df<span class="sc">$</span>time_hr)) <span class="co">#time in hours</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gc</span>() <span class="co"># garbage collection (memory)</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>        ok<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">solve_dermal_pbtk</span>(<span class="at">parameters =</span> parms,</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>                        <span class="at">times =</span> timey<span class="sc">/</span><span class="dv">24</span>, <span class="co">#convert to days</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>                         <span class="at">route =</span> <span class="fu">tolower</span>(specs<span class="sc">$</span>administration_route_normalized),</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>                         <span class="at">model.type=</span><span class="st">&quot;dermal_1subcomp&quot;</span>,</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>                         <span class="at">output.units =</span> output.units.original,</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">washoff =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>                         <span class="at">input.units =</span> specs<span class="sc">$</span>dose_level_new_units,</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>                         <span class="at">initial.dose=</span>specs<span class="sc">$</span>dose_level_new,</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dose.duration =</span> <span class="fu">unlist</span>(specs<span class="sc">$</span>dose_duration_num2),</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dose.duration.units =</span> <span class="fu">unlist</span>(specs<span class="sc">$</span>dose_duration_units2),</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Vvehicle =</span> <span class="fu">unlist</span>(specs<span class="sc">$</span>Vvehicle),</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>                        <span class="co">#dosing.dermal = dosing.dermal,</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Kvehicle2water =</span> Kvehicle2water[k],</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>                         <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>                        <span class="at">atol =</span> atol, <span class="at">rtol=</span> rtol,</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method=</span><span class="st">&quot;lsoda&quot;</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>                         ))</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>         <span class="co"># extract only times we need</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>          ok.time <span class="ot">=</span> <span class="fu">subset</span>(ok, time<span class="sc">%in%</span><span class="fu">c</span>(ok<span class="sc">$</span>time[<span class="sc">!</span>(<span class="fu">is.na</span>(<span class="fu">match</span>(ok<span class="sc">$</span>time, sub.df<span class="sc">$</span>time_hr<span class="sc">/</span><span class="dv">24</span>)))]))</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>          sub.df<span class="sc">$</span>Prediction <span class="ot">=</span> ok.time[,<span class="fu">c</span>(specs<span class="sc">$</span>conc_medium_obs)]</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>          sub.df<span class="sc">$</span>exhalation_for_simulation <span class="ot">=</span> include.e</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>          <span class="co"># specify vehicle and perm. method and vehicle if dermal</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(specs<span class="sc">$</span>administration_route_normalized <span class="sc">!=</span> <span class="st">&quot;Dermal&quot;</span>){</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>            sub.df<span class="sc">$</span>method.perm <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>            sub.df<span class="sc">$</span>Kvehicle2water <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>            sub.df<span class="sc">$</span>method.name <span class="ot">=</span> specs<span class="sc">$</span>administration_route_normalized</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span>{</span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>            sub.df<span class="sc">$</span>method.perm <span class="ot">=</span> method.perm[mp]</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>            sub.df<span class="sc">$</span>Kvehicle2water <span class="ot">=</span> Kvehicle2water[k]</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>            sub.df<span class="sc">$</span>method.name <span class="ot">=</span> <span class="fu">paste</span>(method.perm[mp], <span class="st">&quot;- vehicle = &quot;</span>, Kvehicle2water[k])</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>        conc_predictions_meade2023LIST[[<span class="fu">paste0</span>(fkID[i],<span class="st">&quot;.&quot;</span>,Kvehicle2water[k],<span class="st">&quot;.&quot;</span>,method.perm[mp],<span class="st">&quot;.exh&quot;</span>,include.e)]]<span class="ot">=</span> sub.df</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="co">#Bind data together to create a dataframe and organize some columns</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a> conc_predictions_meade2023DF <span class="ot">=</span> <span class="fu">do.call</span>(rbind, conc_predictions_meade2023LIST) </span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a> <span class="fu">rownames</span>(conc_predictions_meade2023DF)<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a> cgwtools<span class="sc">::</span><span class="fu">resave</span>(conc_predictions_meade2023DF, conc_predictions_meade2023LIST, <span class="at">file=</span><span class="fu">paste0</span>(<span class="st">&quot;meade2023_&quot;</span>,<span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%b_%d_%Y&quot;</span>),<span class="st">&quot;.Rdata&quot;</span>))</span></code></pre></div>
<p>Now, if run.simulations = FALSE, we must load data. This load
supptab1_meade2023, concentration_data_meade2023,
conc_predictions_meade2023DF, conc_predictions_meade2023LIST.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">paste0</span>(loc.wd, <span class="st">&quot;/meade2023_Jun_13_2025.Rdata&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="step-four-calculate-root-mean-squared-log10-errors-rmsle" class="section level2">
<h2>Step Four: Calculate Root Mean Squared Log10 Errors (RMSLE)</h2>
<p>Now, we want to get the RMSLE for each chemical, comparing the model
to the data. Let us group by chemical, method, and whether or not we
include exhalation.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>conc_predictions_meade2023DF<span class="sc">$</span>method.perm <span class="ot">=</span> <span class="fu">gsub</span>( <span class="st">&quot;UK-Surrey&quot;</span>,<span class="st">&quot;Surrey&quot;</span>, conc_predictions_meade2023DF<span class="sc">$</span>method.perm)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>conc_predictions_meade2023DF<span class="sc">$</span>method.name <span class="ot">=</span> <span class="fu">gsub</span>( <span class="st">&quot;UK-Surrey&quot;</span>,<span class="st">&quot;Surrey&quot;</span>, conc_predictions_meade2023DF<span class="sc">$</span>method.name)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df.sim <span class="ot">=</span> conc_predictions_meade2023DF</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert aexhaled air from mg to mg/l (assume a room of x liters, for humans - humans </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the only species in these exhaled experiments)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>df.sim[<span class="fu">which</span>(df.sim<span class="sc">$</span>conc_medium_obs<span class="sc">==</span><span class="st">&quot;Aexhaled&quot;</span>),<span class="st">&quot;Prediction&quot;</span>]<span class="ot">=</span>df.sim[<span class="fu">which</span>(df.sim<span class="sc">$</span>conc_medium_obs<span class="sc">==</span><span class="st">&quot;Aexhaled&quot;</span>),<span class="st">&quot;Prediction&quot;</span>]<span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>df.sim<span class="sc">$</span>conc_normalized[<span class="fu">which</span>(df.sim<span class="sc">$</span>conc_normalized<span class="sc">==</span><span class="dv">0</span>)]<span class="ot">=</span><span class="fl">1e-10</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>df.sim<span class="sc">$</span>Prediction[<span class="fu">which</span>(df.sim<span class="sc">$</span>Prediction<span class="sc">==</span><span class="dv">0</span>)]<span class="ot">=</span><span class="fl">1e-10</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>df.sim.rmsle<span class="ot">=</span>df.sim <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PREFERRED_NAME, method.name, exhalation_for_simulation)<span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cmax_obs =</span> <span class="fu">max</span>(conc_normalized), <span class="at">cmax_pred=</span><span class="fu">max</span>(Prediction)) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(conc_normalized),<span class="fu">log10</span>(Prediction)),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cmax_RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(cmax_obs), <span class="fu">log10</span>(cmax_pred)))</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear fit</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>ddf.sim.rmsle <span class="ot">&lt;-</span> df.sim.rmsle <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(method.name) <span class="sc">%&gt;%</span> <span class="fu">do</span>(</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    Adjusted.R2 <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.))<span class="sc">$</span>adj.r.squared</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    Coefficient <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    Intercept <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    Residuals <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>residuals</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    Fitted.Values <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>fitted.values</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(.,Adjusted.R2,Coefficient,Intercept,Residuals,Fitted.Values)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="step-five-plot-simulations" class="section level2">
<h2>Step Five: Plot Simulations</h2>
<p>Let us compare the RMSLE and the volatility (i.e., boiling point) for
each compound (assuming exhalation).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot RMSLE vs Boiling Point</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">subset</span>(df.sim.rmsle, exhalation_for_simulation<span class="sc">==</span><span class="cn">TRUE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>data<span class="ot">=</span>data<span class="sc">%&gt;%</span><span class="fu">group_by</span>(PREFERRED_NAME, Boiling.Point.C,method.name)<span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Chemical.cmax.RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(cmax_obs),<span class="fu">log10</span>(cmax_pred)),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Chemical.RMSLE=</span><span class="fu">rmse</span>(<span class="fu">log10</span>(conc_normalized),<span class="fu">log10</span>(Prediction)))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>data.rect <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">xmin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">75</span>,<span class="dv">250</span>,<span class="dv">400</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmax=</span><span class="fu">c</span>(<span class="dv">75</span>,<span class="dv">250</span>,<span class="dv">400</span>,<span class="cn">Inf</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymin=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax=</span><span class="fu">rep</span>(<span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Volatility=</span><span class="fu">c</span>(<span class="st">&quot;Very Volatile&quot;</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Volatile&quot;</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Semi-Volatile&quot;</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Not Volatile&quot;</span>))</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>data.rect<span class="sc">$</span>Volatility <span class="ot">&lt;-</span> <span class="fu">factor</span>(data.rect<span class="sc">$</span>Volatility, <span class="at">levels=</span>data.rect<span class="sc">$</span>Volatility)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>viridis.colors <span class="ot">&lt;-</span> <span class="fu">viridis</span>(<span class="dv">4</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Boiling.Point.C</span><span class="st">`</span>,<span class="at">y=</span>Chemical.RMSLE)) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>,<span class="at">formula=</span><span class="st">&#39;y~x&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Boiling.Point.C</span><span class="st">`</span>,<span class="at">y=</span>Chemical.RMSLE,<span class="at">label=</span>PREFERRED_NAME),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max.overlaps=</span><span class="cn">Inf</span>)<span class="sc">+</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>method.name,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_x_log10() +</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data=</span>data.rect,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin=</span>xmin,<span class="at">xmax=</span>xmax,<span class="at">ymin=</span>ymin,<span class="at">ymax=</span>ymax,<span class="at">fill=</span>Volatility),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Not Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">1</span>],</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Semi-Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">2</span>],</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">3</span>],</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Very Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">4</span>]))<span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;RMSLE&quot;</span>,<span class="at">title=</span><span class="st">&quot;Boiling Point vs. RMSLE&quot;</span>,<span class="at">x=</span><span class="st">&quot;Boiling Point (C)&quot;</span>)<span class="sc">+</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">33</span>),</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/BPvsRMSLE_suppl.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Boiling.Point.C</span><span class="st">`</span>,<span class="at">y=</span>Chemical.cmax.RMSLE)) <span class="sc">+</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>,<span class="at">formula=</span><span class="st">&#39;y~x&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>data,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Boiling.Point.C</span><span class="st">`</span>,<span class="at">y=</span>Chemical.cmax.RMSLE,<span class="at">label=</span>PREFERRED_NAME),</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max.overlaps=</span><span class="cn">Inf</span>)<span class="sc">+</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>method.name,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_x_log10() +</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data=</span>data.rect,</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin=</span>xmin,<span class="at">xmax=</span>xmax,<span class="at">ymin=</span>ymin,<span class="at">ymax=</span>ymax,<span class="at">fill=</span>Volatility),</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Not Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">1</span>],</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Semi-Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">2</span>],</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">3</span>],</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Very Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">4</span>]))<span class="sc">+</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;RMSLE&quot;</span>,<span class="at">title=</span><span class="st">&quot;Boiling Point vs. Cmax RMSLE&quot;</span>,<span class="at">x=</span><span class="st">&quot;Boiling Point (C)&quot;</span>)<span class="sc">+</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">33</span>),</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="co">#annotate_figure(plot2,top=text_grob(&quot;Boiling Point vs RMSLE&quot;,size=40,face=&quot;bold&quot;))</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/BPvsRMSLE_cmax_suppl.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
<p>Now, we compare simulations with exhalation to those without
exhalation (as a function of boiling point).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.exh.compare<span class="ot">=</span>df.sim.rmsle</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>Exh <span class="ot">=</span> <span class="fu">data.frame</span>(df.exh.compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PREFERRED_NAME,method.name, Boiling.Point.C)<span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(exhalation_for_simulation) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Cmax=</span>Cmax_RMSLE[exhalation_for_simulation<span class="sc">==</span><span class="cn">FALSE</span>]<span class="sc">-</span>Cmax_RMSLE[exhalation_for_simulation<span class="sc">==</span><span class="cn">TRUE</span>], <span class="at">Full_time_course =</span> RMSLE[exhalation_for_simulation<span class="sc">==</span><span class="cn">FALSE</span>]<span class="sc">-</span>RMSLE[exhalation_for_simulation<span class="sc">==</span><span class="cn">TRUE</span>]))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>Exh<span class="sc">$</span>method.name<span class="ot">=</span> <span class="fu">sub</span>(<span class="st">&quot; - &quot;</span>, <span class="st">&quot; -</span><span class="sc">\n</span><span class="st">&quot;</span>, Exh<span class="sc">$</span>method.name)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#stack data</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>stackExh <span class="ot">=</span> <span class="fu">data.frame</span>(Exh <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;Cmax&quot;</span>, <span class="st">&quot;Full_time_course&quot;</span>), </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;ind&quot;</span>, </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;values&quot;</span>))</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>data.text <span class="ot">=</span> <span class="fu">unique</span>(stackExh[,<span class="fu">c</span>(<span class="st">&quot;Boiling.Point.C&quot;</span>,<span class="st">&quot;values&quot;</span>,<span class="st">&quot;PREFERRED_NAME&quot;</span>,<span class="st">&quot;ind&quot;</span>,<span class="st">&quot;method.name&quot;</span>)])</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>data.rect <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">xmin=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">75</span>,<span class="dv">250</span>,<span class="dv">400</span>),</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmax=</span><span class="fu">c</span>(<span class="dv">75</span>,<span class="dv">250</span>,<span class="dv">400</span>,<span class="cn">Inf</span>),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymin=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax=</span><span class="fu">rep</span>(<span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Volatility=</span><span class="fu">c</span>(<span class="st">&quot;Very Volatile&quot;</span>,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Volatile&quot;</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Semi-Volatile&quot;</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Not Volatile&quot;</span>))</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>data.rect<span class="sc">$</span>Volatility <span class="ot">&lt;-</span> <span class="fu">factor</span>(data.rect<span class="sc">$</span>Volatility, </span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels=</span>data.rect<span class="sc">$</span>Volatility)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>viridis.colors <span class="ot">&lt;-</span> <span class="fu">viridis</span>(<span class="dv">4</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co"># rename labels for facets</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co"># labeller=labeller(ind = c(Cmax=&quot;Cmax&quot;,</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="co">#               Full_time_course = &quot;Full time-course&quot;))</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>stackExh,<span class="fu">aes</span>(<span class="at">x=</span>Boiling.Point.C,<span class="at">y=</span>values)) <span class="sc">+</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span> <span class="co">#geom_line()+</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(ind<span class="sc">~</span>method.name, <span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">labeller=</span><span class="fu">labeller</span>(<span class="at">ind =</span> <span class="fu">c</span>(<span class="at">Cmax=</span><span class="st">&quot;Cmax&quot;</span>,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">Full_time_course =</span> <span class="st">&quot;Full time-course&quot;</span>)))<span class="sc">+</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data=</span>data.rect,</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin=</span>xmin,<span class="at">xmax=</span>xmax,<span class="at">ymin=</span>ymin,<span class="at">ymax=</span>ymax,<span class="at">fill=</span>Volatility),</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Not Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">1</span>],</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Semi-Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">2</span>],</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">3</span>],</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Very Volatile</span><span class="st">`</span><span class="ot">=</span>viridis.colors[<span class="dv">4</span>]))<span class="sc">+</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>data.text,<span class="fu">aes</span>(<span class="at">x=</span>Boiling.Point.C,<span class="at">y=</span>values,<span class="at">label=</span>PREFERRED_NAME),</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max.overlaps=</span><span class="cn">Inf</span>)<span class="sc">+</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#facet_grid(cols=vars(Route.or.Method.if.Dermal), rows=vars(RMSLE.Type),scales=&quot;free_y&quot;)+</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_x_log10() +</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept=</span><span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">expression</span>(Delta<span class="sc">~</span><span class="st">&quot;RMSLE&quot;</span>),<span class="at">x=</span><span class="st">&quot;Boiling Point (C)&quot;</span>,<span class="at">title=</span><span class="st">&quot;Change in RMSLE when Exhalation is Added&quot;</span>)<span class="sc">+</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">type=</span><span class="st">&quot;qual&quot;</span>,<span class="at">palette=</span><span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>,<span class="at">vjust=</span><span class="dv">1</span>,<span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>),</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>plot</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/BP_RMSLE_Exhalation_main.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a><span class="co"># P-values for regression lines</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>stackExhStats <span class="ot">=</span> stackExh<span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ind, method.name) <span class="sc">%&gt;%</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="fu">lm</span>(values<span class="sc">~</span>Boiling.Point.C, <span class="at">data=</span><span class="fu">cur_data</span>())),</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups=</span><span class="st">&quot;drop&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">msummary=</span><span class="fu">list</span>(<span class="fu">summary</span>(model)),</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">rsquared=</span>msummary<span class="sc">$</span>r.squared,</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_val=</span> <span class="fu">pf</span>(msummary<span class="sc">$</span>fstatistic[<span class="dv">1</span>], msummary<span class="sc">$</span>fstatistic[<span class="dv">2</span>], msummary<span class="sc">$</span>fstatistic[<span class="dv">3</span>], <span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">%&gt;%</span><span class="fu">select</span>(ind,method.name,rsquared,p_val)</span></code></pre></div>
<p>Now, let’s generate CvT plots for each chemical and color by whether
or not exhalation was included.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df.sim2 <span class="ot">=</span> df.sim.rmsle</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>chem <span class="ot">=</span> <span class="fu">unique</span>(df.sim2<span class="sc">$</span>PREFERRED_NAME)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(chx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(chem)){</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  each.chem <span class="ot">=</span> <span class="fu">subset</span>(df.sim2, PREFERRED_NAME<span class="sc">==</span>chem[chx])</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#each.chem$dose = paste(each.chem$dose_level_new, each.chem$dose_level_new_units)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  each.chem<span class="sc">$</span>dose<span class="ot">=</span><span class="fu">paste</span>(each.chem<span class="sc">$</span>dose_level_new, each.chem<span class="sc">$</span>dose_level_new_units)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># each.chem$dose = factor(each.chem$dose,</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                         levels=unique(each.chem$dose)[order(unique(each.chem$dose_level_new))])</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  each.chem<span class="sc">$</span>method.name<span class="ot">=</span> <span class="fu">sub</span>(<span class="st">&quot; - &quot;</span>, <span class="st">&quot; -</span><span class="sc">\n</span><span class="st">&quot;</span>, each.chem<span class="sc">$</span>method.name)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  each.chem<span class="sc">$</span>subject<span class="ot">=</span><span class="fu">paste</span>(each.chem<span class="sc">$</span>species, <span class="st">&quot;BW&quot;</span>,each.chem<span class="sc">$</span>BW, <span class="st">&quot;kg&quot;</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(each.chem)<span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data=</span>each.chem, <span class="fu">aes</span>(<span class="at">x=</span>time_hr, <span class="at">y=</span>conc_normalized,<span class="at">colour=</span>dose))<span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data=</span>each.chem, <span class="fu">aes</span>(<span class="at">x=</span>time_hr, <span class="at">y=</span>Prediction,<span class="at">colour=</span>dose,<span class="at">linetype=</span>exhalation_for_simulation),<span class="at">linewidth=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste</span>(chem[chx], <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Log-transformed Concentrations v time&quot;</span>), <span class="at">x=</span><span class="st">&quot; Time (hr)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Log Concentrations (mg/L)&quot;</span>, <span class="at">colour=</span><span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_nested</span>(<span class="sc">~</span>conc_medium_normalized<span class="sc">+</span>method.name,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/cvt_eachchem_by_exhalation_suppl&quot;</span>, <span class="fu">unique</span>(each.chem<span class="sc">$</span>test_substance_dtxsid),<span class="st">&quot;.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div>
<p>Now plot the data in Predicted vs Observed (PvO) plots for each of
the 13 chemicals. First, we extract only simulated results that match
the correct exhalation conditions by finding simulations where
exhalation_for_simulations = T if Exhalation (which was calculated from
volatility parameters), is TRUE and FALSE if FALSE.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.new <span class="ot">=</span> <span class="fu">subset</span>(df.sim.rmsle, exhalation_for_simulation<span class="sc">==</span>Exhalation)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>chem <span class="ot">=</span> <span class="fu">unique</span>(df.new<span class="sc">$</span>PREFERRED_NAME)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(chx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(chem)){</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  each.chem <span class="ot">=</span> <span class="fu">subset</span>(df.new, PREFERRED_NAME<span class="sc">==</span>chem[chx])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#each.chem$dose = paste(each.chem$dose_level_new, each.chem$dose_level_new_units)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  each.chem<span class="sc">$</span>dose<span class="ot">=</span><span class="fu">paste</span>(each.chem<span class="sc">$</span>dose_level_new, each.chem<span class="sc">$</span>dose_level_new_units)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  each.chem<span class="sc">$</span>dose <span class="ot">=</span> <span class="fu">factor</span>(each.chem<span class="sc">$</span>dose,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels=</span><span class="fu">unique</span>(each.chem<span class="sc">$</span>dose)[<span class="fu">order</span>(<span class="fu">unique</span>(each.chem<span class="sc">$</span>dose_level_new))])</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  each.chem<span class="sc">$</span>method.name<span class="ot">=</span> <span class="fu">sub</span>(<span class="st">&quot; - &quot;</span>, <span class="st">&quot; -</span><span class="sc">\n</span><span class="st">&quot;</span>, each.chem<span class="sc">$</span>method.name)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  each.chem<span class="sc">$</span>subject<span class="ot">=</span><span class="fu">paste</span>(each.chem<span class="sc">$</span>species, <span class="st">&quot;BW&quot;</span>,each.chem<span class="sc">$</span>BW, <span class="st">&quot;kg&quot;</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(each.chem, <span class="fu">aes</span>(<span class="at">x=</span>conc_normalized,<span class="at">y=</span>Prediction))<span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>dose,<span class="at">shape=</span>conc_medium_normalized))<span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste</span>(chem[chx], <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Log-transformed Concentrations&quot;</span>), <span class="at">x=</span><span class="st">&quot;Observed Concentrations (mg/L)&quot;</span>, <span class="at">x=</span><span class="st">&quot;Predicted Concentrations (mg/L)&quot;</span>, <span class="at">colour=</span><span class="st">&quot;&quot;</span>, <span class="at">shape=</span><span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#facet_wrap(~dose,scales=&quot;free&quot;)+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>method.name,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>,<span class="at">formula=</span><span class="st">&#39;y~x&#39;</span>,<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_abline</span>(<span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>     <span class="co">#geom_smooth(aes(color=method.name),method=&#39;lm&#39;,formula=&#39;y~x&#39;)+</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">13</span>))</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#theme(legend.position = &quot;bottom&quot;)</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/pvo_bydose_suppl&quot;</span>, <span class="fu">unique</span>(each.chem<span class="sc">$</span>test_substance_dtxsid),<span class="st">&quot;.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear fit for these.</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>linear.fit.new <span class="ot">&lt;-</span> df.new <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(method.name) <span class="sc">%&gt;%</span> <span class="fu">do</span>(</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    Adjusted.R2 <span class="ot">=</span> <span class="fu">summary</span>(<span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.))<span class="sc">$</span>adj.r.squared</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    Coefficient <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    Intercept <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    Residuals <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>residuals</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    Fitted.Values <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized),<span class="at">data=</span>.)<span class="sc">$</span>fitted.values</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(.,Adjusted.R2,Coefficient,Intercept,Residuals,Fitted.Values)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSLE grouped by method type</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>rmsle.all <span class="ot">=</span> df.new<span class="sc">%&gt;%</span><span class="fu">group_by</span>(method.name)<span class="sc">%&gt;%</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(  <span class="at">Adjusted.R2 =</span> <span class="fu">summary</span>(<span class="fu">lm</span>(<span class="fu">log10</span>(Prediction) <span class="sc">~</span> <span class="fu">log10</span>(conc_normalized)))<span class="sc">$</span>adj.r.squared,</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>              <span class="at">RMSLE_total =</span><span class="fu">rmse</span>(<span class="fu">log10</span>(Prediction),<span class="fu">log10</span>(conc_normalized)),</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>                <span class="at">CMAX_RMSLE_total =</span><span class="fu">rmse</span>(<span class="fu">log10</span>(cmax_pred) ,<span class="fu">log10</span>(cmax_obs)    )</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>              )</span></code></pre></div>
<p>now plot log-transformed predicted vs. observed values and group by
permeability method, vehicle (or route of exposure), and tested
tissue.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df.new <span class="ot">=</span> <span class="fu">subset</span>(df.sim, exhalation_for_simulation<span class="sc">==</span>Exhalation)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df.sim.rmsle2<span class="ot">=</span>df.new <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PREFERRED_NAME, method.name)<span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cmax_obs =</span> <span class="fu">max</span>(conc_normalized), <span class="at">cmax_pred=</span><span class="fu">max</span>(Prediction)) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(conc_normalized),<span class="fu">log10</span>(Prediction)),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cmax_RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(cmax_obs), <span class="fu">log10</span>(cmax_pred)))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>col<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;firebrick&quot;</span>, <span class="st">&quot;indianred&quot;</span>, <span class="st">&quot;blue4&quot;</span>,<span class="st">&quot;steelblue1&quot;</span>,<span class="st">&quot;#2ca25f&quot;</span>, <span class="st">&quot;#addd8e&quot;</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>plot.pvo<span class="ot">=</span><span class="fu">ggplot</span>(df.sim.rmsle2, <span class="fu">aes</span>(<span class="at">x=</span>conc_normalized, <span class="at">y=</span>Prediction))<span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>( <span class="at">colour=</span>method.name,<span class="at">shape=</span>PREFERRED_NAME), <span class="at">alpha=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste0</span>(<span class="st">&quot;(A) Concentrations&quot;</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Simulated (mg/L)&quot;</span>, <span class="at">x=</span><span class="st">&quot;Observed (mg/L)&quot;</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">color=</span><span class="st">&quot;Route or</span><span class="sc">\n</span><span class="st"> Method&quot;</span>,<span class="at">shape=</span><span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(<span class="fu">unique</span>(df.sim.rmsle2<span class="sc">$</span>PREFERRED_NAME)))<span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">colour=</span>method.name),<span class="at">method=</span><span class="st">&quot;lm&quot;</span>,<span class="at">se=</span>F)<span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_brewer(type=&quot;qual&quot;,palette=&quot;Paired&quot;,direction=-1) +</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>col)<span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty=</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_fixed(xlim=lims,ylim=lims) +</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>))</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>plot.cmax <span class="ot">=</span> <span class="fu">ggplot</span>(df.sim.rmsle2, <span class="fu">aes</span>(<span class="at">x=</span>cmax_obs, <span class="at">y=</span>cmax_pred))<span class="sc">+</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>( <span class="at">colour=</span>method.name,<span class="at">shape=</span>PREFERRED_NAME), <span class="at">alpha=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste0</span>(<span class="st">&quot;(B) Max Concentrations&quot;</span>),</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Simulated (mg/L)&quot;</span>, <span class="at">x=</span><span class="st">&quot;Observed (mg/L)&quot;</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color=</span><span class="st">&quot;Route or</span><span class="sc">\n</span><span class="st"> Method&quot;</span>, <span class="at">shape=</span><span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_brewer(type=&quot;qual&quot;,palette=&quot;Paired&quot;,direction=-1) +</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>col)<span class="sc">+</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="dv">1</span><span class="sc">:</span> <span class="fu">length</span>(<span class="fu">unique</span>(df.sim.rmsle2<span class="sc">$</span>PREFERRED_NAME)))<span class="sc">+</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty=</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_fixed(xlim=lims,ylim=lims) +</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>))</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(plot.pvo, plot.cmax, <span class="at">common.legend=</span>T,<span class="at">legend=</span><span class="st">&quot;right&quot;</span>)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/PvO_main.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,<span class="at">dpi=</span><span class="dv">300</span>)</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>method.rmsle.only<span class="ot">=</span>df.new <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PREFERRED_NAME, method.name)<span class="sc">%&gt;%</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cmax_obs =</span> <span class="fu">max</span>(conc_normalized), <span class="at">cmax_pred=</span><span class="fu">max</span>(Prediction)) <span class="sc">%&gt;%</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(conc_normalized),<span class="fu">log10</span>(Prediction)),</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">Cmax_RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(cmax_obs), <span class="fu">log10</span>(cmax_pred))) <span class="sc">%&gt;%</span><span class="fu">group_by</span>(method.name)<span class="sc">%&gt;%</span><span class="fu">summarize</span>(<span class="fu">mean</span>(Cmax_RMSLE),</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>                                                                                                      <span class="fu">mean</span>(RMSLE))</span></code></pre></div>
<p>Now let’s plot a heat map of the RMSLE and Cmax RMSLE. We will subset
the dataframe to only plot the simulations appropriate for exhalation
(that is, for a volatile chemical where Exhalation = TRUE, we will
extract the solutions when exhalation_for_simulation = TRUE).We will
also make note of the experiments for which a dosing vehicle was
specified (water or octanol). For dermal, we will plot the results using
both permeability methods and both vehicle methods, but will mark boxes
over the cases where the vehicle matched to the simulated vehicle. We
also want to plot the chemicals in order of volatility (based on boiling
point).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract correct exhalation</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df = conc_predictions_meade2023DF</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df$conc_normalized[which(df$conc_normalized==0)]=1e-10</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df$Prediction[which(df$Prediction==0)]=1e-10</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>df.sim</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>dfmatchE <span class="ot">=</span>  <span class="fu">subset</span>(df, exhalation_for_simulation<span class="sc">==</span>Exhalation)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># order chemicals by volatility</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>vol.chem <span class="ot">=</span> <span class="fu">unique</span>(dfmatchE[,<span class="fu">c</span>(<span class="st">&quot;PREFERRED_NAME&quot;</span>,<span class="st">&quot;Boiling.Point.C&quot;</span>)])</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>vol.chem2<span class="ot">=</span>vol.chem[<span class="fu">order</span>(vol.chem<span class="sc">$</span>Boiling.Point.C,<span class="at">decreasing=</span>F),]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#also want to extract table to identify  experiments that actually did list the vehicle as either water or octanol (or similar)</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>dfmatchE2 <span class="ot">=</span> <span class="fu">data.frame</span>(dfmatchE<span class="sc">%&gt;%</span><span class="fu">group_by</span>(PREFERRED_NAME,method.name,dose_vehicle_normalized,Kvehicle2water,administration_route_normalized)<span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">cmax_obs =</span> <span class="fu">max</span>(conc_normalized), <span class="at">cmax_pred=</span><span class="fu">max</span>(Prediction)) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Cmax_RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(cmax_obs),<span class="fu">log10</span>(cmax_pred)),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">RMSLE =</span> <span class="fu">rmse</span>(<span class="fu">log10</span>(conc_normalized),<span class="fu">log10</span>(Prediction))))</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorganize the columns so RMSLE values can be grouped by Cmax or total RMSLE and then take average RMSLE values of oral or iv values so we have one per chemical</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>dfmatchE3 <span class="ot">=</span> <span class="fu">data.frame</span>(dfmatchE2 <span class="sc">%&gt;%</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;Cmax_RMSLE&quot;</span>, <span class="st">&quot;RMSLE&quot;</span>), </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;ind&quot;</span>, </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PREFERRED_NAME,ind,administration_route_normalized) <span class="sc">%&gt;%</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">if_else</span>(administration_route_normalized <span class="sc">!=</span><span class="st">&quot;Dermal&quot;</span>, <span class="fu">mean</span>(value[administration_route_normalized <span class="sc">!=</span><span class="st">&quot;Dermal&quot;</span>]), value)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>           ))</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Make PREFERRED_NAME a factor and set the levels to match those from the volatility order.</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>dfmatchE3<span class="sc">$</span>PREFERRED_NAME <span class="ot">=</span> <span class="fu">factor</span>(dfmatchE3<span class="sc">$</span>PREFERRED_NAME, </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">levels=</span>vol.chem2<span class="sc">$</span>PREFERRED_NAME)</span></code></pre></div>
<p>Generate the plot.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfmatchE3, <span class="fu">aes</span>(<span class="at">y=</span>PREFERRED_NAME, <span class="at">x=</span>method.name))<span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>value))<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_tile(aes(fill=Chemical.Cmax.RMSLE.NE))+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ind)<span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>()<span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">round</span>(value,<span class="dv">2</span>)),<span class="at">colour=</span><span class="st">&quot;white&quot;</span>,<span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Route or</span><span class="sc">\n</span><span class="st"> Method&quot;</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill=</span><span class="st">&quot;RMSLE&quot;</span>,<span class="at">y=</span><span class="st">&quot;Chemical&quot;</span>)<span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>,<span class="at">vjust=</span><span class="dv">1</span>,<span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>,<span class="at">vjust=</span><span class="fl">1.05</span>,<span class="at">hjust=</span><span class="fl">0.9</span>),</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data=</span><span class="fu">subset</span>(dfmatchE3, dose_vehicle_normalized<span class="sc">==</span>Kvehicle2water <span class="sc">&amp;</span> administration_route_normalized<span class="sc">==</span><span class="st">&quot;Dermal&quot;</span>),<span class="fu">aes</span>(<span class="at">y=</span>PREFERRED_NAME, <span class="at">x=</span>method.name),</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">size=</span><span class="fl">1.5</span>,<span class="at">fill=</span><span class="cn">NA</span>,<span class="at">colour=</span><span class="st">&quot;red&quot;</span> )</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(),<span class="st">&quot;/Figures_May1/RMSLE_compare_main.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),<span class="at">width=</span><span class="dv">11</span>,<span class="at">height=</span><span class="dv">8</span>,<span class="at">units=</span><span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="results-2-ivive" class="section level1">
<h1>Results 2: IVIVE</h1>
<p>Now, we perform <em>in vitro</em> to <em>in vivo</em> extrapolation
using the dermal model to obtain some occupational hazardous levels.</p>
<div id="step-one-load-data-1" class="section level2">
<h2>Step One: Load Data</h2>
<p>First we load <a href="https://www.epa.gov/comptox-tools/exploring-toxcast-data">ToxCast
Data</a> data from the <a href="https://clowder.edap-cluster.com/spaces/62bb560ee4b07abf29f88fef">EPA-ORD-CCTE
Clowder</a>. Some of the variables in this dataset of importance
include:</p>
<ul>
<li><code>hitc</code>: if <code>hitc=1</code> there was a statistically
significant systematic conc-response observed, and if
<code>hitc=0</code> there was no statistically significant</li>
<li><code>mc6_flags</code>: features of the hit that might be of
interest</li>
<li><code>modl</code> type of conc-response model selected (using AIC)
<ul>
<li><code>&quot;cnst&quot;</code>: no concentration response (constant)</li>
<li><code>&quot;hill&quot;</code>: Hill equation +<code>&quot;gnls&quot;</code>: Gain-loss
model, product of an increasing and decreasing Hill equations, often
interpreted as being caused by cytotoxicity</li>
</ul></li>
<li><code>model_ga</code>: log10 uM concentration at which the chemical
caused 50% activity (i.e., chemical-assay “potency” or “AC50”)</li>
<li><code>spid</code>: sample id, since each chemical might have
multiple assays with hits or have been run multiple times (experimental
replicates)</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in vitro data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;invitrodb_3_5_mc5.Rdata&quot;</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get chemicals of interest </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load_sipes2017</span>(<span class="at">overwrite=</span>F)</span></code></pre></div>
</div>
<div id="step-two-load-chemical-data" class="section level2">
<h2>Step Two: Load Chemical Data</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using list, download chem info from CompTox Dashboard for chem.list chemicals, and load.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df.chem <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="at">file=</span><span class="st">&quot;CCD-Batch-Search_2023-03-08_12_23_25.xlsx&quot;</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sheetName=</span><span class="st">&quot;Main Data&quot;</span>)<span class="co"># %&gt;%filter(!is.na(BOILING_POINT_DEGC_OPERA_PRED))</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>df.chem <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(df.chem,<span class="at">na=</span><span class="st">&quot;N/A&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>df.chem <span class="ot">&lt;-</span> <span class="fu">type_convert</span>(df.chem,<span class="at">na=</span><span class="st">&quot;N/A&quot;</span>)</span></code></pre></div>
</div>
<div id="step-three-clean-data-only-non-volatiles-and-a-few-of-the-semi-volatiles-from-the-validation-study" class="section level2">
<h2>Step Three: Clean Data (Only Non-Volatiles and a few of the
Semi-Volatiles from the validation study)</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get list of chemicals that can run in dermal model:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>chem.list <span class="ot">&lt;-</span> <span class="fu">get_cheminfo</span>(<span class="at">info=</span><span class="st">&quot;DTXSID&quot;</span>,<span class="at">species=</span><span class="st">&quot;Human&quot;</span>,<span class="at">model=</span><span class="st">&quot;dermal_1subcomp&quot;</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(chem.list,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/ChemicalList.txt&quot;</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Take out volatile chemicals</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>chems.from.invivo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID0020232&quot;</span>,<span class="st">&quot;DTXSID6022923&quot;</span>,<span class="st">&quot;DTXSID8024151&quot;</span>,<span class="st">&quot;DTXSID3022409&quot;</span>,<span class="st">&quot;DTXSID1026081&quot;</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>df.chem <span class="ot">&lt;-</span> df.chem <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(BOILING_POINT_DEGC_OPERA_PRED))<span class="sc">%&gt;%</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((BOILING_POINT_DEGC_OPERA_PRED <span class="sc">&gt;=</span> <span class="dv">400</span>) <span class="sc">|</span> (DTXSID <span class="sc">%in%</span> chems.from.invivo))</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>chem.list <span class="ot">&lt;-</span> df.chem<span class="sc">$</span>DTXSID</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">#get sample to test code with</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">#chem.list &lt;- sample(chem.list,50)</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>toxcast.dermal <span class="ot">&lt;-</span> mc5 <span class="sc">%&gt;%</span> <span class="fu">subset</span>(dsstox_substance_id <span class="sc">%in%</span> chem.list) </span></code></pre></div>
</div>
<div id="step-four-compute-q10.ac50-and-other-parameters-of-interest" class="section level2">
<h2>Step Four: Compute Q10.AC50 (and other parameters of interest)</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CONCENTRATIONS OF INTEREST - https://doi.org/10.1093/bioinformatics/btw680 ----------------</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>toxcast.table <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>old.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>num.chem <span class="ot">&lt;-</span> <span class="fu">length</span>(chem.list)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k.chem <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num.chem){ <span class="co">#for each chemical</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  this.id <span class="ot">&lt;-</span> chem.list[k.chem]</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modulus operator</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k.chem <span class="sc">%%</span> <span class="dv">100</span><span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    new.time <span class="ot">&lt;-</span> <span class="fu">difftime</span>(<span class="fu">Sys.time</span>(), old.time,<span class="at">units=</span><span class="st">&quot;secs&quot;</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&quot;Run &quot;</span>, k.chem,<span class="st">&quot;:&quot;</span>,<span class="fu">round</span>(new.time),<span class="st">&quot; secs </span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  toxcast.dermal.chem <span class="ot">&lt;-</span> <span class="fu">subset</span>(toxcast.dermal, dsstox_substance_id <span class="sc">==</span> this.id) <span class="co">#subset over chemical</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  toxcast.dermal.chem.hits <span class="ot">&lt;-</span> <span class="fu">subset</span>(toxcast.dermal.chem, hitc<span class="sc">==</span><span class="dv">1</span>) <span class="co">#only look at hits</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">dim</span>(toxcast.dermal.chem.hits)[<span class="dv">1</span>]<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="co">#if there were any hits</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    this.row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Chemical =</span> <span class="fu">as.character</span>(toxcast.dermal.chem.hits[<span class="dv">1</span>,<span class="st">&quot;chnm&quot;</span>]),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">DTXSID =</span> this.id,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Total.Assays =</span> <span class="fu">dim</span>(toxcast.dermal.chem)[<span class="dv">1</span>],</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Unique.Assays =</span> <span class="fu">length</span>(<span class="fu">unique</span>(toxcast.dermal.chem<span class="sc">$</span>aeid)),</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Total.Hits =</span> <span class="fu">dim</span>(toxcast.dermal.chem.hits)[<span class="dv">1</span>],</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Unique.Hits =</span> <span class="fu">length</span>(<span class="fu">unique</span>(toxcast.dermal.chem.hits<span class="sc">$</span>aeid)),</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Low.AC50 =</span> <span class="fu">min</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ga),</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Low.AC10 =</span> <span class="fu">min</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ac10),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Low.ACC =</span> <span class="fu">min</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_acc),</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Q10.AC50 =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ga,<span class="at">probs=</span><span class="fl">0.1</span>),</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Q10.AC10 =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ac10,<span class="at">probs=</span><span class="fl">0.1</span>),</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Q10.ACC =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_acc,<span class="at">probs=</span><span class="fl">0.1</span>),</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Med.AC50 =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ga,<span class="at">probs=</span><span class="fl">0.5</span>),</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Med.AC10 =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ac10,<span class="at">probs=</span><span class="fl">0.5</span>),</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Med.ACC =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_acc,<span class="at">probs=</span><span class="fl">0.5</span>),</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Q90.AC50 =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ga,<span class="at">probs=</span><span class="fl">0.9</span>),</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Q90.AC10 =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_ac10,<span class="at">probs=</span><span class="fl">0.9</span>),</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Q90.ACC =</span> <span class="fu">quantile</span>(toxcast.dermal.chem.hits<span class="sc">$</span>modl_acc,<span class="at">probs=</span><span class="fl">0.9</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    toxcast.table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(toxcast.table, this.row)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(toxcast.table) <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(toxcast.table)[<span class="dv">1</span>]) <span class="co"># set rownames to be sequential numbers</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="co">#View table</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(toxcast.table[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]), <span class="at">caption =</span> <span class="st">&quot;Summarized ToxCast Data&quot;</span>,</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">floating.environment=</span><span class="st">&quot;sidewaystable&quot;</span>)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(toxcast.table,</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/ToxCastSummaryTable.txt&quot;</span>),</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
<div id="step-five-conduct-in-vitro-to-in-vivo-extrapolation" class="section level2">
<h2>Step Five: Conduct <em>In Vitro</em> to <em>In Vivo</em>
Extrapolation</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Cmax = max(Cplasma) from dermal model for each chemical in toxcast table</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>old.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>include.these<span class="ot">=</span><span class="fu">which</span>(toxcast.table<span class="sc">$</span>DTXSID <span class="sc">%in%</span> <span class="fu">get_cheminfo</span>(<span class="at">info=</span><span class="st">&quot;dtxsid&quot;</span>, <span class="at">suppress.messages=</span>T))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>toxcast.table2 <span class="ot">=</span> <span class="fu">subset</span>(toxcast.table,DTXSID <span class="sc">%in%</span> toxcast.table<span class="sc">$</span>DTXSID[include.these])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>atol <span class="ot">&lt;-</span> rtol <span class="ot">&lt;-</span> <span class="fl">1e-5</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>num.chem <span class="ot">&lt;-</span> <span class="fu">length</span>(toxcast.table2<span class="sc">$</span>DTXSID)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>plot.each<span class="ot">=</span>F</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set Dermal Solutions</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>method.ls <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Potts-Guy&quot;</span>,<span class="st">&quot;UK-Surrey&quot;</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>toxcast.ls<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k.chem <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num.chem){</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  this.id <span class="ot">=</span> toxcast.table2<span class="sc">$</span>DTXSID[k.chem]</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  suppress.messages <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k.method <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>      this.method <span class="ot">&lt;-</span> method.ls[k.method]; </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  if (this.method==&quot;2-Compartment&quot;) this.method.input &lt;- &quot;NULL&quot;</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>      this.model.type <span class="ot">&lt;-</span><span class="st">&quot;dermal_1subcomp&quot;</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>      end.time<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>      parms<span class="ot">=</span><span class="fu">parameterize_dermal_pbtk</span>(<span class="at">dtxsid=</span>this.id, </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">model.type =</span> this.model.type,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">method.permeability =</span> this.method,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">clint.pvalue.threshold=</span><span class="cn">Inf</span>,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">suppress.messages=</span><span class="cn">TRUE</span>,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Kvehicle2water =</span> <span class="dv">1</span>,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">species=</span><span class="st">&quot;Human&quot;</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">default.to.human =</span> T)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>      parms<span class="sc">$</span>InfiniteDose<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>      <span class="co">#if(end.time&lt;2){ #make sure solver finishes</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>        out<span class="ot">=</span><span class="fu">try</span>( <span class="fu">solve_dermal_pbtk</span>(<span class="at">parameters=</span>parms,</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">model.type=</span>this.model.type,</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">method.permeability=</span>this.method,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>                                     <span class="co">#Kvehicle2water=1, #vehicle is water</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">days=</span><span class="dv">5</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">initial.dose =</span> <span class="dv">1</span>,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">input.units =</span> <span class="st">&quot;ppm&quot;</span>,</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">dose.duration=</span><span class="dv">8</span>,</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">dose.duration.units=</span><span class="st">&quot;hr&quot;</span>,</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">washoff=</span>T,</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># InfiniteDose=T,</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">atol =</span> atol, <span class="at">rtol=</span> rtol,</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">method=</span><span class="st">&quot;lsoda&quot;</span>,</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">suppress.messages=</span>suppress.messages) )<span class="co">#put SA for hands!!!</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> (<span class="fu">is</span>(out,<span class="st">&quot;try-error&quot;</span>)){</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>           Cmax<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>           <span class="fu">browser</span>()</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>{end.time <span class="ot">&lt;-</span> out[<span class="fu">nrow</span>(out),<span class="st">&quot;time&quot;</span>]</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>      Cmax <span class="ot">&lt;-</span> <span class="fu">max</span>(out[,<span class="st">&quot;Cplasma&quot;</span>])</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>       toxcast.ls[[<span class="fu">paste0</span>(k.chem,<span class="st">&quot;.&quot;</span>,this.method)]]<span class="ot">=</span><span class="fu">cbind</span>(toxcast.table2[toxcast.table2<span class="sc">$</span>DTXSID<span class="sc">==</span>this.id,],<span class="at">Cmax=</span>Cmax,<span class="at">Permeability =</span> this.method)</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>toxcast2.all<span class="ot">=</span><span class="fu">do.call</span>(rbind,toxcast.ls)</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Calculate the EquivDose in units same as input.units (ppm)</span></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>toxcast2.all<span class="sc">$</span>EquivDose <span class="ot">=</span> <span class="fu">signif</span>(<span class="dv">10</span><span class="sc">^</span>toxcast2.all<span class="sc">$</span>Q10.AC50 <span class="sc">/</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>                                  toxcast2.all<span class="sc">$</span>Cmax,</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">4</span>)</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Edit data</span></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>toxcast3<span class="ot">=</span>toxcast2.all<span class="sc">%&gt;%</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span> <span class="ot">=</span> Permeability,</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span><span class="ot">=</span>EquivDose)<span class="sc">%&gt;%</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chemical =</span> <span class="fu">ifelse</span>(Chemical<span class="sc">==</span><span class="st">&quot;Methyl tert-butyl ether&quot;</span>,<span class="st">&quot;MTBE&quot;</span>,Chemical),</span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">Chemical =</span> <span class="fu">ifelse</span>(Chemical<span class="sc">==</span><span class="st">&quot;3,3&#39;,5,5&#39;-Tetrabromobisphenol A&quot;</span>,<span class="st">&quot;Bromdian&quot;</span>,Chemical),</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">Chemical =</span> <span class="fu">ifelse</span>(Chemical<span class="sc">==</span><span class="st">&quot;4,4&#39;-Sulfonyldiphenol&quot;</span>,<span class="st">&quot;Bisphenol S&quot;</span>,Chemical),</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">Chemical =</span> <span class="fu">ifelse</span>(Chemical<span class="sc">==</span><span class="st">&quot;Dichloromethane&quot;</span>,<span class="st">&quot;DCM&quot;</span>,Chemical),</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>         <span class="at">Chemical =</span> <span class="fu">ifelse</span>(Chemical<span class="sc">==</span><span class="st">&quot;Tetrachloroethylene&quot;</span>,<span class="st">&quot;PERC/TCE&quot;</span>,Chemical),</span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">Chemical =</span> <span class="fu">ifelse</span>(Chemical<span class="sc">==</span><span class="st">&quot;1-Methylbenzene&quot;</span>,<span class="st">&quot;Toluene&quot;</span>,Chemical))</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unused columns</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>ivive_meade2023 <span class="ot">&lt;-</span> toxcast3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Chemical,DTXSID,<span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>,<span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>,Cmax)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chem.props <span class="ot">&lt;-</span> <span class="fu">subset</span>(chem.physical_and_invitro.data,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                     DTXSID <span class="sc">%in%</span> ivive_meade2023<span class="sc">$</span>DTXSID)[</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                       ,<span class="fu">c</span>(<span class="st">&quot;DTXSID&quot;</span>,<span class="st">&quot;MW&quot;</span>,<span class="st">&quot;logWSol&quot;</span>)]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>ivive_meade2023 <span class="ot">&lt;-</span> <span class="fu">merge</span>(ivive_meade2023,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">all.x =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                         chem.props,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by=</span><span class="st">&quot;DTXSID&quot;</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>ivive_meade2023 <span class="ot">&lt;-</span> <span class="fu">within</span>(ivive_meade2023, </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                          WS.ppm <span class="ot">&lt;-</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">signif</span>(MW<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span>logWSol<span class="sc">*</span><span class="fl">1.001142303</span>,<span class="dv">4</span>))</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a> cgwtools<span class="sc">::</span><span class="fu">resave</span>(ivive_meade2023,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">file=</span><span class="fu">paste0</span>(</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                    loc.wd,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;/meade2023_&quot;</span>,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%b_%d_%Y&quot;</span>),</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;.Rdata&quot;</span>))</span></code></pre></div>
</div>
<div id="step-six-plot-results" class="section level2">
<h2>Step Six: Plot Results</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify for plotting</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>ivive_meade2023<span class="sc">$</span><span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">&quot;UK-Surrey&quot;</span>,<span class="st">&quot;Surrey&quot;</span>,ivive_meade2023<span class="sc">$</span><span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>ivive_meade2023[ivive_meade2023<span class="sc">==</span><span class="cn">Inf</span>] <span class="ot">=</span> <span class="fl">1e15</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(<span class="fu">subset</span>(ivive_meade2023,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                   ivive_meade2023[,<span class="st">&quot;Equivalent Dose&quot;</span>] <span class="sc">&lt;</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                     ivive_meade2023[,<span class="st">&quot;WS.ppm&quot;</span>]),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/IVIVEAchievable.txt&quot;</span>),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)       </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>ivive_meade2023<span class="sc">$</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">log10</span>(ivive_meade2023<span class="sc">$</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>ivive_meade2023<span class="sc">$</span><span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;Permeability Method is &quot;</span>,ivive_meade2023<span class="sc">$</span><span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ivive_meade2023,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">file=</span><span class="fu">paste0</span>(loc.wd,<span class="st">&quot;/tables/IVIVEResults.txt&quot;</span>),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names=</span><span class="cn">TRUE</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names=</span><span class="cn">FALSE</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">quote=</span><span class="cn">FALSE</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Histogram</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> ivive_meade2023 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Median =</span> <span class="fu">median</span>(<span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>AED.labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Needs Protection (AED caused by &lt;1ppm)&quot;</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;AED Possibly Acheivable&quot;</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">Safe</span><span class="sc">\&quot;</span><span class="st"> (Unachievable AED)&quot;</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;No Dermal Penetration&quot;</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Shaded rectangles with cutoff at 10,000 ppm:</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>data.rect<span class="fl">.1e4</span>ppm <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">xmin=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">12</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmax=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">12</span>,<span class="cn">Inf</span>),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymin=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax=</span><span class="fu">rep</span>(<span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Bioactivity=</span>AED.labels)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Shaded rectangles with cutoff at 1,000,000 ppm:</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>data.rect<span class="fl">.1e6</span>ppm <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">xmin=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">12</span>),</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xmax=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="cn">Inf</span>),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymin=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax=</span><span class="fu">rep</span>(<span class="cn">Inf</span>,<span class="dv">4</span>),</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Bioactivity=</span>AED.labels)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>data.rect<span class="fl">.1e4</span>ppm<span class="sc">$</span>Bioactivity <span class="ot">&lt;-</span> <span class="fu">factor</span>(data.rect<span class="fl">.1e4</span>ppm<span class="sc">$</span>Bioactivity, </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">levels=</span>data.rect<span class="fl">.1e4</span>ppm<span class="sc">$</span>Bioactivity)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>data.rect<span class="fl">.1e6</span>ppm<span class="sc">$</span>Bioactivity <span class="ot">&lt;-</span> <span class="fu">factor</span>(data.rect<span class="fl">.1e6</span>ppm<span class="sc">$</span>Bioactivity, </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">levels=</span>data.rect<span class="fl">.1e6</span>ppm<span class="sc">$</span>Bioactivity)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>data.med <span class="ot">=</span> <span class="fu">unique</span>(data[,<span class="fu">c</span>(<span class="st">&quot;Permeability Type&quot;</span>,<span class="st">&quot;Mean&quot;</span>,<span class="st">&quot;Median&quot;</span>)]) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;Mean&quot;</span>,<span class="st">&quot;Median&quot;</span>),<span class="at">names_to=</span><span class="st">&quot;Statistic&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;Statistic.Value&quot;</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>viridis.colors <span class="ot">&lt;-</span> viridisLite<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">4</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>,<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">position=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> data.med, <span class="fu">aes</span>(<span class="at">xintercept=</span>Statistic.Value,<span class="at">linetype=</span>Statistic)) <span class="sc">+</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data=</span>data.rect<span class="fl">.1e4</span>ppm,</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin=</span>xmin,<span class="at">xmax=</span>xmax,<span class="at">ymin=</span>ymin,<span class="at">ymax=</span>ymax,<span class="at">fill=</span>Bioactivity),</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_x_log10() + </span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">setNames</span>(viridis.colors[<span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>], AED.labels))<span class="sc">+</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste0</span>(<span class="st">&quot;Distribution of concentrations causing AED</span><span class="sc">\n</span><span class="st">for hands submerged for 8 hours a day</span><span class="sc">\n</span><span class="st">for five days&quot;</span>),</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Chemicals&quot;</span>, <span class="at">x=</span><span class="st">&quot;Log10 of Administrered Equivalent Doses (AEDs) ppm in water&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_col</span>(<span class="fu">vars</span>(<span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>),<span class="at">scales=</span><span class="st">&quot;fixed&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>plot  </span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/histogram2.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># WATER SOLUBILITY</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ivive_meade2023 <span class="ot">&lt;-</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  ivive_meade2023 <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WSol =</span> <span class="fu">case_when</span>( ((MW<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span>logWSol)<span class="sc">&gt;=</span><span class="dv">10</span>) <span class="sc">~</span> <span class="st">&quot;Water Soluble (WSol&gt;10g/L)&quot;</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                           ((MW<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span>logWSol)<span class="sc">&lt;</span><span class="dv">10</span>) <span class="sc">~</span> <span class="st">&quot;Not Soluble&quot;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                           ))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ivive_meade2023ALL &lt;- ivive_meade2023WS; ivive_meade2023ALL$WSol = &quot;Non-Water Soluble&quot;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>ivive_meade2023WS <span class="ot">&lt;-</span> ivive_meade2023 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WSol<span class="sc">==</span><span class="st">&quot;Water Soluble (WSol&gt;10g/L)&quot;</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>ivive_meade2023NonWS <span class="ot">&lt;-</span> ivive_meade2023 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(WSol<span class="sc">==</span><span class="st">&quot;Not Soluble&quot;</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Different bands for soluble/non-soluble:</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>data.rect<span class="fl">.1e4</span>ppm<span class="sc">$</span>WSol <span class="ot">&lt;-</span> <span class="st">&quot;Not Soluble&quot;</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>data.rect<span class="fl">.1e6</span>ppm<span class="sc">$</span>WSol <span class="ot">&lt;-</span> <span class="st">&quot;Water Soluble (WSol&gt;10g/L)&quot;</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>data.rect <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data.rect<span class="fl">.1e4</span>ppm,data.rect<span class="fl">.1e6</span>ppm)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>data.rect[,<span class="st">&quot;Permeability Type&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Permeability Method is Potts-Guy&quot;</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>data.rect2 <span class="ot">&lt;-</span> data.rect</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>data.rect2[,<span class="st">&quot;Permeability Type&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Permeability Method is Surrey&quot;</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>data.rect <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data.rect,data.rect2)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>ivive_meade2023 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(ivive_meade2023NonWS,ivive_meade2023WS)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> ivive_meade2023 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>,<span class="st">`</span><span class="at">WSol</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Median =</span> <span class="fu">median</span>(<span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>data.med <span class="ot">=</span> <span class="fu">unique</span>(data[,<span class="fu">c</span>(<span class="st">&quot;Permeability Type&quot;</span>,<span class="st">&quot;WSol&quot;</span>,<span class="st">&quot;Mean&quot;</span>,<span class="st">&quot;Median&quot;</span>)]) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;Mean&quot;</span>,<span class="st">&quot;Median&quot;</span>),<span class="at">names_to=</span><span class="st">&quot;Statistic&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;Statistic.Value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>chem.to.label <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">&quot;DTXSID0020232&quot;</span>,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># &quot;DTXSID6022923&quot;,</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># &quot;DTXSID8024151&quot;,</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;DTXSID3022409&quot;</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;DTXSID1026081&quot;</span>, <span class="st">&quot;DTXSID9048699&quot;</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;DTXSID0022858&quot;</span>,<span class="st">&quot;DTXSID1037&quot;</span>,<span class="st">&quot;DTXSID0023163&quot;</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;DTXSID5024845&quot;</span> )</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>data.text <span class="ot">=</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> chem.to.label)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#PLOT WS</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data=</span>data.rect,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin=</span>xmin,<span class="at">xmax=</span>xmax,<span class="at">ymin=</span>ymin,<span class="at">ymax=</span>ymax,<span class="at">fill=</span>Bioactivity),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha=</span><span class="fl">0.5</span><span class="co">#,</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">#inherit.aes=FALSE</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>,<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">position=</span><span class="st">&quot;identity&quot;</span>,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> data.med, <span class="fu">aes</span>(<span class="at">xintercept=</span>Statistic.Value,<span class="at">linetype=</span>Statistic)) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_point(data=data.text,aes(x=`Equivalent Dose`,y=0),size=2) + </span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_text_repel(data=data.text,aes(x=`Equivalent Dose`,y=0,label=Chemical),</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                  max.overlaps=14,</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                  hjust = &quot;right&quot;,nudge_x=-1,nudge_y=0.2)+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">setNames</span>(viridis.colors[<span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>], AED.labels))<span class="sc">+</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylim(0,135)+</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_text(x=) +</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste0</span>(<span class="st">&quot;Distribution of concentrations causing AED</span><span class="sc">\n</span><span class="st">for hands submerged for 8 hours a day</span><span class="sc">\n</span><span class="st">for five days&quot;</span>),</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Chemicals&quot;</span>, <span class="at">x=</span><span class="st">&quot;Log10 of Needed Concentration (ppm) in water&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(<span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>,<span class="st">`</span><span class="at">WSol</span><span class="st">`</span>),<span class="at">scales=</span><span class="st">&quot;free_y&quot;</span>,<span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>))</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>plot  </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/histogram_all_main.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
<p>Include a table with the equivalent doses, grouped by permeability
method</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data2<span class="ot">=</span>data[<span class="fu">order</span>(data<span class="sc">$</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>),]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data2<span class="sc">$</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span><span class="ot">=</span> <span class="fu">exp</span>(data2<span class="sc">$</span><span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>data3<span class="ot">=</span><span class="fu">data.frame</span>(data2<span class="sc">%&gt;%</span><span class="fu">group_by</span>(Chemical,DTXSID, <span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>,WSol,logWSol)<span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row=</span><span class="fu">row_number</span>())<span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(<span class="at">id_cols=</span><span class="fu">c</span>(Chemical, DTXSID, row, WSol,logWSol),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="st">`</span><span class="at">Permeability Type</span><span class="st">`</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Equivalent Dose</span><span class="st">`</span>),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">names_sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>data4<span class="ot">=</span>data3[,<span class="sc">-</span><span class="dv">3</span>]</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>data4<span class="ot">=</span>data4[<span class="fu">order</span>(data4<span class="sc">$</span>Permeability.Method.is.Surrey),]</span></code></pre></div>
<p>Also, calculate permeability for each method for humans</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pmat<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>pm<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;UK-Surrey&quot;</span>,<span class="st">&quot;Potts-Guy&quot;</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>kw<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;water&quot;</span>,<span class="st">&quot;octanol&quot;</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(supptab1_meade2023<span class="sc">$</span>DTXSID)){</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){ <span class="co">#each method</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){ <span class="co"># each vehicle</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">=</span><span class="fu">parameterize_dermal_pbtk</span>(<span class="at">dtxsid=</span>supptab1_meade2023<span class="sc">$</span>DTXSID[i],</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">method.permeability =</span>pm[m] ,<span class="at">species=</span><span class="st">&quot;Human&quot;</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Kvehicle2water =</span> kw[k])</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  pmat[[<span class="fu">paste</span>(i,<span class="st">&quot;.&quot;</span>,m,<span class="st">&quot;.&quot;</span>,k)]]<span class="ot">=</span><span class="fu">cbind</span>(p<span class="sc">$</span>P, pm[m], kw[k],p<span class="sc">$</span>MW, supptab1_meade2023<span class="sc">$</span>DTXSID[i])</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>pmat2<span class="ot">=</span><span class="fu">do.call</span>(rbind,pmat)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pmat2)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Perm&quot;</span>, <span class="st">&quot;Method&quot;</span>,<span class="st">&quot;Vehicle&quot;</span>,<span class="st">&quot;MW&quot;</span>,<span class="st">&quot;DTXSID&quot;</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>pmat2<span class="ot">=</span><span class="fu">data.frame</span>(pmat2)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>pmat2<span class="sc">$</span>Method<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">&quot;UK-Surrey&quot;</span>,<span class="st">&quot;Surrey&quot;</span>,pmat2<span class="sc">$</span>Method)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>pmat2<span class="sc">$</span>Vehicle<span class="ot">=</span><span class="fu">paste</span>(<span class="st">&quot;Vehicle is&quot;</span>, pmat2<span class="sc">$</span>Vehicle)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>pmat3<span class="ot">=</span><span class="fu">merge</span>(pmat2,supptab1_meade2023, <span class="at">by=</span><span class="st">&quot;DTXSID&quot;</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pmat3,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.numeric</span>(MW.x),<span class="at">y=</span><span class="fu">as.numeric</span>(Perm)))<span class="sc">+</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Method<span class="sc">~</span>Vehicle,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;MW&quot;</span>,<span class="at">y=</span><span class="st">&quot;Kp - Permeability&quot;</span>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/MWvPerm.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="fl">3.5</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pmat3,<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.numeric</span>(logP),<span class="at">y=</span><span class="fu">as.numeric</span>(Perm)))<span class="sc">+</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Method<span class="sc">~</span>Vehicle,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;log(Kow)&quot;</span>,<span class="at">y=</span><span class="st">&quot;Kp- Permeability&quot;</span>)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste</span>(<span class="fu">getwd</span>(), <span class="st">&quot;/Figures_May1/logKowvPerm.png&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="fl">3.5</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="fu">paste0</span>(loc.wd,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;MeadeWorkspace&quot;</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">Sys.Date</span>(),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;.RData&quot;</span>))</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
