<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="John Wambaugh" />

<meta name="date" content="2022-09-22" />

<title>Wambaugh et al. (2018): Creating All Figures</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Wambaugh et al. (2018): Creating All Figures</h1>
<h4 class="author">John Wambaugh</h4>
<h4 class="date">2022-09-22</h4>



<p>This vignette provides the code used to generate the figures in Wambaugh et al. (2018) “Evaluating In Vitro-In Vivo Extrapolation of Toxicokinetics”</p>
<p>John F Wambaugh, Michael F Hughes, Caroline L Ring, Denise K MacMillan, Jermaine Ford, Timothy R Fennell, Sherry R Black, Rodney W Snyder, Nisha S Sipes, Barbara A Wetmore, Joost Westerhout, R Woodrow Setzer, Robert G Pearce, Jane Ellen Simmons, Russell S Thomas</p>
<p>Toxicological Sciences, Volume 163, Issue 1, May 2018, Pages 152-169,</p>
<p><a href="https://doi.org/10.1093/toxsci/kfy020" class="uri">https://doi.org/10.1093/toxsci/kfy020</a></p>
<div id="abstract" class="section level2">
<h2>Abstract</h2>
<p>Prioritizing the risk posed by thousands of chemicals potentially present in the environment requires exposure, toxicity, and toxicokinetic (TK) data, which are often unavailable. Relatively high-throughput, in vitro TK (HTTK) assays and in vitro-to-in vivo extrapolation (IVIVE) methods have been developed to predict TK, but most of the in vivo TK data available to benchmark these methods are from pharmaceuticals. Here we report on new, in vivo rat TK experiments for 26 non-pharmaceutical chemicals with environmental relevance. Both intravenous and oral dosing were used to calculate bioavailability. These chemicals, and an additional 19 chemicals (including some pharmaceuticals) from previously published in vivo rat studies, were systematically analyzed to estimate in vivo TK parameters (e.g., volume of distribution [Vd], elimination rate). For each of the chemicals, rat-specific HTTK data were available and key TK predictions were examined: oral bioavailability, clearance, Vd, and uncertainty. For the non-pharmaceutical chemicals, predictions for bioavailability were not effective. While no pharmaceutical was absorbed at less than 10%, the fraction bioavailable for non-pharmaceutical chemicals was as low as 0.3%. Total clearance was generally more under-estimated for nonpharmaceuticals and Vd methods calibrated to pharmaceuticals may not be appropriate for other chemicals. However, the steady-state, peak, and time-integrated plasma concentrations of non-pharmaceuticals were predicted with reasonable accuracy. The plasma concentration predictions improved when experimental measurements of bioavailability were incorporated. In summary, HTTK and IVIVE methods are adequately robust to be applied to high-throughput in vitro toxicity screening data of environmentally relevant chemicals for prioritizing based on human health risks.</p>
<p>To use the code in this vignette, you’ll first need to load a few packages. If you get the message “Error in library(X) : there is no package called ‘X’” then you will need to install that package:</p>
<p>From the R command prompt:</p>
<p>install.packages(“X”)</p>
<p>Or, if using RStudio, look for ‘Install Packages’ under ‘Tools’ tab.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(scales)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(data.table)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#library(gdata)</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#library(gtools)</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(httk)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">library</span>(grid)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">library</span>(gplots)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;gplots&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     lowess</code></pre>
<p>The data we analyze were originally generated with the R package invivoPKfit (<a href="https://github.com/USEPA/CompTox-ExpoCast-invivoPKfit" class="uri">https://github.com/USEPA/CompTox-ExpoCast-invivoPKfit</a>), but all the outputs of that analysis are provided with httk &gt;v1.8.</p>
</div>
<div id="plot-functions" class="section level1">
<h1>Plot functions</h1>
<p>These functions, which have been cobbled togethe from the internet, are reused in multiple figure to make things look nice.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Multiple plot function</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># - cols:   Number of columns in layout</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># - layout: A matrix specifying the layout. If present, &#39;cols&#39; is ignored.</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># then plot 1 will go in the upper left, 2 will go in the upper right, and</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co"># 3 will go all the way across the bottom.</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>multiplot &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">plotlist=</span><span class="ot">NULL</span>, file, <span class="dt">cols=</span><span class="dv">1</span>, <span class="dt">layout=</span><span class="ot">NULL</span>, <span class="dt">widths=</span><span class="kw">unit</span>(<span class="kw">rep_len</span>(<span class="dv">1</span>, cols), <span class="st">&quot;null&quot;</span>)) {</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="co"># Make a list from the ... arguments and plotlist</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  plots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list</span>(...), plotlist)</span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a>  numPlots =<span class="st"> </span><span class="kw">length</span>(plots)</span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="co"># If layout is NULL, then use &#39;cols&#39; to determine layout</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(layout)) {</span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="co"># Make the panel</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="co"># ncol: Number of columns of plots</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="co"># nrow: Number of rows needed, calculated from # of cols</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>    layout &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dv">1</span>, cols <span class="op">*</span><span class="st"> </span><span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols)),</span>
<span id="cb4-24"><a href="#cb4-24"></a>                    <span class="dt">ncol =</span> cols, <span class="dt">nrow =</span> <span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols))</span>
<span id="cb4-25"><a href="#cb4-25"></a>  }</span>
<span id="cb4-26"><a href="#cb4-26"></a></span>
<span id="cb4-27"><a href="#cb4-27"></a> <span class="cf">if</span> (numPlots<span class="op">==</span><span class="dv">1</span>) {</span>
<span id="cb4-28"><a href="#cb4-28"></a>    <span class="kw">print</span>(plots[[<span class="dv">1</span>]])</span>
<span id="cb4-29"><a href="#cb4-29"></a></span>
<span id="cb4-30"><a href="#cb4-30"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-31"><a href="#cb4-31"></a>    <span class="co"># Set up the page</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>    <span class="kw">grid.newpage</span>()</span>
<span id="cb4-33"><a href="#cb4-33"></a>    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">layout =</span> <span class="kw">grid.layout</span>(<span class="kw">nrow</span>(layout), <span class="kw">ncol</span>(layout),<span class="dt">widths=</span>widths)))</span>
<span id="cb4-34"><a href="#cb4-34"></a></span>
<span id="cb4-35"><a href="#cb4-35"></a>    <span class="co"># Make each plot, in the correct location</span></span>
<span id="cb4-36"><a href="#cb4-36"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numPlots) {</span>
<span id="cb4-37"><a href="#cb4-37"></a>      <span class="co"># Get the i,j matrix positions of the regions that contain this subplot</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>      matchidx &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">which</span>(layout <span class="op">==</span><span class="st"> </span>i, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>))</span>
<span id="cb4-39"><a href="#cb4-39"></a></span>
<span id="cb4-40"><a href="#cb4-40"></a>      <span class="kw">print</span>(plots[[i]], <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">layout.pos.row =</span> matchidx<span class="op">$</span>row,</span>
<span id="cb4-41"><a href="#cb4-41"></a>                                      <span class="dt">layout.pos.col =</span> matchidx<span class="op">$</span>col))</span>
<span id="cb4-42"><a href="#cb4-42"></a>    }</span>
<span id="cb4-43"><a href="#cb4-43"></a>  }</span>
<span id="cb4-44"><a href="#cb4-44"></a>}</span>
<span id="cb4-45"><a href="#cb4-45"></a>                                                                </span>
<span id="cb4-46"><a href="#cb4-46"></a>scientific_<span class="dv">10</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x) {                                  </span>
<span id="cb4-47"><a href="#cb4-47"></a>  out &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;1e&quot;</span>, <span class="st">&quot;10^&quot;</span>, <span class="kw">scientific_format</span>()(x))              </span>
<span id="cb4-48"><a href="#cb4-48"></a>  out &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">+&quot;</span>,<span class="st">&quot;&quot;</span>,out)                                     </span>
<span id="cb4-49"><a href="#cb4-49"></a>  out &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;10</span><span class="ch">\\</span><span class="st">^01&quot;</span>,<span class="st">&quot;10&quot;</span>,out)                               </span>
<span id="cb4-50"><a href="#cb4-50"></a>  out &lt;-<span class="st"> </span><span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">gsub</span>(<span class="st">&quot;10</span><span class="ch">\\</span><span class="st">^00&quot;</span>,<span class="st">&quot;1&quot;</span>,out))                    </span>
<span id="cb4-51"><a href="#cb4-51"></a>}  </span>
<span id="cb4-52"><a href="#cb4-52"></a></span>
<span id="cb4-53"><a href="#cb4-53"></a> </span>
<span id="cb4-54"><a href="#cb4-54"></a>lm_R2 &lt;-<span class="st"> </span><span class="cf">function</span>(m,<span class="dt">prefix=</span><span class="ot">NULL</span>){</span>
<span id="cb4-55"><a href="#cb4-55"></a>    out &lt;-<span class="st"> </span><span class="kw">substitute</span>(<span class="st">&quot;MSE = &quot;</span><span class="op">~</span>mse<span class="op">*</span><span class="st">&quot;,&quot;</span><span class="op">~</span><span class="er">~</span><span class="kw">italic</span>(R)<span class="op">^</span><span class="dv">2</span><span class="op">~</span><span class="st">&quot;=&quot;</span><span class="op">~</span>r2, </span>
<span id="cb4-56"><a href="#cb4-56"></a>         <span class="kw">list</span>(<span class="dt">mse =</span> <span class="kw">signif</span>(<span class="kw">mean</span>(m<span class="op">$</span>residuals<span class="op">^</span><span class="dv">2</span>),<span class="dv">3</span>),</span>
<span id="cb4-57"><a href="#cb4-57"></a>              <span class="dt">r2 =</span> <span class="kw">format</span>(<span class="kw">summary</span>(m)<span class="op">$</span>adj.r.squared, <span class="dt">digits =</span> <span class="dv">2</span>)))</span>
<span id="cb4-58"><a href="#cb4-58"></a>    <span class="kw">paste</span>(prefix,<span class="kw">as.character</span>(<span class="kw">as.expression</span>(out)))                 </span>
<span id="cb4-59"><a href="#cb4-59"></a>}</span>
<span id="cb4-60"><a href="#cb4-60"></a>  </span>
<span id="cb4-61"><a href="#cb4-61"></a>heatmap<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x,</span>
<span id="cb4-62"><a href="#cb4-62"></a>                      <span class="dt">Rowv =</span> <span class="ot">TRUE</span>, <span class="dt">Colv =</span> <span class="cf">if</span> (symm) <span class="st">&quot;Rowv&quot;</span> <span class="cf">else</span> <span class="ot">TRUE</span>,</span>
<span id="cb4-63"><a href="#cb4-63"></a>                      <span class="dt">distfun =</span> dist,</span>
<span id="cb4-64"><a href="#cb4-64"></a>                      <span class="dt">hclustfun =</span> hclust,</span>
<span id="cb4-65"><a href="#cb4-65"></a>                      <span class="dt">dendrogram =</span> <span class="kw">c</span>(<span class="st">&quot;both&quot;</span>,<span class="st">&quot;row&quot;</span>, <span class="st">&quot;column&quot;</span>, <span class="st">&quot;none&quot;</span>),</span>
<span id="cb4-66"><a href="#cb4-66"></a>                      <span class="dt">symm =</span> <span class="ot">FALSE</span>,</span>
<span id="cb4-67"><a href="#cb4-67"></a>                      <span class="dt">scale =</span> <span class="kw">c</span>(<span class="st">&quot;none&quot;</span>,<span class="st">&quot;row&quot;</span>, <span class="st">&quot;column&quot;</span>),</span>
<span id="cb4-68"><a href="#cb4-68"></a>                      <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb4-69"><a href="#cb4-69"></a>                      <span class="dt">revC =</span> <span class="kw">identical</span>(Colv,<span class="st">&quot;Rowv&quot;</span>),</span>
<span id="cb4-70"><a href="#cb4-70"></a>                      add.expr,</span>
<span id="cb4-71"><a href="#cb4-71"></a>                      breaks,</span>
<span id="cb4-72"><a href="#cb4-72"></a>                      <span class="dt">symbreaks =</span> <span class="kw">max</span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">||</span><span class="st"> </span>scale <span class="op">!=</span><span class="st"> &quot;none&quot;</span>,</span>
<span id="cb4-73"><a href="#cb4-73"></a>                      <span class="dt">col =</span> <span class="st">&quot;heat.colors&quot;</span>,</span>
<span id="cb4-74"><a href="#cb4-74"></a>                      colsep,</span>
<span id="cb4-75"><a href="#cb4-75"></a>                      rowsep,</span>
<span id="cb4-76"><a href="#cb4-76"></a>                      <span class="dt">sepcolor =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb4-77"><a href="#cb4-77"></a>                      <span class="dt">sepwidth =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>),</span>
<span id="cb4-78"><a href="#cb4-78"></a>                      cellnote,</span>
<span id="cb4-79"><a href="#cb4-79"></a>                      <span class="dt">notecex =</span> <span class="dv">1</span>,</span>
<span id="cb4-80"><a href="#cb4-80"></a>                      <span class="dt">notecol =</span> <span class="st">&quot;cyan&quot;</span>,</span>
<span id="cb4-81"><a href="#cb4-81"></a>                      <span class="dt">na.color =</span> <span class="kw">par</span>(<span class="st">&quot;bg&quot;</span>),</span>
<span id="cb4-82"><a href="#cb4-82"></a>                      <span class="dt">trace =</span> <span class="kw">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;column&quot;</span>,<span class="st">&quot;row&quot;</span>, <span class="st">&quot;both&quot;</span>),</span>
<span id="cb4-83"><a href="#cb4-83"></a>                      <span class="dt">tracecol =</span> <span class="st">&quot;cyan&quot;</span>,</span>
<span id="cb4-84"><a href="#cb4-84"></a>                      <span class="dt">hline =</span> <span class="kw">median</span>(breaks),</span>
<span id="cb4-85"><a href="#cb4-85"></a>                      <span class="dt">vline =</span> <span class="kw">median</span>(breaks),</span>
<span id="cb4-86"><a href="#cb4-86"></a>                      <span class="dt">linecol =</span> tracecol,</span>
<span id="cb4-87"><a href="#cb4-87"></a>                      <span class="dt">margins =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>),</span>
<span id="cb4-88"><a href="#cb4-88"></a>                      ColSideColors,</span>
<span id="cb4-89"><a href="#cb4-89"></a>                      RowSideColors,</span>
<span id="cb4-90"><a href="#cb4-90"></a>                      <span class="dt">side.height.fraction=</span><span class="fl">0.3</span>,</span>
<span id="cb4-91"><a href="#cb4-91"></a>                      <span class="dt">cexRow =</span> <span class="fl">0.2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">log10</span>(nr),</span>
<span id="cb4-92"><a href="#cb4-92"></a>                      <span class="dt">cexCol =</span> <span class="fl">0.2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">log10</span>(nc),</span>
<span id="cb4-93"><a href="#cb4-93"></a>                      <span class="dt">labRow =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-94"><a href="#cb4-94"></a>                      <span class="dt">labCol =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-95"><a href="#cb4-95"></a>                      <span class="dt">key =</span> <span class="ot">TRUE</span>,</span>
<span id="cb4-96"><a href="#cb4-96"></a>                      <span class="dt">keysize =</span> <span class="fl">1.5</span>,</span>
<span id="cb4-97"><a href="#cb4-97"></a>                      <span class="dt">density.info =</span> <span class="kw">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;histogram&quot;</span>, <span class="st">&quot;density&quot;</span>),</span>
<span id="cb4-98"><a href="#cb4-98"></a>                      <span class="dt">denscol =</span> tracecol,</span>
<span id="cb4-99"><a href="#cb4-99"></a>                      <span class="dt">symkey =</span> <span class="kw">max</span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">||</span><span class="st"> </span>symbreaks,</span>
<span id="cb4-100"><a href="#cb4-100"></a>                      <span class="dt">densadj =</span> <span class="fl">0.25</span>,</span>
<span id="cb4-101"><a href="#cb4-101"></a>                      <span class="dt">main =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-102"><a href="#cb4-102"></a>                      <span class="dt">xlab =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-103"><a href="#cb4-103"></a>                      <span class="dt">ylab =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-104"><a href="#cb4-104"></a>                      <span class="dt">lmat =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-105"><a href="#cb4-105"></a>                      <span class="dt">lhei =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-106"><a href="#cb4-106"></a>                      <span class="dt">lwid =</span> <span class="ot">NULL</span>,</span>
<span id="cb4-107"><a href="#cb4-107"></a>                      <span class="dt">ColSideColorsSize =</span> <span class="dv">1</span>,</span>
<span id="cb4-108"><a href="#cb4-108"></a>                      <span class="dt">RowSideColorsSize =</span> <span class="dv">1</span>,</span>
<span id="cb4-109"><a href="#cb4-109"></a>                      <span class="dt">KeyValueName=</span><span class="st">&quot;Value&quot;</span>,...){</span>
<span id="cb4-110"><a href="#cb4-110"></a></span>
<span id="cb4-111"><a href="#cb4-111"></a>    invalid &lt;-<span class="st"> </span><span class="cf">function</span> (x) {</span>
<span id="cb4-112"><a href="#cb4-112"></a>      <span class="cf">if</span> (<span class="kw">missing</span>(x) <span class="op">||</span><span class="st"> </span><span class="kw">is.null</span>(x) <span class="op">||</span><span class="st"> </span><span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb4-113"><a href="#cb4-113"></a>          <span class="kw">return</span>(<span class="ot">TRUE</span>)</span>
<span id="cb4-114"><a href="#cb4-114"></a>      <span class="cf">if</span> (<span class="kw">is.list</span>(x))</span>
<span id="cb4-115"><a href="#cb4-115"></a>          <span class="kw">return</span>(<span class="kw">all</span>(<span class="kw">sapply</span>(x, invalid)))</span>
<span id="cb4-116"><a href="#cb4-116"></a>      <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.vector</span>(x))</span>
<span id="cb4-117"><a href="#cb4-117"></a>          <span class="kw">return</span>(<span class="kw">all</span>(<span class="kw">is.na</span>(x)))</span>
<span id="cb4-118"><a href="#cb4-118"></a>      <span class="cf">else</span> <span class="kw">return</span>(<span class="ot">FALSE</span>)</span>
<span id="cb4-119"><a href="#cb4-119"></a>    }</span>
<span id="cb4-120"><a href="#cb4-120"></a></span>
<span id="cb4-121"><a href="#cb4-121"></a>    x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(x)</span>
<span id="cb4-122"><a href="#cb4-122"></a>    scale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">low =</span> <span class="kw">min</span>(x), <span class="dt">high =</span> <span class="kw">max</span>(x)) {</span>
<span id="cb4-123"><a href="#cb4-123"></a>        x &lt;-<span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>low)<span class="op">/</span>(high <span class="op">-</span><span class="st"> </span>low)</span>
<span id="cb4-124"><a href="#cb4-124"></a>        x</span>
<span id="cb4-125"><a href="#cb4-125"></a>    }</span>
<span id="cb4-126"><a href="#cb4-126"></a>    retval &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb4-127"><a href="#cb4-127"></a>    scale &lt;-<span class="st"> </span><span class="cf">if</span> (symm <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">missing</span>(scale))</span>
<span id="cb4-128"><a href="#cb4-128"></a>        <span class="st">&quot;none&quot;</span></span>
<span id="cb4-129"><a href="#cb4-129"></a>    <span class="cf">else</span> <span class="kw">match.arg</span>(scale)</span>
<span id="cb4-130"><a href="#cb4-130"></a>    dendrogram &lt;-<span class="st"> </span><span class="kw">match.arg</span>(dendrogram)</span>
<span id="cb4-131"><a href="#cb4-131"></a>    trace &lt;-<span class="st"> </span><span class="kw">match.arg</span>(trace)</span>
<span id="cb4-132"><a href="#cb4-132"></a>    density.info &lt;-<span class="st"> </span><span class="kw">match.arg</span>(density.info)</span>
<span id="cb4-133"><a href="#cb4-133"></a>    <span class="cf">if</span> (<span class="kw">length</span>(col) <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">is.character</span>(col))</span>
<span id="cb4-134"><a href="#cb4-134"></a>        col &lt;-<span class="st"> </span><span class="kw">get</span>(col, <span class="dt">mode =</span> <span class="st">&quot;function&quot;</span>)</span>
<span id="cb4-135"><a href="#cb4-135"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(breaks) <span class="op">&amp;&amp;</span><span class="st"> </span>(scale <span class="op">!=</span><span class="st"> &quot;none&quot;</span>))</span>
<span id="cb4-136"><a href="#cb4-136"></a>        <span class="kw">warning</span>(<span class="st">&quot;Using scale=</span><span class="ch">\&quot;</span><span class="st">row</span><span class="ch">\&quot;</span><span class="st"> or scale=</span><span class="ch">\&quot;</span><span class="st">column</span><span class="ch">\&quot;</span><span class="st"> when breaks are&quot;</span>,</span>
<span id="cb4-137"><a href="#cb4-137"></a>            <span class="st">&quot;specified can produce unpredictable results.&quot;</span>, <span class="st">&quot;Please consider using only one or the other.&quot;</span>)</span>
<span id="cb4-138"><a href="#cb4-138"></a>    <span class="cf">if</span> (<span class="kw">is.null</span>(Rowv) <span class="op">||</span><span class="st"> </span><span class="kw">is.na</span>(Rowv))</span>
<span id="cb4-139"><a href="#cb4-139"></a>        Rowv &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb4-140"><a href="#cb4-140"></a>    <span class="cf">if</span> (<span class="kw">is.null</span>(Colv) <span class="op">||</span><span class="st"> </span><span class="kw">is.na</span>(Colv))</span>
<span id="cb4-141"><a href="#cb4-141"></a>        Colv &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb4-142"><a href="#cb4-142"></a>    <span class="cf">else</span> <span class="cf">if</span> (Colv <span class="op">==</span><span class="st"> &quot;Rowv&quot;</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">isTRUE</span>(Rowv))</span>
<span id="cb4-143"><a href="#cb4-143"></a>        Colv &lt;-<span class="st"> </span><span class="ot">FALSE</span></span>
<span id="cb4-144"><a href="#cb4-144"></a>    <span class="cf">if</span> (<span class="kw">length</span>(di &lt;-<span class="st"> </span><span class="kw">dim</span>(x)) <span class="op">!=</span><span class="st"> </span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span><span class="op">!</span><span class="kw">is.numeric</span>(x))</span>
<span id="cb4-145"><a href="#cb4-145"></a>        <span class="kw">stop</span>(<span class="st">&quot;`x&#39; must be a numeric matrix&quot;</span>)</span>
<span id="cb4-146"><a href="#cb4-146"></a>    nr &lt;-<span class="st"> </span>di[<span class="dv">1</span>]</span>
<span id="cb4-147"><a href="#cb4-147"></a>    nc &lt;-<span class="st"> </span>di[<span class="dv">2</span>]</span>
<span id="cb4-148"><a href="#cb4-148"></a>    <span class="cf">if</span> (nr <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>nc <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb4-149"><a href="#cb4-149"></a>        <span class="kw">stop</span>(<span class="st">&quot;`x&#39; must have at least 2 rows and 2 columns&quot;</span>)</span>
<span id="cb4-150"><a href="#cb4-150"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.numeric</span>(margins) <span class="op">||</span><span class="st"> </span><span class="kw">length</span>(margins) <span class="op">!=</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb4-151"><a href="#cb4-151"></a>        <span class="kw">stop</span>(<span class="st">&quot;`margins&#39; must be a numeric vector of length 2&quot;</span>)</span>
<span id="cb4-152"><a href="#cb4-152"></a>    <span class="cf">if</span> (<span class="kw">missing</span>(cellnote))</span>
<span id="cb4-153"><a href="#cb4-153"></a>        cellnote &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="st">&quot;&quot;</span>, <span class="dt">ncol =</span> <span class="kw">ncol</span>(x), <span class="dt">nrow =</span> <span class="kw">nrow</span>(x))</span>
<span id="cb4-154"><a href="#cb4-154"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">inherits</span>(Rowv, <span class="st">&quot;dendrogram&quot;</span>)) {</span>
<span id="cb4-155"><a href="#cb4-155"></a>        <span class="cf">if</span> (((<span class="op">!</span><span class="kw">isTRUE</span>(Rowv)) <span class="op">||</span><span class="st"> </span>(<span class="kw">is.null</span>(Rowv))) <span class="op">&amp;&amp;</span><span class="st"> </span>(dendrogram <span class="op">%in%</span></span>
<span id="cb4-156"><a href="#cb4-156"></a><span class="st">            </span><span class="kw">c</span>(<span class="st">&quot;both&quot;</span>, <span class="st">&quot;row&quot;</span>))) {</span>
<span id="cb4-157"><a href="#cb4-157"></a>            <span class="cf">if</span> (<span class="kw">is.logical</span>(Colv) <span class="op">&amp;&amp;</span><span class="st"> </span>(Colv))</span>
<span id="cb4-158"><a href="#cb4-158"></a>                dendrogram &lt;-<span class="st"> &quot;column&quot;</span></span>
<span id="cb4-159"><a href="#cb4-159"></a>            <span class="cf">else</span> dedrogram &lt;-<span class="st"> &quot;none&quot;</span></span>
<span id="cb4-160"><a href="#cb4-160"></a>            <span class="kw">warning</span>(<span class="st">&quot;Discrepancy: Rowv is FALSE, while dendrogram is `&quot;</span>,</span>
<span id="cb4-161"><a href="#cb4-161"></a>                dendrogram, <span class="st">&quot;&#39;. Omitting row dendogram.&quot;</span>)</span>
<span id="cb4-162"><a href="#cb4-162"></a>        }</span>
<span id="cb4-163"><a href="#cb4-163"></a>    }</span>
<span id="cb4-164"><a href="#cb4-164"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">inherits</span>(Colv, <span class="st">&quot;dendrogram&quot;</span>)) {</span>
<span id="cb4-165"><a href="#cb4-165"></a>        <span class="cf">if</span> (((<span class="op">!</span><span class="kw">isTRUE</span>(Colv)) <span class="op">||</span><span class="st"> </span>(<span class="kw">is.null</span>(Colv))) <span class="op">&amp;&amp;</span><span class="st"> </span>(dendrogram <span class="op">%in%</span></span>
<span id="cb4-166"><a href="#cb4-166"></a><span class="st">            </span><span class="kw">c</span>(<span class="st">&quot;both&quot;</span>, <span class="st">&quot;column&quot;</span>))) {</span>
<span id="cb4-167"><a href="#cb4-167"></a>            <span class="cf">if</span> (<span class="kw">is.logical</span>(Rowv) <span class="op">&amp;&amp;</span><span class="st"> </span>(Rowv))</span>
<span id="cb4-168"><a href="#cb4-168"></a>                dendrogram &lt;-<span class="st"> &quot;row&quot;</span></span>
<span id="cb4-169"><a href="#cb4-169"></a>            <span class="cf">else</span> dendrogram &lt;-<span class="st"> &quot;none&quot;</span></span>
<span id="cb4-170"><a href="#cb4-170"></a>            <span class="kw">warning</span>(<span class="st">&quot;Discrepancy: Colv is FALSE, while dendrogram is `&quot;</span>,</span>
<span id="cb4-171"><a href="#cb4-171"></a>                dendrogram, <span class="st">&quot;&#39;. Omitting column dendogram.&quot;</span>)</span>
<span id="cb4-172"><a href="#cb4-172"></a>        }</span>
<span id="cb4-173"><a href="#cb4-173"></a>    }</span>
<span id="cb4-174"><a href="#cb4-174"></a>    <span class="cf">if</span> (<span class="kw">inherits</span>(Rowv, <span class="st">&quot;dendrogram&quot;</span>)) {</span>
<span id="cb4-175"><a href="#cb4-175"></a>        ddr &lt;-<span class="st"> </span>Rowv</span>
<span id="cb4-176"><a href="#cb4-176"></a>        rowInd &lt;-<span class="st"> </span><span class="kw">order.dendrogram</span>(ddr)</span>
<span id="cb4-177"><a href="#cb4-177"></a>    }</span>
<span id="cb4-178"><a href="#cb4-178"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.integer</span>(Rowv)) {</span>
<span id="cb4-179"><a href="#cb4-179"></a>        hcr &lt;-<span class="st"> </span><span class="kw">hclustfun</span>(<span class="kw">distfun</span>(x))</span>
<span id="cb4-180"><a href="#cb4-180"></a>        ddr &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hcr)</span>
<span id="cb4-181"><a href="#cb4-181"></a>        ddr &lt;-<span class="st"> </span><span class="kw">reorder</span>(ddr, Rowv)</span>
<span id="cb4-182"><a href="#cb4-182"></a>        rowInd &lt;-<span class="st"> </span><span class="kw">order.dendrogram</span>(ddr)</span>
<span id="cb4-183"><a href="#cb4-183"></a>        <span class="cf">if</span> (nr <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(rowInd))</span>
<span id="cb4-184"><a href="#cb4-184"></a>            <span class="kw">stop</span>(<span class="st">&quot;row dendrogram ordering gave index of wrong length&quot;</span>)</span>
<span id="cb4-185"><a href="#cb4-185"></a>    }</span>
<span id="cb4-186"><a href="#cb4-186"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">isTRUE</span>(Rowv)) {</span>
<span id="cb4-187"><a href="#cb4-187"></a>        Rowv &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(x, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb4-188"><a href="#cb4-188"></a>        hcr &lt;-<span class="st"> </span><span class="kw">hclustfun</span>(<span class="kw">distfun</span>(x))</span>
<span id="cb4-189"><a href="#cb4-189"></a>        ddr &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hcr)</span>
<span id="cb4-190"><a href="#cb4-190"></a>        ddr &lt;-<span class="st"> </span><span class="kw">reorder</span>(ddr, Rowv)</span>
<span id="cb4-191"><a href="#cb4-191"></a>        rowInd &lt;-<span class="st"> </span><span class="kw">order.dendrogram</span>(ddr)</span>
<span id="cb4-192"><a href="#cb4-192"></a>        <span class="cf">if</span> (nr <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(rowInd))</span>
<span id="cb4-193"><a href="#cb4-193"></a>            <span class="kw">stop</span>(<span class="st">&quot;row dendrogram ordering gave index of wrong length&quot;</span>)</span>
<span id="cb4-194"><a href="#cb4-194"></a>    }</span>
<span id="cb4-195"><a href="#cb4-195"></a>    <span class="cf">else</span> {</span>
<span id="cb4-196"><a href="#cb4-196"></a>        rowInd &lt;-<span class="st"> </span>nr<span class="op">:</span><span class="dv">1</span></span>
<span id="cb4-197"><a href="#cb4-197"></a>    }</span>
<span id="cb4-198"><a href="#cb4-198"></a>    <span class="cf">if</span> (<span class="kw">inherits</span>(Colv, <span class="st">&quot;dendrogram&quot;</span>)) {</span>
<span id="cb4-199"><a href="#cb4-199"></a>        ddc &lt;-<span class="st"> </span>Colv</span>
<span id="cb4-200"><a href="#cb4-200"></a>        colInd &lt;-<span class="st"> </span><span class="kw">order.dendrogram</span>(ddc)</span>
<span id="cb4-201"><a href="#cb4-201"></a>    }</span>
<span id="cb4-202"><a href="#cb4-202"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">identical</span>(Colv, <span class="st">&quot;Rowv&quot;</span>)) {</span>
<span id="cb4-203"><a href="#cb4-203"></a>        <span class="cf">if</span> (nr <span class="op">!=</span><span class="st"> </span>nc)</span>
<span id="cb4-204"><a href="#cb4-204"></a>            <span class="kw">stop</span>(<span class="st">&quot;Colv = </span><span class="ch">\&quot;</span><span class="st">Rowv</span><span class="ch">\&quot;</span><span class="st"> but nrow(x) != ncol(x)&quot;</span>)</span>
<span id="cb4-205"><a href="#cb4-205"></a>        <span class="cf">if</span> (<span class="kw">exists</span>(<span class="st">&quot;ddr&quot;</span>)) {</span>
<span id="cb4-206"><a href="#cb4-206"></a>            ddc &lt;-<span class="st"> </span>ddr</span>
<span id="cb4-207"><a href="#cb4-207"></a>            colInd &lt;-<span class="st"> </span><span class="kw">order.dendrogram</span>(ddc)</span>
<span id="cb4-208"><a href="#cb4-208"></a>        }</span>
<span id="cb4-209"><a href="#cb4-209"></a>        <span class="cf">else</span> colInd &lt;-<span class="st"> </span>rowInd</span>
<span id="cb4-210"><a href="#cb4-210"></a>    }</span>
<span id="cb4-211"><a href="#cb4-211"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.integer</span>(Colv)) {</span>
<span id="cb4-212"><a href="#cb4-212"></a>        hcc &lt;-<span class="st"> </span><span class="kw">hclustfun</span>(<span class="kw">distfun</span>(<span class="cf">if</span> (symm)</span>
<span id="cb4-213"><a href="#cb4-213"></a>            x</span>
<span id="cb4-214"><a href="#cb4-214"></a>        <span class="cf">else</span> <span class="kw">t</span>(x)))</span>
<span id="cb4-215"><a href="#cb4-215"></a>        ddc &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hcc)</span>
<span id="cb4-216"><a href="#cb4-216"></a>        ddc &lt;-<span class="st"> </span><span class="kw">reorder</span>(ddc, Colv)</span>
<span id="cb4-217"><a href="#cb4-217"></a>        colInd &lt;-<span class="st"> </span><span class="kw">order.dendrogram</span>(ddc)</span>
<span id="cb4-218"><a href="#cb4-218"></a>        <span class="cf">if</span> (nc <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(colInd))</span>
<span id="cb4-219"><a href="#cb4-219"></a>            <span class="kw">stop</span>(<span class="st">&quot;column dendrogram ordering gave index of wrong length&quot;</span>)</span>
<span id="cb4-220"><a href="#cb4-220"></a>    }</span>
<span id="cb4-221"><a href="#cb4-221"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">isTRUE</span>(Colv)) {</span>
<span id="cb4-222"><a href="#cb4-222"></a>        Colv &lt;-<span class="st"> </span><span class="kw">colMeans</span>(x, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb4-223"><a href="#cb4-223"></a>        hcc &lt;-<span class="st"> </span><span class="kw">hclustfun</span>(<span class="kw">distfun</span>(<span class="cf">if</span> (symm)</span>
<span id="cb4-224"><a href="#cb4-224"></a>            x</span>
<span id="cb4-225"><a href="#cb4-225"></a>        <span class="cf">else</span> <span class="kw">t</span>(x)))</span>
<span id="cb4-226"><a href="#cb4-226"></a>        ddc &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hcc)</span>
<span id="cb4-227"><a href="#cb4-227"></a>        ddc &lt;-<span class="st"> </span><span class="kw">reorder</span>(ddc, Colv)</span>
<span id="cb4-228"><a href="#cb4-228"></a>        colInd &lt;-<span class="st"> </span><span class="kw">order.dendrogram</span>(ddc)</span>
<span id="cb4-229"><a href="#cb4-229"></a>        <span class="cf">if</span> (nc <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(colInd))</span>
<span id="cb4-230"><a href="#cb4-230"></a>            <span class="kw">stop</span>(<span class="st">&quot;column dendrogram ordering gave index of wrong length&quot;</span>)</span>
<span id="cb4-231"><a href="#cb4-231"></a>    }</span>
<span id="cb4-232"><a href="#cb4-232"></a>    <span class="cf">else</span> {</span>
<span id="cb4-233"><a href="#cb4-233"></a>        colInd &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>nc</span>
<span id="cb4-234"><a href="#cb4-234"></a>    }</span>
<span id="cb4-235"><a href="#cb4-235"></a>    retval<span class="op">$</span>rowInd &lt;-<span class="st"> </span>rowInd</span>
<span id="cb4-236"><a href="#cb4-236"></a>    retval<span class="op">$</span>colInd &lt;-<span class="st"> </span>colInd</span>
<span id="cb4-237"><a href="#cb4-237"></a>    retval<span class="op">$</span>call &lt;-<span class="st"> </span><span class="kw">match.call</span>()</span>
<span id="cb4-238"><a href="#cb4-238"></a>    x &lt;-<span class="st"> </span>x[rowInd, colInd]</span>
<span id="cb4-239"><a href="#cb4-239"></a>    x.unscaled &lt;-<span class="st"> </span>x</span>
<span id="cb4-240"><a href="#cb4-240"></a>    cellnote &lt;-<span class="st"> </span>cellnote[rowInd, colInd]</span>
<span id="cb4-241"><a href="#cb4-241"></a>    <span class="cf">if</span> (<span class="kw">is.null</span>(labRow))</span>
<span id="cb4-242"><a href="#cb4-242"></a>        labRow &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">is.null</span>(<span class="kw">rownames</span>(x)))</span>
<span id="cb4-243"><a href="#cb4-243"></a>            (<span class="dv">1</span><span class="op">:</span>nr)[rowInd]</span>
<span id="cb4-244"><a href="#cb4-244"></a>        <span class="cf">else</span> <span class="kw">rownames</span>(x)</span>
<span id="cb4-245"><a href="#cb4-245"></a>    <span class="cf">else</span> labRow &lt;-<span class="st"> </span>labRow[rowInd]</span>
<span id="cb4-246"><a href="#cb4-246"></a>    <span class="cf">if</span> (<span class="kw">is.null</span>(labCol))</span>
<span id="cb4-247"><a href="#cb4-247"></a>        labCol &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">is.null</span>(<span class="kw">colnames</span>(x)))</span>
<span id="cb4-248"><a href="#cb4-248"></a>            (<span class="dv">1</span><span class="op">:</span>nc)[colInd]</span>
<span id="cb4-249"><a href="#cb4-249"></a>        <span class="cf">else</span> <span class="kw">colnames</span>(x)</span>
<span id="cb4-250"><a href="#cb4-250"></a>    <span class="cf">else</span> labCol &lt;-<span class="st"> </span>labCol[colInd]</span>
<span id="cb4-251"><a href="#cb4-251"></a>    <span class="cf">if</span> (scale <span class="op">==</span><span class="st"> &quot;row&quot;</span>) {</span>
<span id="cb4-252"><a href="#cb4-252"></a>        retval<span class="op">$</span>rowMeans &lt;-<span class="st"> </span>rm &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(x, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb4-253"><a href="#cb4-253"></a>        x &lt;-<span class="st"> </span><span class="kw">sweep</span>(x, <span class="dv">1</span>, rm)</span>
<span id="cb4-254"><a href="#cb4-254"></a>        retval<span class="op">$</span>rowSDs &lt;-<span class="st"> </span>sx &lt;-<span class="st"> </span><span class="kw">apply</span>(x, <span class="dv">1</span>, sd, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb4-255"><a href="#cb4-255"></a>        x &lt;-<span class="st"> </span><span class="kw">sweep</span>(x, <span class="dv">1</span>, sx, <span class="st">&quot;/&quot;</span>)</span>
<span id="cb4-256"><a href="#cb4-256"></a>    }</span>
<span id="cb4-257"><a href="#cb4-257"></a>    <span class="cf">else</span> <span class="cf">if</span> (scale <span class="op">==</span><span class="st"> &quot;column&quot;</span>) {</span>
<span id="cb4-258"><a href="#cb4-258"></a>        retval<span class="op">$</span>colMeans &lt;-<span class="st"> </span>rm &lt;-<span class="st"> </span><span class="kw">colMeans</span>(x, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb4-259"><a href="#cb4-259"></a>        x &lt;-<span class="st"> </span><span class="kw">sweep</span>(x, <span class="dv">2</span>, rm)</span>
<span id="cb4-260"><a href="#cb4-260"></a>        retval<span class="op">$</span>colSDs &lt;-<span class="st"> </span>sx &lt;-<span class="st"> </span><span class="kw">apply</span>(x, <span class="dv">2</span>, sd, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb4-261"><a href="#cb4-261"></a>        x &lt;-<span class="st"> </span><span class="kw">sweep</span>(x, <span class="dv">2</span>, sx, <span class="st">&quot;/&quot;</span>)</span>
<span id="cb4-262"><a href="#cb4-262"></a>    }</span>
<span id="cb4-263"><a href="#cb4-263"></a>    <span class="cf">if</span> (<span class="kw">missing</span>(breaks) <span class="op">||</span><span class="st"> </span><span class="kw">is.null</span>(breaks) <span class="op">||</span><span class="st"> </span><span class="kw">length</span>(breaks) <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb4-264"><a href="#cb4-264"></a>        <span class="cf">if</span> (<span class="kw">missing</span>(col) <span class="op">||</span><span class="st"> </span><span class="kw">is.function</span>(col))</span>
<span id="cb4-265"><a href="#cb4-265"></a>            breaks &lt;-<span class="st"> </span><span class="dv">16</span></span>
<span id="cb4-266"><a href="#cb4-266"></a>        <span class="cf">else</span> breaks &lt;-<span class="st"> </span><span class="kw">length</span>(col) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb4-267"><a href="#cb4-267"></a>    }</span>
<span id="cb4-268"><a href="#cb4-268"></a>    <span class="cf">if</span> (<span class="kw">length</span>(breaks) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb4-269"><a href="#cb4-269"></a>        <span class="cf">if</span> (<span class="op">!</span>symbreaks)</span>
<span id="cb4-270"><a href="#cb4-270"></a>            breaks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(x, <span class="dt">na.rm =</span> na.rm), <span class="kw">max</span>(x, <span class="dt">na.rm =</span> na.rm),</span>
<span id="cb4-271"><a href="#cb4-271"></a>                <span class="dt">length =</span> breaks)</span>
<span id="cb4-272"><a href="#cb4-272"></a>        <span class="cf">else</span> {</span>
<span id="cb4-273"><a href="#cb4-273"></a>            extreme &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">abs</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-274"><a href="#cb4-274"></a>            breaks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span>extreme, extreme, <span class="dt">length =</span> breaks)</span>
<span id="cb4-275"><a href="#cb4-275"></a>        }</span>
<span id="cb4-276"><a href="#cb4-276"></a>    }</span>
<span id="cb4-277"><a href="#cb4-277"></a>    nbr &lt;-<span class="st"> </span><span class="kw">length</span>(breaks)</span>
<span id="cb4-278"><a href="#cb4-278"></a>    ncol &lt;-<span class="st"> </span><span class="kw">length</span>(breaks) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb4-279"><a href="#cb4-279"></a>    <span class="cf">if</span> (<span class="kw">class</span>(col) <span class="op">==</span><span class="st"> &quot;function&quot;</span>)</span>
<span id="cb4-280"><a href="#cb4-280"></a>        col &lt;-<span class="st"> </span><span class="kw">col</span>(ncol)</span>
<span id="cb4-281"><a href="#cb4-281"></a>    min.breaks &lt;-<span class="st"> </span><span class="kw">min</span>(breaks)</span>
<span id="cb4-282"><a href="#cb4-282"></a>    max.breaks &lt;-<span class="st"> </span><span class="kw">max</span>(breaks)</span>
<span id="cb4-283"><a href="#cb4-283"></a>    x[x <span class="op">&lt;</span><span class="st"> </span>min.breaks] &lt;-<span class="st"> </span>min.breaks</span>
<span id="cb4-284"><a href="#cb4-284"></a>    x[x <span class="op">&gt;</span><span class="st"> </span>max.breaks] &lt;-<span class="st"> </span>max.breaks</span>
<span id="cb4-285"><a href="#cb4-285"></a>    <span class="cf">if</span> (<span class="kw">missing</span>(lhei) <span class="op">||</span><span class="st"> </span><span class="kw">is.null</span>(lhei))</span>
<span id="cb4-286"><a href="#cb4-286"></a>        lhei &lt;-<span class="st"> </span><span class="kw">c</span>(keysize, <span class="dv">4</span>)</span>
<span id="cb4-287"><a href="#cb4-287"></a>    <span class="cf">if</span> (<span class="kw">missing</span>(lwid) <span class="op">||</span><span class="st"> </span><span class="kw">is.null</span>(lwid))</span>
<span id="cb4-288"><a href="#cb4-288"></a>        lwid &lt;-<span class="st"> </span><span class="kw">c</span>(keysize, <span class="dv">4</span>)</span>
<span id="cb4-289"><a href="#cb4-289"></a>    <span class="cf">if</span> (<span class="kw">missing</span>(lmat) <span class="op">||</span><span class="st"> </span><span class="kw">is.null</span>(lmat)) {</span>
<span id="cb4-290"><a href="#cb4-290"></a>        lmat &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb4-291"><a href="#cb4-291"></a></span>
<span id="cb4-292"><a href="#cb4-292"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(ColSideColors)) {</span>
<span id="cb4-293"><a href="#cb4-293"></a>           <span class="co">#if (!is.matrix(ColSideColors))</span></span>
<span id="cb4-294"><a href="#cb4-294"></a>           <span class="co">#stop(&quot;&#39;ColSideColors&#39; must be a matrix&quot;)</span></span>
<span id="cb4-295"><a href="#cb4-295"></a>            <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.character</span>(ColSideColors) <span class="op">||</span><span class="st"> </span><span class="kw">nrow</span>(ColSideColors) <span class="op">!=</span><span class="st"> </span>nc)</span>
<span id="cb4-296"><a href="#cb4-296"></a>                <span class="kw">stop</span>(<span class="st">&quot;&#39;ColSideColors&#39; must be a matrix of nrow(x) rows&quot;</span>)</span>
<span id="cb4-297"><a href="#cb4-297"></a>            lmat &lt;-<span class="st"> </span><span class="kw">rbind</span>(lmat[<span class="dv">1</span>, ] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span>), lmat[<span class="dv">2</span>, ] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb4-298"><a href="#cb4-298"></a>            <span class="co">#lhei &lt;- c(lhei[1], 0.2, lhei[2])</span></span>
<span id="cb4-299"><a href="#cb4-299"></a>             lhei=<span class="kw">c</span>(lhei[<span class="dv">1</span>], side.height.fraction<span class="op">*</span>ColSideColorsSize<span class="op">/</span><span class="dv">2</span>, lhei[<span class="dv">2</span>])</span>
<span id="cb4-300"><a href="#cb4-300"></a>        }</span>
<span id="cb4-301"><a href="#cb4-301"></a></span>
<span id="cb4-302"><a href="#cb4-302"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(RowSideColors)) {</span>
<span id="cb4-303"><a href="#cb4-303"></a>            <span class="co">#if (!is.matrix(RowSideColors))</span></span>
<span id="cb4-304"><a href="#cb4-304"></a>            <span class="co">#stop(&quot;&#39;RowSideColors&#39; must be a matrix&quot;)</span></span>
<span id="cb4-305"><a href="#cb4-305"></a>            <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.character</span>(RowSideColors) <span class="op">||</span><span class="st"> </span><span class="kw">ncol</span>(RowSideColors) <span class="op">!=</span><span class="st"> </span>nr)</span>
<span id="cb4-306"><a href="#cb4-306"></a>                <span class="kw">stop</span>(<span class="st">&quot;&#39;RowSideColors&#39; must be a matrix of ncol(x) columns&quot;</span>)</span>
<span id="cb4-307"><a href="#cb4-307"></a>            lmat &lt;-<span class="st"> </span><span class="kw">cbind</span>(lmat[, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">c</span>(<span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(lmat) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span>), lmat[,<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb4-308"><a href="#cb4-308"></a>            <span class="co">#lwid &lt;- c(lwid[1], 0.2, lwid[2])</span></span>
<span id="cb4-309"><a href="#cb4-309"></a>            lwid &lt;-<span class="st"> </span><span class="kw">c</span>(lwid[<span class="dv">1</span>], side.height.fraction<span class="op">*</span>RowSideColorsSize<span class="op">/</span><span class="dv">2</span>, lwid[<span class="dv">2</span>])</span>
<span id="cb4-310"><a href="#cb4-310"></a>        }</span>
<span id="cb4-311"><a href="#cb4-311"></a>        lmat[<span class="kw">is.na</span>(lmat)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb4-312"><a href="#cb4-312"></a>    }</span>
<span id="cb4-313"><a href="#cb4-313"></a></span>
<span id="cb4-314"><a href="#cb4-314"></a>    <span class="cf">if</span> (<span class="kw">length</span>(lhei) <span class="op">!=</span><span class="st"> </span><span class="kw">nrow</span>(lmat))</span>
<span id="cb4-315"><a href="#cb4-315"></a>        <span class="kw">stop</span>(<span class="st">&quot;lhei must have length = nrow(lmat) = &quot;</span>, <span class="kw">nrow</span>(lmat))</span>
<span id="cb4-316"><a href="#cb4-316"></a>    <span class="cf">if</span> (<span class="kw">length</span>(lwid) <span class="op">!=</span><span class="st"> </span><span class="kw">ncol</span>(lmat))</span>
<span id="cb4-317"><a href="#cb4-317"></a>        <span class="kw">stop</span>(<span class="st">&quot;lwid must have length = ncol(lmat) =&quot;</span>, <span class="kw">ncol</span>(lmat))</span>
<span id="cb4-318"><a href="#cb4-318"></a>    op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">no.readonly =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-319"><a href="#cb4-319"></a>    <span class="kw">on.exit</span>(<span class="kw">par</span>(op))</span>
<span id="cb4-320"><a href="#cb4-320"></a></span>
<span id="cb4-321"><a href="#cb4-321"></a>    <span class="kw">layout</span>(lmat, <span class="dt">widths =</span> lwid, <span class="dt">heights =</span> lhei, <span class="dt">respect =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-322"><a href="#cb4-322"></a></span>
<span id="cb4-323"><a href="#cb4-323"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(RowSideColors)) {</span>
<span id="cb4-324"><a href="#cb4-324"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.matrix</span>(RowSideColors)){</span>
<span id="cb4-325"><a href="#cb4-325"></a>                <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(margins[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb4-326"><a href="#cb4-326"></a>                <span class="kw">image</span>(<span class="kw">rbind</span>(<span class="dv">1</span><span class="op">:</span>nr), <span class="dt">col =</span> RowSideColors[rowInd], <span class="dt">axes =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-327"><a href="#cb4-327"></a>        } <span class="cf">else</span> {</span>
<span id="cb4-328"><a href="#cb4-328"></a>            <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(margins[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb4-329"><a href="#cb4-329"></a>            rsc =<span class="st"> </span><span class="kw">t</span>(RowSideColors[,rowInd, <span class="dt">drop=</span><span class="ot">FALSE</span>])</span>
<span id="cb4-330"><a href="#cb4-330"></a>            rsc.colors =<span class="st"> </span><span class="kw">matrix</span>()</span>
<span id="cb4-331"><a href="#cb4-331"></a>            rsc.names =<span class="st"> </span><span class="kw">names</span>(<span class="kw">table</span>(rsc))</span>
<span id="cb4-332"><a href="#cb4-332"></a>            rsc.i =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb4-333"><a href="#cb4-333"></a>            <span class="cf">for</span> (rsc.name <span class="cf">in</span> rsc.names) {</span>
<span id="cb4-334"><a href="#cb4-334"></a>                rsc.colors[rsc.i] =<span class="st"> </span>rsc.name</span>
<span id="cb4-335"><a href="#cb4-335"></a>                rsc[rsc <span class="op">==</span><span class="st"> </span>rsc.name] =<span class="st"> </span>rsc.i</span>
<span id="cb4-336"><a href="#cb4-336"></a>                rsc.i =<span class="st"> </span>rsc.i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb4-337"><a href="#cb4-337"></a>            }</span>
<span id="cb4-338"><a href="#cb4-338"></a>            rsc =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">as.numeric</span>(rsc), <span class="dt">nrow =</span> <span class="kw">dim</span>(rsc)[<span class="dv">1</span>])</span>
<span id="cb4-339"><a href="#cb4-339"></a>            <span class="kw">image</span>(<span class="kw">t</span>(rsc), <span class="dt">col =</span> <span class="kw">as.vector</span>(rsc.colors), <span class="dt">axes =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-340"><a href="#cb4-340"></a>            <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">rownames</span>(RowSideColors)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb4-341"><a href="#cb4-341"></a>                <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dv">0</span><span class="op">:</span>(<span class="kw">dim</span>(rsc)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="kw">max</span>(<span class="dv">1</span>,(<span class="kw">dim</span>(rsc)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)), <span class="kw">rownames</span>(RowSideColors), <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">tick =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-342"><a href="#cb4-342"></a>            }</span>
<span id="cb4-343"><a href="#cb4-343"></a>        }</span>
<span id="cb4-344"><a href="#cb4-344"></a>    }</span>
<span id="cb4-345"><a href="#cb4-345"></a></span>
<span id="cb4-346"><a href="#cb4-346"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(ColSideColors)) {</span>
<span id="cb4-347"><a href="#cb4-347"></a></span>
<span id="cb4-348"><a href="#cb4-348"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.matrix</span>(ColSideColors)){</span>
<span id="cb4-349"><a href="#cb4-349"></a>            <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, margins[<span class="dv">2</span>]))</span>
<span id="cb4-350"><a href="#cb4-350"></a>            <span class="kw">image</span>(<span class="kw">cbind</span>(<span class="dv">1</span><span class="op">:</span>nc), <span class="dt">col =</span> ColSideColors[colInd], <span class="dt">axes =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-351"><a href="#cb4-351"></a>        } <span class="cf">else</span> {</span>
<span id="cb4-352"><a href="#cb4-352"></a>            <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, margins[<span class="dv">2</span>]))</span>
<span id="cb4-353"><a href="#cb4-353"></a>            csc =<span class="st"> </span>ColSideColors[colInd, , drop=<span class="ot">FALSE</span>]</span>
<span id="cb4-354"><a href="#cb4-354"></a>            csc.colors =<span class="st"> </span><span class="kw">matrix</span>()</span>
<span id="cb4-355"><a href="#cb4-355"></a>            csc.names =<span class="st"> </span><span class="kw">names</span>(<span class="kw">table</span>(csc))</span>
<span id="cb4-356"><a href="#cb4-356"></a>            csc.i =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb4-357"><a href="#cb4-357"></a>            <span class="cf">for</span> (csc.name <span class="cf">in</span> csc.names) {</span>
<span id="cb4-358"><a href="#cb4-358"></a>                csc.colors[csc.i] =<span class="st"> </span>csc.name</span>
<span id="cb4-359"><a href="#cb4-359"></a>                csc[csc <span class="op">==</span><span class="st"> </span>csc.name] =<span class="st"> </span>csc.i</span>
<span id="cb4-360"><a href="#cb4-360"></a>                csc.i =<span class="st"> </span>csc.i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb4-361"><a href="#cb4-361"></a>            }</span>
<span id="cb4-362"><a href="#cb4-362"></a>            csc =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">as.numeric</span>(csc), <span class="dt">nrow =</span> <span class="kw">dim</span>(csc)[<span class="dv">1</span>])</span>
<span id="cb4-363"><a href="#cb4-363"></a>            <span class="kw">image</span>(csc, <span class="dt">col =</span> <span class="kw">as.vector</span>(csc.colors), <span class="dt">axes =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-364"><a href="#cb4-364"></a>            <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">colnames</span>(ColSideColors)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb4-365"><a href="#cb4-365"></a>                <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dv">0</span><span class="op">:</span>(<span class="kw">dim</span>(csc)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="kw">max</span>(<span class="dv">1</span>,(<span class="kw">dim</span>(csc)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)), <span class="kw">colnames</span>(ColSideColors), <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">tick =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-366"><a href="#cb4-366"></a>            }</span>
<span id="cb4-367"><a href="#cb4-367"></a>        }</span>
<span id="cb4-368"><a href="#cb4-368"></a>    }</span>
<span id="cb4-369"><a href="#cb4-369"></a></span>
<span id="cb4-370"><a href="#cb4-370"></a>    <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(margins[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>, margins[<span class="dv">2</span>]))</span>
<span id="cb4-371"><a href="#cb4-371"></a>    x &lt;-<span class="st"> </span><span class="kw">t</span>(x)</span>
<span id="cb4-372"><a href="#cb4-372"></a>    cellnote &lt;-<span class="st"> </span><span class="kw">t</span>(cellnote)</span>
<span id="cb4-373"><a href="#cb4-373"></a>    <span class="cf">if</span> (revC) {</span>
<span id="cb4-374"><a href="#cb4-374"></a>        iy &lt;-<span class="st"> </span>nr<span class="op">:</span><span class="dv">1</span></span>
<span id="cb4-375"><a href="#cb4-375"></a>        <span class="cf">if</span> (<span class="kw">exists</span>(<span class="st">&quot;ddr&quot;</span>))</span>
<span id="cb4-376"><a href="#cb4-376"></a>            ddr &lt;-<span class="st"> </span><span class="kw">rev</span>(ddr)</span>
<span id="cb4-377"><a href="#cb4-377"></a>        x &lt;-<span class="st"> </span>x[, iy]</span>
<span id="cb4-378"><a href="#cb4-378"></a>        cellnote &lt;-<span class="st"> </span>cellnote[, iy]</span>
<span id="cb4-379"><a href="#cb4-379"></a>    }</span>
<span id="cb4-380"><a href="#cb4-380"></a>    <span class="cf">else</span> iy &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>nr</span>
<span id="cb4-381"><a href="#cb4-381"></a>    <span class="kw">image</span>(<span class="dv">1</span><span class="op">:</span>nc, <span class="dv">1</span><span class="op">:</span>nr, x, <span class="dt">xlim =</span> <span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, nc), <span class="dt">ylim =</span> <span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, nr), <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> col, <span class="dt">breaks =</span> breaks, ...)</span>
<span id="cb4-382"><a href="#cb4-382"></a>    retval<span class="op">$</span>carpet &lt;-<span class="st"> </span>x</span>
<span id="cb4-383"><a href="#cb4-383"></a>    <span class="cf">if</span> (<span class="kw">exists</span>(<span class="st">&quot;ddr&quot;</span>))</span>
<span id="cb4-384"><a href="#cb4-384"></a>        retval<span class="op">$</span>rowDendrogram &lt;-<span class="st"> </span>ddr</span>
<span id="cb4-385"><a href="#cb4-385"></a>    <span class="cf">if</span> (<span class="kw">exists</span>(<span class="st">&quot;ddc&quot;</span>))</span>
<span id="cb4-386"><a href="#cb4-386"></a>        retval<span class="op">$</span>colDendrogram &lt;-<span class="st"> </span>ddc</span>
<span id="cb4-387"><a href="#cb4-387"></a>    retval<span class="op">$</span>breaks &lt;-<span class="st"> </span>breaks</span>
<span id="cb4-388"><a href="#cb4-388"></a>    retval<span class="op">$</span>col &lt;-<span class="st"> </span>col</span>
<span id="cb4-389"><a href="#cb4-389"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">invalid</span>(na.color) <span class="op">&amp;</span><span class="st"> </span><span class="kw">any</span>(<span class="kw">is.na</span>(x))) { <span class="co"># load library(gplots)</span></span>
<span id="cb4-390"><a href="#cb4-390"></a>        mmat &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(x), <span class="dv">1</span>, <span class="ot">NA</span>)</span>
<span id="cb4-391"><a href="#cb4-391"></a>        <span class="kw">image</span>(<span class="dv">1</span><span class="op">:</span>nc, <span class="dv">1</span><span class="op">:</span>nr, mmat, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb4-392"><a href="#cb4-392"></a>            <span class="dt">col =</span> na.color, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-393"><a href="#cb4-393"></a>    }</span>
<span id="cb4-394"><a href="#cb4-394"></a>    <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span>nc, <span class="dt">labels =</span> labCol, <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="fl">-0.5</span>, <span class="dt">tick =</span> <span class="dv">0</span>,</span>
<span id="cb4-395"><a href="#cb4-395"></a>        <span class="dt">cex.axis =</span> cexCol)</span>
<span id="cb4-396"><a href="#cb4-396"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(xlab))</span>
<span id="cb4-397"><a href="#cb4-397"></a>        <span class="kw">mtext</span>(xlab, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">line =</span> margins[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.25</span>)</span>
<span id="cb4-398"><a href="#cb4-398"></a>    <span class="kw">axis</span>(<span class="dv">4</span>, iy, <span class="dt">labels =</span> labRow, <span class="dt">las =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="fl">-0.5</span>, <span class="dt">tick =</span> <span class="dv">0</span>,</span>
<span id="cb4-399"><a href="#cb4-399"></a>        <span class="dt">cex.axis =</span> cexRow)</span>
<span id="cb4-400"><a href="#cb4-400"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(ylab))</span>
<span id="cb4-401"><a href="#cb4-401"></a>        <span class="kw">mtext</span>(ylab, <span class="dt">side =</span> <span class="dv">4</span>, <span class="dt">line =</span> margins[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.25</span>)</span>
<span id="cb4-402"><a href="#cb4-402"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(add.expr))</span>
<span id="cb4-403"><a href="#cb4-403"></a>        <span class="kw">eval</span>(<span class="kw">substitute</span>(add.expr))</span>
<span id="cb4-404"><a href="#cb4-404"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(colsep))</span>
<span id="cb4-405"><a href="#cb4-405"></a>        <span class="cf">for</span> (csep <span class="cf">in</span> colsep) <span class="kw">rect</span>(<span class="dt">xleft =</span> csep <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dt">ybottom =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">length</span>(csep)), <span class="dt">xright =</span> csep <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span>sepwidth[<span class="dv">1</span>], <span class="dt">ytop =</span> <span class="kw">rep</span>(<span class="kw">ncol</span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, csep), <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">col =</span> sepcolor, <span class="dt">border =</span> sepcolor)</span>
<span id="cb4-406"><a href="#cb4-406"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(rowsep))</span>
<span id="cb4-407"><a href="#cb4-407"></a>        <span class="cf">for</span> (rsep <span class="cf">in</span> rowsep) <span class="kw">rect</span>(<span class="dt">xleft =</span> <span class="dv">0</span>, <span class="dt">ybottom =</span> (<span class="kw">ncol</span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rsep) <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dt">xright =</span> <span class="kw">nrow</span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">ytop =</span> (<span class="kw">ncol</span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rsep) <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">-</span><span class="st"> </span>sepwidth[<span class="dv">2</span>], <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">col =</span> sepcolor, <span class="dt">border =</span> sepcolor)</span>
<span id="cb4-408"><a href="#cb4-408"></a>    min.scale &lt;-<span class="st"> </span><span class="kw">min</span>(breaks)</span>
<span id="cb4-409"><a href="#cb4-409"></a>    max.scale &lt;-<span class="st"> </span><span class="kw">max</span>(breaks)</span>
<span id="cb4-410"><a href="#cb4-410"></a>    x.scaled &lt;-<span class="st"> </span><span class="kw">scale01</span>(<span class="kw">t</span>(x), min.scale, max.scale)</span>
<span id="cb4-411"><a href="#cb4-411"></a>    <span class="cf">if</span> (trace <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;both&quot;</span>, <span class="st">&quot;column&quot;</span>)) {</span>
<span id="cb4-412"><a href="#cb4-412"></a>        retval<span class="op">$</span>vline &lt;-<span class="st"> </span>vline</span>
<span id="cb4-413"><a href="#cb4-413"></a>        vline.vals &lt;-<span class="st"> </span><span class="kw">scale01</span>(vline, min.scale, max.scale)</span>
<span id="cb4-414"><a href="#cb4-414"></a>        <span class="cf">for</span> (i <span class="cf">in</span> colInd) {</span>
<span id="cb4-415"><a href="#cb4-415"></a>            <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(vline)) {</span>
<span id="cb4-416"><a href="#cb4-416"></a>                <span class="kw">abline</span>(<span class="dt">v =</span> i <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span>vline.vals, <span class="dt">col =</span> linecol,</span>
<span id="cb4-417"><a href="#cb4-417"></a>                  <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb4-418"><a href="#cb4-418"></a>            }</span>
<span id="cb4-419"><a href="#cb4-419"></a>            xv &lt;-<span class="st"> </span><span class="kw">rep</span>(i, <span class="kw">nrow</span>(x.scaled)) <span class="op">+</span><span class="st"> </span>x.scaled[, i] <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb4-420"><a href="#cb4-420"></a>            xv &lt;-<span class="st"> </span><span class="kw">c</span>(xv[<span class="dv">1</span>], xv)</span>
<span id="cb4-421"><a href="#cb4-421"></a>            yv &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(xv) <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb4-422"><a href="#cb4-422"></a>            <span class="kw">lines</span>(<span class="dt">x =</span> xv, <span class="dt">y =</span> yv, <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">col =</span> tracecol, <span class="dt">type =</span> <span class="st">&quot;s&quot;</span>)</span>
<span id="cb4-423"><a href="#cb4-423"></a>        }</span>
<span id="cb4-424"><a href="#cb4-424"></a>    }</span>
<span id="cb4-425"><a href="#cb4-425"></a>    <span class="cf">if</span> (trace <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;both&quot;</span>, <span class="st">&quot;row&quot;</span>)) {</span>
<span id="cb4-426"><a href="#cb4-426"></a>        retval<span class="op">$</span>hline &lt;-<span class="st"> </span>hline</span>
<span id="cb4-427"><a href="#cb4-427"></a>        hline.vals &lt;-<span class="st"> </span><span class="kw">scale01</span>(hline, min.scale, max.scale)</span>
<span id="cb4-428"><a href="#cb4-428"></a>        <span class="cf">for</span> (i <span class="cf">in</span> rowInd) {</span>
<span id="cb4-429"><a href="#cb4-429"></a>            <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(hline)) {</span>
<span id="cb4-430"><a href="#cb4-430"></a>                <span class="kw">abline</span>(<span class="dt">h =</span> i <span class="op">+</span><span class="st"> </span>hline, <span class="dt">col =</span> linecol, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb4-431"><a href="#cb4-431"></a>            }</span>
<span id="cb4-432"><a href="#cb4-432"></a>            yv &lt;-<span class="st"> </span><span class="kw">rep</span>(i, <span class="kw">ncol</span>(x.scaled)) <span class="op">+</span><span class="st"> </span>x.scaled[i, ] <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb4-433"><a href="#cb4-433"></a>            yv &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">c</span>(yv[<span class="dv">1</span>], yv))</span>
<span id="cb4-434"><a href="#cb4-434"></a>            xv &lt;-<span class="st"> </span><span class="kw">length</span>(yv)<span class="op">:</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb4-435"><a href="#cb4-435"></a>            <span class="kw">lines</span>(<span class="dt">x =</span> xv, <span class="dt">y =</span> yv, <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">col =</span> tracecol, <span class="dt">type =</span> <span class="st">&quot;s&quot;</span>)</span>
<span id="cb4-436"><a href="#cb4-436"></a>        }</span>
<span id="cb4-437"><a href="#cb4-437"></a>    }</span>
<span id="cb4-438"><a href="#cb4-438"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">missing</span>(cellnote))</span>
<span id="cb4-439"><a href="#cb4-439"></a>        <span class="kw">text</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">row</span>(cellnote)), <span class="dt">y =</span> <span class="kw">c</span>(<span class="kw">col</span>(cellnote)), <span class="dt">labels =</span> <span class="kw">c</span>(cellnote),</span>
<span id="cb4-440"><a href="#cb4-440"></a>            <span class="dt">col =</span> notecol, <span class="dt">cex =</span> notecex)</span>
<span id="cb4-441"><a href="#cb4-441"></a>    <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(margins[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb4-442"><a href="#cb4-442"></a>    <span class="cf">if</span> (dendrogram <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;both&quot;</span>, <span class="st">&quot;row&quot;</span>)) {</span>
<span id="cb4-443"><a href="#cb4-443"></a>        <span class="kw">plot</span>(ddr, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">yaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">leaflab =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb4-444"><a href="#cb4-444"></a>    }</span>
<span id="cb4-445"><a href="#cb4-445"></a>    <span class="cf">else</span> <span class="kw">plot.new</span>()</span>
<span id="cb4-446"><a href="#cb4-446"></a>    <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(main)) <span class="dv">5</span> <span class="cf">else</span> <span class="dv">0</span>, margins[<span class="dv">2</span>]))</span>
<span id="cb4-447"><a href="#cb4-447"></a>    <span class="cf">if</span> (dendrogram <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;both&quot;</span>, <span class="st">&quot;column&quot;</span>)) {</span>
<span id="cb4-448"><a href="#cb4-448"></a>        <span class="kw">plot</span>(ddc, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">leaflab =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb4-449"><a href="#cb4-449"></a>    }</span>
<span id="cb4-450"><a href="#cb4-450"></a>    <span class="cf">else</span> <span class="kw">plot.new</span>()</span>
<span id="cb4-451"><a href="#cb4-451"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(main))</span>
<span id="cb4-452"><a href="#cb4-452"></a>        <span class="kw">title</span>(main, <span class="dt">cex.main =</span> <span class="fl">1.5</span> <span class="op">*</span><span class="st"> </span>op[[<span class="st">&quot;cex.main&quot;</span>]])</span>
<span id="cb4-453"><a href="#cb4-453"></a>    <span class="cf">if</span> (key) {</span>
<span id="cb4-454"><a href="#cb4-454"></a>        <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb4-455"><a href="#cb4-455"></a>        tmpbreaks &lt;-<span class="st"> </span>breaks</span>
<span id="cb4-456"><a href="#cb4-456"></a>        <span class="cf">if</span> (symkey) {</span>
<span id="cb4-457"><a href="#cb4-457"></a>            max.raw &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">abs</span>(<span class="kw">c</span>(x, breaks)), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-458"><a href="#cb4-458"></a>            min.raw &lt;-<span class="st"> </span><span class="op">-</span>max.raw</span>
<span id="cb4-459"><a href="#cb4-459"></a>            tmpbreaks[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">max</span>(<span class="kw">abs</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-460"><a href="#cb4-460"></a>            tmpbreaks[<span class="kw">length</span>(tmpbreaks)] &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">abs</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-461"><a href="#cb4-461"></a>        }</span>
<span id="cb4-462"><a href="#cb4-462"></a>        <span class="cf">else</span> {</span>
<span id="cb4-463"><a href="#cb4-463"></a>            min.raw &lt;-<span class="st"> </span><span class="kw">min</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-464"><a href="#cb4-464"></a>            max.raw &lt;-<span class="st"> </span><span class="kw">max</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-465"><a href="#cb4-465"></a>        }</span>
<span id="cb4-466"><a href="#cb4-466"></a></span>
<span id="cb4-467"><a href="#cb4-467"></a>        z &lt;-<span class="st"> </span><span class="kw">seq</span>(min.raw, max.raw, <span class="dt">length =</span> <span class="kw">length</span>(col))</span>
<span id="cb4-468"><a href="#cb4-468"></a>        <span class="kw">image</span>(<span class="dt">z =</span> <span class="kw">matrix</span>(z, <span class="dt">ncol =</span> <span class="dv">1</span>), <span class="dt">col =</span> col, <span class="dt">breaks =</span> tmpbreaks,</span>
<span id="cb4-469"><a href="#cb4-469"></a>            <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb4-470"><a href="#cb4-470"></a>        <span class="kw">par</span>(<span class="dt">usr =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb4-471"><a href="#cb4-471"></a>        lv &lt;-<span class="st"> </span><span class="kw">pretty</span>(breaks)</span>
<span id="cb4-472"><a href="#cb4-472"></a>        xv &lt;-<span class="st"> </span><span class="kw">scale01</span>(<span class="kw">as.numeric</span>(lv), min.raw, max.raw)</span>
<span id="cb4-473"><a href="#cb4-473"></a>        <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> xv, <span class="dt">labels =</span> lv)</span>
<span id="cb4-474"><a href="#cb4-474"></a>        <span class="cf">if</span> (scale <span class="op">==</span><span class="st"> &quot;row&quot;</span>)</span>
<span id="cb4-475"><a href="#cb4-475"></a>            <span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="st">&quot;Row Z-Score&quot;</span>, <span class="dt">line =</span> <span class="dv">2</span>)</span>
<span id="cb4-476"><a href="#cb4-476"></a>        <span class="cf">else</span> <span class="cf">if</span> (scale <span class="op">==</span><span class="st"> &quot;column&quot;</span>)</span>
<span id="cb4-477"><a href="#cb4-477"></a>            <span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="st">&quot;Column Z-Score&quot;</span>, <span class="dt">line =</span> <span class="dv">2</span>)</span>
<span id="cb4-478"><a href="#cb4-478"></a>        <span class="cf">else</span> <span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">1</span>, KeyValueName, <span class="dt">line =</span> <span class="dv">2</span>)</span>
<span id="cb4-479"><a href="#cb4-479"></a>        <span class="cf">if</span> (density.info <span class="op">==</span><span class="st"> &quot;density&quot;</span>) {</span>
<span id="cb4-480"><a href="#cb4-480"></a>            dens &lt;-<span class="st"> </span><span class="kw">density</span>(x, <span class="dt">adjust =</span> densadj, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-481"><a href="#cb4-481"></a>            omit &lt;-<span class="st"> </span>dens<span class="op">$</span>x <span class="op">&lt;</span><span class="st"> </span><span class="kw">min</span>(breaks) <span class="op">|</span><span class="st"> </span>dens<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="kw">max</span>(breaks)</span>
<span id="cb4-482"><a href="#cb4-482"></a>            dens<span class="op">$</span>x &lt;-<span class="st"> </span>dens<span class="op">$</span>x[<span class="op">-</span>omit]</span>
<span id="cb4-483"><a href="#cb4-483"></a>            dens<span class="op">$</span>y &lt;-<span class="st"> </span>dens<span class="op">$</span>y[<span class="op">-</span>omit]</span>
<span id="cb4-484"><a href="#cb4-484"></a>            dens<span class="op">$</span>x &lt;-<span class="st"> </span><span class="kw">scale01</span>(dens<span class="op">$</span>x, min.raw, max.raw)</span>
<span id="cb4-485"><a href="#cb4-485"></a>            <span class="kw">lines</span>(dens<span class="op">$</span>x, dens<span class="op">$</span>y<span class="op">/</span><span class="kw">max</span>(dens<span class="op">$</span>y) <span class="op">*</span><span class="st"> </span><span class="fl">0.95</span>, <span class="dt">col =</span> denscol,</span>
<span id="cb4-486"><a href="#cb4-486"></a>                <span class="dt">lwd =</span> <span class="dv">1</span>)</span>
<span id="cb4-487"><a href="#cb4-487"></a>            <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">pretty</span>(dens<span class="op">$</span>y)<span class="op">/</span><span class="kw">max</span>(dens<span class="op">$</span>y) <span class="op">*</span><span class="st"> </span><span class="fl">0.95</span>, <span class="kw">pretty</span>(dens<span class="op">$</span>y))</span>
<span id="cb4-488"><a href="#cb4-488"></a>            <span class="kw">title</span>(<span class="st">&quot;Color Key</span><span class="ch">\n</span><span class="st">and Density Plot&quot;</span>)</span>
<span id="cb4-489"><a href="#cb4-489"></a>            <span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-490"><a href="#cb4-490"></a>            <span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="st">&quot;Density&quot;</span>, <span class="dt">line =</span> <span class="dv">2</span>)</span>
<span id="cb4-491"><a href="#cb4-491"></a>        }</span>
<span id="cb4-492"><a href="#cb4-492"></a>        <span class="cf">else</span> <span class="cf">if</span> (density.info <span class="op">==</span><span class="st"> &quot;histogram&quot;</span>) {</span>
<span id="cb4-493"><a href="#cb4-493"></a>            h &lt;-<span class="st"> </span><span class="kw">hist</span>(x, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">breaks =</span> breaks)</span>
<span id="cb4-494"><a href="#cb4-494"></a>            hx &lt;-<span class="st"> </span><span class="kw">scale01</span>(breaks, min.raw, max.raw)</span>
<span id="cb4-495"><a href="#cb4-495"></a>            hy &lt;-<span class="st"> </span><span class="kw">c</span>(h<span class="op">$</span>counts, h<span class="op">$</span>counts[<span class="kw">length</span>(h<span class="op">$</span>counts)])</span>
<span id="cb4-496"><a href="#cb4-496"></a>            <span class="kw">lines</span>(hx, hy<span class="op">/</span><span class="kw">max</span>(hy) <span class="op">*</span><span class="st"> </span><span class="fl">0.95</span>, <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;s&quot;</span>,</span>
<span id="cb4-497"><a href="#cb4-497"></a>                <span class="dt">col =</span> denscol)</span>
<span id="cb4-498"><a href="#cb4-498"></a>            <span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">pretty</span>(hy)<span class="op">/</span><span class="kw">max</span>(hy) <span class="op">*</span><span class="st"> </span><span class="fl">0.95</span>, <span class="kw">pretty</span>(hy))</span>
<span id="cb4-499"><a href="#cb4-499"></a>            <span class="kw">title</span>(<span class="st">&quot;Color Key</span><span class="ch">\n</span><span class="st">and Histogram&quot;</span>)</span>
<span id="cb4-500"><a href="#cb4-500"></a>            <span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-501"><a href="#cb4-501"></a>            <span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="st">&quot;Count&quot;</span>, <span class="dt">line =</span> <span class="dv">2</span>)</span>
<span id="cb4-502"><a href="#cb4-502"></a>        }</span>
<span id="cb4-503"><a href="#cb4-503"></a>        <span class="cf">else</span> <span class="kw">title</span>(<span class="st">&quot;Color Key&quot;</span>)</span>
<span id="cb4-504"><a href="#cb4-504"></a>    }</span>
<span id="cb4-505"><a href="#cb4-505"></a>    <span class="cf">else</span> <span class="kw">plot.new</span>()</span>
<span id="cb4-506"><a href="#cb4-506"></a>    retval<span class="op">$</span>colorTable &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">low =</span> retval<span class="op">$</span>breaks[<span class="op">-</span><span class="kw">length</span>(retval<span class="op">$</span>breaks)],</span>
<span id="cb4-507"><a href="#cb4-507"></a>        <span class="dt">high =</span> retval<span class="op">$</span>breaks[<span class="op">-</span><span class="dv">1</span>], <span class="dt">color =</span> retval<span class="op">$</span>col)</span>
<span id="cb4-508"><a href="#cb4-508"></a>    <span class="kw">invisible</span>(retval)</span>
<span id="cb4-509"><a href="#cb4-509"></a>}</span>
<span id="cb4-510"><a href="#cb4-510"></a></span>
<span id="cb4-511"><a href="#cb4-511"></a>myclust &lt;-<span class="st"> </span><span class="cf">function</span>(c)</span>
<span id="cb4-512"><a href="#cb4-512"></a>{</span>
<span id="cb4-513"><a href="#cb4-513"></a>  <span class="kw">hclust</span>(c,<span class="dt">method=</span><span class="st">&quot;average&quot;</span>)</span>
<span id="cb4-514"><a href="#cb4-514"></a>}</span>
<span id="cb4-515"><a href="#cb4-515"></a></span>
<span id="cb4-516"><a href="#cb4-516"></a>na.dist &lt;-<span class="st"> </span><span class="cf">function</span>(x,<span class="dt">method=</span><span class="st">&quot;euclidian&quot;</span>,...) </span>
<span id="cb4-517"><a href="#cb4-517"></a>{</span>
<span id="cb4-518"><a href="#cb4-518"></a>  t.dist &lt;-<span class="st"> </span><span class="kw">dist</span>(x,...)</span>
<span id="cb4-519"><a href="#cb4-519"></a>  t.dist &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(t.dist)</span>
<span id="cb4-520"><a href="#cb4-520"></a>  t.limit &lt;-<span class="st"> </span><span class="fl">1.1</span><span class="op">*</span><span class="kw">max</span>(t.dist,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb4-521"><a href="#cb4-521"></a>  t.dist[<span class="kw">is.na</span>(t.dist)] &lt;-<span class="st"> </span>t.limit</span>
<span id="cb4-522"><a href="#cb4-522"></a>  t.dist &lt;-<span class="st"> </span><span class="kw">as.dist</span>(t.dist)</span>
<span id="cb4-523"><a href="#cb4-523"></a>  <span class="kw">return</span>(t.dist)</span>
<span id="cb4-524"><a href="#cb4-524"></a>}</span></code></pre></div>
<div id="figure-three" class="section level2">
<h2>Figure Three</h2>
<p>A “heatmap” of physico-chemical properties, in vitro TK parameters (Wetmore, et al., 2013), and TK parameters estimated from in vivo plasma concentration. Rows (chemicals) are clustered by Euclidean distance so that adjacent rows are more similar to each other. Each column (chemical properties) was scaled by the standard deviation of the column and the mean value was subtracted, such that a value of 0 corresponds to the mean and values of -1 or 1 correspond to values one standard deviation above or below the chemicals, respectively. In some cases, TK parameters could not be estimated (e.g., no oral data available for estimating Fbio and kgutabs). Fraction of the compound that is neutral, positively, or negatively ionized at pH 7.4 is indicated by “neutral ph74”, “positive ph74” and “negative ph74”. The color bar at the left-hand side indicates pharmaceuticals in grey and other chemicals in black.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>physprop.matrix &lt;-<span class="st"> </span>chem.invivo.PK.aggregate.data[,<span class="kw">c</span>(<span class="st">&quot;MW&quot;</span>,</span>
<span id="cb5-2"><a href="#cb5-2"></a>                                    <span class="st">&quot;logP&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>                                    <span class="st">&quot;WaterSol&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>                                    <span class="st">&quot;Neutral.pH74&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>                                    <span class="st">&quot;Positive.pH74&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>                                    <span class="st">&quot;Negative.pH74&quot;</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>                                    <span class="st">&quot;Clint&quot;</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>                                    <span class="st">&quot;Fup&quot;</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>                                    <span class="st">&quot;Vdist&quot;</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>                                    <span class="st">&quot;kelim&quot;</span>,</span>
<span id="cb5-11"><a href="#cb5-11"></a>                                    <span class="st">&quot;kgutabs&quot;</span>,</span>
<span id="cb5-12"><a href="#cb5-12"></a>                                    <span class="st">&quot;Fbio&quot;</span>)]</span>
<span id="cb5-13"><a href="#cb5-13"></a>rnames &lt;-<span class="st"> </span>chem.invivo.PK.aggregate.data<span class="op">$</span>Compound</span>
<span id="cb5-14"><a href="#cb5-14"></a>rnames[rnames<span class="op">==</span><span class="st">&quot;Bensulide&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Bensulide.Joint&quot;</span>,<span class="st">&quot;Bensulide.NHEERL&quot;</span>,<span class="st">&quot;Bensulide.RTI&quot;</span>)</span>
<span id="cb5-15"><a href="#cb5-15"></a>rnames[rnames<span class="op">==</span><span class="st">&quot;Propyzamide&quot;</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Propyzamide.Joint&quot;</span>,<span class="st">&quot;Propyzamide.NHEERL&quot;</span>,<span class="st">&quot;Propyzamide.RTI&quot;</span>)</span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="kw">rownames</span>(physprop.matrix) &lt;-<span class="st"> </span>rnames</span>
<span id="cb5-17"><a href="#cb5-17"></a></span>
<span id="cb5-18"><a href="#cb5-18"></a>row.side.cols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;Black&quot;</span>,<span class="kw">dim</span>(physprop.matrix)[<span class="dv">1</span>])</span>
<span id="cb5-19"><a href="#cb5-19"></a>row.side.cols[<span class="kw">sapply</span>(chem.invivo.PK.aggregate.data<span class="op">$</span>CAS,is.pharma)] &lt;-<span class="st"> &quot;Grey&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20"></a></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="kw">apply</span>(physprop.matrix,<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="kw">mean</span>(x,<span class="dt">na.rm=</span><span class="ot">TRUE</span>))</span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="cf">for</span> (this.col <span class="cf">in</span> <span class="kw">c</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">9</span><span class="op">:</span><span class="dv">11</span>),<span class="kw">c</span>(<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">12</span>))) physprop.matrix[,this.col] &lt;-<span class="st"> </span><span class="kw">log10</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">6</span><span class="op">+</span>physprop.matrix[,this.col])</span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a>physprop.matrix &lt;-<span class="st"> </span><span class="kw">apply</span>(physprop.matrix,<span class="dv">2</span>,<span class="cf">function</span>(x) (x<span class="op">-</span><span class="kw">mean</span>(x,<span class="dt">na.rm=</span><span class="ot">TRUE</span>))<span class="op">/</span><span class="kw">sd</span>(x,<span class="dt">na.rm=</span><span class="ot">TRUE</span>))</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>main_title=<span class="st">&quot;in vivo Toxicokinetic Parameters&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">heatmap.2</span>(physprop.matrix, </span>
<span id="cb6-3"><a href="#cb6-3"></a>          <span class="dt">hclustfun=</span>myclust,</span>
<span id="cb6-4"><a href="#cb6-4"></a>          <span class="dt">Colv=</span><span class="ot">FALSE</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>          <span class="dt">distfun=</span>na.dist, </span>
<span id="cb6-6"><a href="#cb6-6"></a>          <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, </span>
<span id="cb6-7"><a href="#cb6-7"></a>          <span class="dt">scale=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>          <span class="dt">trace=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>          <span class="dt">RowSideColors=</span>row.side.cols,</span>
<span id="cb6-10"><a href="#cb6-10"></a>          <span class="dt">col=</span><span class="kw">brewer.pal</span>(<span class="dv">11</span>,<span class="st">&quot;Spectral&quot;</span>),</span>
<span id="cb6-11"><a href="#cb6-11"></a>          <span class="dt">margins=</span><span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">10</span>)) </span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co"># The following has to be adjusted manually:</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="kw">rect</span>(<span class="fl">0.65</span>, <span class="fl">0.01</span>, <span class="fl">0.87</span>, <span class="fl">0.78</span>, <span class="dt">border=</span><span class="st">&quot;blue&quot;</span>) </span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="kw">text</span>(<span class="fl">0.75</span>,<span class="fl">0.81</span>,<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Estimated from &quot;</span>,<span class="kw">italic</span>(<span class="st">&quot;In Vivo&quot;</span>),<span class="st">&quot; Data&quot;</span>)))</span></code></pre></div>
<p>The original scripts used a data.table called FitData that contains a lot of stuff we don’t need to make these figures. We recreate it from the httk object chem.invivo.PK.aggregate.data:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Use joint analysis data from both labs:</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>FitData &lt;-<span class="st"> </span><span class="kw">subset</span>(chem.invivo.PK.aggregate.data,Compound<span class="op">!=</span><span class="st">&quot;Bensulide&quot;</span><span class="op">|</span>Source<span class="op">==</span><span class="st">&quot;Wambaugh et al. (2018), NHEERL/RTI&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>FitData &lt;-<span class="st"> </span><span class="kw">subset</span>(FitData,Compound<span class="op">!=</span><span class="st">&quot;Propyzamide&quot;</span><span class="op">|</span>Source<span class="op">==</span><span class="st">&quot;Wambaugh et al. (2018), NHEERL/RTI&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># Rename some columns to match original data files:</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>FitData<span class="op">$</span>Compound.abbrev &lt;-<span class="st"> </span>FitData<span class="op">$</span>Abbrev</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co"># Add a column indicating chemical type:</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>FitData<span class="op">$</span>Chemical &lt;-<span class="st"> &quot;Other&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>FitData[<span class="kw">sapply</span>(FitData<span class="op">$</span>CAS,is.pharma),<span class="st">&quot;Chemical&quot;</span>] &lt;-<span class="st"> &quot;Pharmaceutical&quot;</span></span></code></pre></div>
</div>
<div id="figure-four" class="section level2">
<h2>Figure Four</h2>
<p>Comparison of measured volumes of distribution (Vd) with predictions based upon in vitro data and in silico methods (Pearce, et al., 2017a; Schmitt, 2008). The solid line in each panel indicates the identity line (1:1, perfect predictions). Chemicals can be identified by their chemical abbreviation given in Table 1.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Get rid of chemicals with Fup &lt; LOD:</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>FitData.Fup &lt;-<span class="st"> </span><span class="kw">subset</span>(FitData,<span class="op">!</span>(CAS<span class="op">%in%</span><span class="kw">subset</span>(chem.physical_and_invitro.data,Human.Funbound.plasma<span class="op">==</span><span class="dv">0</span>)<span class="op">$</span>CAS))</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># Rename some columns to match original data files:</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>FitData.Fup<span class="op">$</span>SelectedVdist &lt;-<span class="st"> </span>FitData.Fup<span class="op">$</span>Vdist</span>
<span id="cb8-6"><a href="#cb8-6"></a>FitData.Fup<span class="op">$</span>SelectedVdist.sd &lt;-<span class="st"> </span>FitData.Fup<span class="op">$</span>Vdist.sd</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#Predict volume of Distribution</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>FitData.Fup<span class="op">$</span>Vdist<span class="fl">.1</span>comp.pred &lt;-<span class="st"> </span><span class="kw">sapply</span>(FitData.Fup<span class="op">$</span>CAS,</span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="cf">function</span>(x) <span class="kw">suppressWarnings</span>(<span class="kw">calc_vdist</span>(<span class="dt">chem.cas=</span>x,</span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="dt">species=</span><span class="st">&quot;Rat&quot;</span>,</span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="dt">default.to.human =</span> <span class="ot">TRUE</span>,</span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="dt">suppress.messages=</span><span class="ot">TRUE</span>)))</span>
<span id="cb8-14"><a href="#cb8-14"></a>FitData.Fup<span class="op">$</span>Vdist<span class="fl">.1</span>comp.pred.nocal &lt;-<span class="st"> </span><span class="kw">sapply</span>(FitData.Fup<span class="op">$</span>CAS,</span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="cf">function</span>(x) <span class="kw">suppressWarnings</span>(<span class="kw">calc_vdist</span>(<span class="dt">chem.cas=</span>x,</span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="dt">regression=</span><span class="ot">FALSE</span>,</span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="dt">species=</span><span class="st">&quot;Rat&quot;</span>,</span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="dt">default.to.human =</span> <span class="ot">TRUE</span>,</span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="dt">suppress.messages=</span><span class="ot">TRUE</span>)))</span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a>FigVdista.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(SelectedVdist)<span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)))</span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="kw">summary</span>(FigVdista.fit)</span>
<span id="cb8-23"><a href="#cb8-23"></a></span>
<span id="cb8-24"><a href="#cb8-24"></a>FigVdista.fit.weighted &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(SelectedVdist)<span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)),<span class="dt">weights=</span><span class="dv">1</span><span class="op">/</span>SelectedVdist.sd<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="kw">summary</span>(FigVdista.fit)</span>
<span id="cb8-26"><a href="#cb8-26"></a></span>
<span id="cb8-27"><a href="#cb8-27"></a>FigVdista.fit.pharm &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">!=</span><span class="st">&quot;Other&quot;</span><span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)))</span>
<span id="cb8-28"><a href="#cb8-28"></a><span class="kw">summary</span>(FigVdista.fit.pharm)</span>
<span id="cb8-29"><a href="#cb8-29"></a></span>
<span id="cb8-30"><a href="#cb8-30"></a>FigVdista.fit.other &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">==</span><span class="st">&quot;Other&quot;</span><span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)))</span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="kw">summary</span>(FigVdista.fit.other)</span>
<span id="cb8-32"><a href="#cb8-32"></a></span>
<span id="cb8-33"><a href="#cb8-33"></a><span class="kw">dim</span>(<span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(SelectedVdist.sd)<span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)))[<span class="dv">1</span>]</span>
<span id="cb8-34"><a href="#cb8-34"></a></span>
<span id="cb8-35"><a href="#cb8-35"></a>FigVdista &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred))) <span class="op">+</span></span>
<span id="cb8-36"><a href="#cb8-36"></a><span class="st">    </span><span class="kw">geom_segment</span>(<span class="dt">color=</span><span class="st">&quot;Grey&quot;</span>,<span class="kw">aes</span>(<span class="dt">x=</span>Vdist<span class="fl">.1</span>comp.pred,<span class="dt">y=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">-</span>SelectedVdist.sd),<span class="dt">xend=</span>Vdist<span class="fl">.1</span>comp.pred,<span class="dt">yend=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">+</span>SelectedVdist.sd)))<span class="op">+</span></span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;SelectedVdist&quot;</span>,</span>
<span id="cb8-38"><a href="#cb8-38"></a>                         <span class="dt">x=</span><span class="st">&quot;Vdist.1comp.pred&quot;</span>,</span>
<span id="cb8-39"><a href="#cb8-39"></a>                         <span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,</span>
<span id="cb8-40"><a href="#cb8-40"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb8-41"><a href="#cb8-41"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb8-42"><a href="#cb8-42"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb8-43"><a href="#cb8-43"></a><span class="st">   </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-44"><a href="#cb8-44"></a><span class="st">   </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-45"><a href="#cb8-45"></a><span class="st">   </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">1</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">1</span>, <span class="dt">label =</span> <span class="st">&quot;A&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>)  <span class="op">+</span></span>
<span id="cb8-46"><a href="#cb8-46"></a><span class="st">   </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated Volume of Distribution (L/kg)&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-47"><a href="#cb8-47"></a><span class="st">   </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Calibrated &quot;</span>,<span class="kw">italic</span>(<span class="st">&quot;In vitro&quot;</span>),<span class="st">&quot; predicted &quot;</span>,V[d],<span class="st">&quot; (L/kg)&quot;</span>))) <span class="op">+</span></span>
<span id="cb8-48"><a href="#cb8-48"></a><span class="st">   </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb8-49"><a href="#cb8-49"></a><span class="st">   </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb8-50"><a href="#cb8-50"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb8-51"><a href="#cb8-51"></a>   </span>
<span id="cb8-52"><a href="#cb8-52"></a>FigVdistb.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred.nocal),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)))</span>
<span id="cb8-53"><a href="#cb8-53"></a><span class="kw">summary</span>(FigVdistb.fit)</span>
<span id="cb8-54"><a href="#cb8-54"></a></span>
<span id="cb8-55"><a href="#cb8-55"></a>FigVdistb.fit.weighted &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred.nocal),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)),<span class="dt">weights=</span><span class="dv">1</span><span class="op">/</span>SelectedVdist.sd<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb8-56"><a href="#cb8-56"></a><span class="kw">summary</span>(FigVdistb.fit)</span>
<span id="cb8-57"><a href="#cb8-57"></a></span>
<span id="cb8-58"><a href="#cb8-58"></a>FigVdistb.fit.pharm &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred.nocal),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">!=</span><span class="st">&quot;Other&quot;</span><span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)))</span>
<span id="cb8-59"><a href="#cb8-59"></a><span class="kw">summary</span>(FigVdistb.fit.pharm)</span>
<span id="cb8-60"><a href="#cb8-60"></a></span>
<span id="cb8-61"><a href="#cb8-61"></a>FigVdistb.fit.other&lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">~</span><span class="kw">log</span>(Vdist<span class="fl">.1</span>comp.pred.nocal),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">==</span><span class="st">&quot;Other&quot;</span><span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred)))</span>
<span id="cb8-62"><a href="#cb8-62"></a><span class="kw">summary</span>(FigVdistb.fit.other)</span>
<span id="cb8-63"><a href="#cb8-63"></a></span>
<span id="cb8-64"><a href="#cb8-64"></a>FigVdistb &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred.nocal))) <span class="op">+</span></span>
<span id="cb8-65"><a href="#cb8-65"></a><span class="st">   </span><span class="kw">geom_segment</span>(<span class="dt">color=</span><span class="st">&quot;Grey&quot;</span>,<span class="kw">aes</span>(<span class="dt">x=</span>Vdist<span class="fl">.1</span>comp.pred.nocal,<span class="dt">y=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">-</span>SelectedVdist.sd),<span class="dt">xend=</span>Vdist<span class="fl">.1</span>comp.pred.nocal,<span class="dt">yend=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedVdist)<span class="op">+</span>SelectedVdist.sd)))<span class="op">+</span></span>
<span id="cb8-66"><a href="#cb8-66"></a><span class="st">   </span><span class="kw">geom_text</span>(<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;SelectedVdist&quot;</span>,</span>
<span id="cb8-67"><a href="#cb8-67"></a>                         <span class="dt">x=</span><span class="st">&quot;Vdist.1comp.pred.nocal&quot;</span>,</span>
<span id="cb8-68"><a href="#cb8-68"></a>                         <span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,</span>
<span id="cb8-69"><a href="#cb8-69"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb8-70"><a href="#cb8-70"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb8-71"><a href="#cb8-71"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb8-72"><a href="#cb8-72"></a><span class="st">   </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-73"><a href="#cb8-73"></a><span class="st">   </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-74"><a href="#cb8-74"></a><span class="st">   </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">1</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">1</span>, <span class="dt">label =</span> <span class="st">&quot;B&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb8-75"><a href="#cb8-75"></a><span class="st">   </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated Volume of Distribution (L/kg)&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb8-76"><a href="#cb8-76"></a><span class="st">   </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Original &quot;</span>,<span class="kw">italic</span>(<span class="st">&quot;In vitro&quot;</span>),<span class="st">&quot; predicted &quot;</span>,V[d],<span class="st">&quot; (L/kg)&quot;</span>))) <span class="op">+</span></span>
<span id="cb8-77"><a href="#cb8-77"></a><span class="st">   </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb8-78"><a href="#cb8-78"></a><span class="st">   </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb8-79"><a href="#cb8-79"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb8-80"><a href="#cb8-80"></a></span>
<span id="cb8-81"><a href="#cb8-81"></a></span>
<span id="cb8-82"><a href="#cb8-82"></a></span>
<span id="cb8-83"><a href="#cb8-83"></a><span class="co">#dev.new(width=10,height=6)</span></span>
<span id="cb8-84"><a href="#cb8-84"></a><span class="kw">multiplot</span>(FigVdista,FigVdistb,<span class="dt">cols=</span><span class="dv">2</span>,<span class="dt">widths=</span><span class="kw">c</span>(<span class="fl">1.75</span>,<span class="fl">1.75</span>))</span>
<span id="cb8-85"><a href="#cb8-85"></a></span>
<span id="cb8-86"><a href="#cb8-86"></a></span>
<span id="cb8-87"><a href="#cb8-87"></a>Fig4a.data &lt;-<span class="st"> </span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(SelectedVdist)<span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred))</span>
<span id="cb8-88"><a href="#cb8-88"></a>Fig4a.MSE &lt;-<span class="st"> </span><span class="kw">mean</span>((<span class="kw">log</span>(Fig4a.data<span class="op">$</span>Vdist<span class="fl">.1</span>comp.pred)<span class="op">-</span><span class="kw">log</span>(Fig4a.data<span class="op">$</span>SelectedVdist))<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb8-89"><a href="#cb8-89"></a></span>
<span id="cb8-90"><a href="#cb8-90"></a></span>
<span id="cb8-91"><a href="#cb8-91"></a>Fig4b.data &lt;-<span class="st"> </span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(SelectedVdist)<span class="op">&amp;!</span><span class="kw">is.na</span>(Vdist<span class="fl">.1</span>comp.pred.nocal))</span>
<span id="cb8-92"><a href="#cb8-92"></a>Fig4b.MSE &lt;-<span class="st"> </span><span class="kw">mean</span>((<span class="kw">log</span>(Fig4b.data<span class="op">$</span>Vdist<span class="fl">.1</span>comp.pred.nocal)<span class="op">-</span><span class="kw">log</span>(Fig4b.data<span class="op">$</span>SelectedVdist))<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="figure-five" class="section level2">
<h2>Figure Five</h2>
<p>Comparison of the TK clearance estimated from the in vivo data with the clearance predictions made using HTTK data. The more likely empirical TK model (either one or two-compartments, as in Figure 2) is selected for each chemical using the AIC (Akaike, 1974). A non-compartmental estimate of clearance is used if neither model is selected. Estimated standard deviation is indicated by a vertical line, and is often smaller than the plot point. The solid line indicates the identity line (1:1, perfect predictions), while the dotted and dashed lines indicate the linear regression (log-scale) trend-lines for pharmaceuticals and other chemicals, respectively. Chemicals can be identified by their chemical abbreviation given in Table 1.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">#FitData.Fup$CLtot.1comp &lt;- FitData.Fup$Vdist.1comp.meas*FitData.Fup$kelim.1comp.meas</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#FitData.Fup$CLtot.1comp.sd &lt;- (FitData.Fup$Vdist.1comp.meas.sd^2+FitData.Fup$kelim.1comp.meas.sd^2)^(1/2)</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#FitData.Fup[is.na(CLtot.1comp.sd)]$CLtot.1comp.sd &lt;- Inf</span></span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#FitData.Fup[is.na(SelectedCLtot.sd)]$SelectedClearance.sd &lt;- Inf</span></span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a>FitData.Fup<span class="op">$</span>SelectedCLtot &lt;-<span class="st"> </span>FitData.Fup<span class="op">$</span>Vdist<span class="op">*</span>FitData.Fup<span class="op">$</span>kelim </span>
<span id="cb9-8"><a href="#cb9-8"></a>FitData.Fup<span class="op">$</span>SelectedCLtot.sd &lt;-<span class="st"> </span>(FitData.Fup<span class="op">$</span>Vdist.sd<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="st">  </span>FitData.Fup<span class="op">$</span>kelim.sd<span class="op">^</span><span class="dv">2</span>)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb9-10"><a href="#cb9-10"></a>FitData.Fup<span class="op">$</span>CLtot<span class="fl">.1</span>comp.pred &lt;-<span class="st"> </span><span class="kw">sapply</span>(FitData.Fup<span class="op">$</span>CAS, </span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="cf">function</span>(x) <span class="kw">calc_total_clearance</span>(<span class="dt">chem.cas=</span>x,</span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="dt">species=</span><span class="st">&quot;Rat&quot;</span>,</span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="dt">default.to.human =</span> <span class="ot">TRUE</span>,</span>
<span id="cb9-14"><a href="#cb9-14"></a>  <span class="dt">suppress.messages=</span><span class="ot">TRUE</span>))</span>
<span id="cb9-15"><a href="#cb9-15"></a></span>
<span id="cb9-16"><a href="#cb9-16"></a>Fig.SelectedClearance.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">~</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(SelectedCLtot.sd)))</span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="kw">summary</span>(Fig.SelectedClearance.fit)</span>
<span id="cb9-18"><a href="#cb9-18"></a>Fig.SelectedClearance.fit.weighted &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">~</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="op">!</span><span class="kw">is.na</span>(SelectedCLtot.sd)),<span class="dt">weights=</span><span class="dv">1</span><span class="op">/</span>SelectedCLtot.sd<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="kw">summary</span>(Fig.SelectedClearance.fit.weighted)</span>
<span id="cb9-20"><a href="#cb9-20"></a>Fig.SelectedClearance.fit.pharma &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">~</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">!=</span><span class="st">&quot;Other&quot;</span><span class="op">&amp;!</span><span class="kw">is.na</span>(SelectedCLtot.sd)),<span class="dt">weights=</span><span class="dv">1</span><span class="op">/</span>SelectedCLtot.sd<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="kw">summary</span>(Fig.SelectedClearance.fit.pharma)</span>
<span id="cb9-22"><a href="#cb9-22"></a>Fig.SelectedClearance.fit.other&lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">~</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">==</span><span class="st">&quot;Other&quot;</span><span class="op">&amp;!</span><span class="kw">is.na</span>(SelectedCLtot.sd)),<span class="dt">weights=</span><span class="dv">1</span><span class="op">/</span>SelectedCLtot.sd<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="kw">summary</span>(Fig.SelectedClearance.fit.other)</span>
<span id="cb9-24"><a href="#cb9-24"></a>Fig.SelectedClearance.fit.pharma &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">~</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">!=</span><span class="st">&quot;Other&quot;</span>))</span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="kw">summary</span>(Fig.SelectedClearance.fit.pharma)</span>
<span id="cb9-26"><a href="#cb9-26"></a>Fig.SelectedClearance.fit.other&lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">~</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,Chemical<span class="op">==</span><span class="st">&quot;Other&quot;</span>))</span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="kw">summary</span>(Fig.SelectedClearance.fit.other)</span>
<span id="cb9-28"><a href="#cb9-28"></a></span>
<span id="cb9-29"><a href="#cb9-29"></a>Fig.SelectedClearance&lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>FitData.Fup,<span class="kw">aes</span>(<span class="dt">y=</span>SelectedCLtot,<span class="dt">x=</span>CLtot<span class="fl">.1</span>comp.pred)) <span class="op">+</span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="st">    </span><span class="kw">geom_segment</span>(<span class="dt">data=</span><span class="kw">subset</span>(FitData.Fup,<span class="kw">is.finite</span>(SelectedCLtot.sd)),<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>,<span class="kw">aes</span>(<span class="dt">x=</span>CLtot<span class="fl">.1</span>comp.pred,<span class="dt">y=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">-</span>SelectedCLtot.sd),<span class="dt">xend=</span>CLtot<span class="fl">.1</span>comp.pred,<span class="dt">yend=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedCLtot)<span class="op">+</span>SelectedCLtot.sd)))<span class="op">+</span></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;SelectedCLtot&quot;</span>,</span>
<span id="cb9-32"><a href="#cb9-32"></a>                         <span class="dt">x=</span><span class="st">&quot;CLtot.1comp.pred&quot;</span>,</span>
<span id="cb9-33"><a href="#cb9-33"></a>                         <span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,</span>
<span id="cb9-34"><a href="#cb9-34"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb9-35"><a href="#cb9-35"></a><span class="co">#    geom_point(data=twocomp.data,color=&quot;White&quot;,size=2,aes(shape=Source))+ </span></span>
<span id="cb9-36"><a href="#cb9-36"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">3</span>)) <span class="op">+</span></span>
<span id="cb9-37"><a href="#cb9-37"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">3</span>)) <span class="op">+</span></span>
<span id="cb9-38"><a href="#cb9-38"></a><span class="st">    </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-39"><a href="#cb9-39"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="st">     </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> CLtot<span class="fl">.1</span>comp.pred, <span class="dt">y =</span> <span class="kw">exp</span>(Fig.SelectedClearance.fit.pharma<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>Fig.SelectedClearance.fit.pharma<span class="op">$</span>coefficients[<span class="dv">2</span>]<span class="op">*</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred))), <span class="dt">colour =</span> <span class="st">&quot;darkturquoise&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dotted&quot;</span>, <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> CLtot<span class="fl">.1</span>comp.pred, <span class="dt">y =</span> <span class="kw">exp</span>(Fig.SelectedClearance.fit.other<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>Fig.SelectedClearance.fit.other<span class="op">$</span>coefficients[<span class="dv">2</span>]<span class="op">*</span><span class="kw">log</span>(CLtot<span class="fl">.1</span>comp.pred))), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span></span>
<span id="cb9-42"><a href="#cb9-42"></a><span class="st">     </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated clearance (mg/L/h)&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-43"><a href="#cb9-43"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vitro&quot;</span>),<span class="st">&quot; predicted clearance (mg/L/h)&quot;</span>))) <span class="op">+</span></span>
<span id="cb9-44"><a href="#cb9-44"></a><span class="st">    </span><span class="kw">theme_bw</span>()   <span class="op">+</span></span>
<span id="cb9-45"><a href="#cb9-45"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb9-46"><a href="#cb9-46"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> <span class="dv">10</span><span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span><span class="op">/</span><span class="dv">3</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">4</span>,<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(Fig.SelectedClearance.fit.pharma,<span class="dt">prefix=</span><span class="st">&quot;Pharmaceutical:&quot;</span>),<span class="dt">parse=</span><span class="ot">TRUE</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb9-47"><a href="#cb9-47"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> <span class="dv">10</span><span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span><span class="op">/</span><span class="dv">3</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">3</span><span class="op">*</span><span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>,<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(Fig.SelectedClearance.fit.other,<span class="dt">prefix=</span><span class="st">&quot;Other:&quot;</span>),<span class="dt">parse=</span><span class="ot">TRUE</span>)<span class="op">+</span></span>
<span id="cb9-48"><a href="#cb9-48"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="st">&quot;cm&quot;</span>))<span class="op">+</span></span>
<span id="cb9-49"><a href="#cb9-49"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb9-50"><a href="#cb9-50"></a></span>
<span id="cb9-51"><a href="#cb9-51"></a></span>
<span id="cb9-52"><a href="#cb9-52"></a><span class="co">#dev.new(width=6,height=6)</span></span>
<span id="cb9-53"><a href="#cb9-53"></a><span class="kw">print</span>(Fig.SelectedClearance)</span>
<span id="cb9-54"><a href="#cb9-54"></a></span>
<span id="cb9-55"><a href="#cb9-55"></a><span class="kw">paste</span>(<span class="st">&quot;with&quot;</span>,<span class="kw">with</span>(FitData.Fup,<span class="kw">sum</span>(SelectedCLtot<span class="op">&lt;</span>CLtot<span class="fl">.1</span>comp.pred,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)),<span class="st">&quot;chemicals over-estimated and&quot;</span>,<span class="kw">with</span>(FitData.Fup,<span class="kw">sum</span>(SelectedCLtot<span class="op">&gt;</span>CLtot<span class="fl">.1</span>comp.pred,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)),<span class="st">&quot;under-estimated&quot;</span>)</span></code></pre></div>
</div>
<div id="figure-six" class="section level2">
<h2>Figure Six</h2>
<p>Distribution of Gut Absorption Rate for Environmental and Pharmaceutical Chemicals.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>FitData<span class="op">$</span>Selectedkgutabs &lt;-<span class="st"> </span>FitData<span class="op">$</span>kgutabs</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># Cutoff from optimizer is 1000:</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>Figkgutabs &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">subset</span>(FitData,Selectedkgutabs<span class="op">&lt;</span><span class="dv">999</span>), <span class="kw">aes</span>(Selectedkgutabs, <span class="dt">fill =</span> Chemical)) <span class="op">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">     </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">     </span><span class="kw">ylab</span>(<span class="st">&quot;Number of Chemicals&quot;</span>)<span class="op">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">     </span><span class="kw">xlab</span>(<span class="st">&quot;Absorption Rate from Gut (1/h)&quot;</span>)<span class="op">+</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">     </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb10-10"><a href="#cb10-10"></a>     </span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#dev.new(width=6,height=6)</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="kw">print</span>(Figkgutabs) </span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="kw">mean</span>(<span class="kw">subset</span>(FitData,Selectedkgutabs<span class="op">&lt;</span><span class="dv">999</span>)<span class="op">$</span>Selectedkgutabs)</span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="kw">min</span>(<span class="kw">subset</span>(FitData,Selectedkgutabs<span class="op">&lt;</span><span class="dv">999</span>)<span class="op">$</span>Selectedkgutabs)</span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="kw">max</span>(<span class="kw">subset</span>(FitData,Selectedkgutabs<span class="op">&lt;</span><span class="dv">999</span>)<span class="op">$</span>Selectedkgutabs)</span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="kw">median</span>(<span class="kw">subset</span>(FitData,Selectedkgutabs<span class="op">&lt;</span><span class="dv">999</span>)<span class="op">$</span>Selectedkgutabs)</span></code></pre></div>
</div>
<div id="figure-seven" class="section level2">
<h2>Figure Seven</h2>
<p>In panel A, the observed fraction of oral dose absorbed from the gut is compared with predictions made using Gastroplus (Simulations Plus, 2017). The solid line indicates the identity line (1:1, perfect predictions). These fractions are distrusted from nearly zero to effectively 100% (Panel B). Chemicals can be identified by their chemical abbreviation given in Table 1.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>FitData<span class="op">$</span>SelectedFbio &lt;-<span class="st"> </span>FitData<span class="op">$</span>Fbio</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>FigFbioa &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>FitData) <span class="op">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;SelectedFbio&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>                         <span class="dt">x=</span><span class="st">&quot;Fbio.pred&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>                         <span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>,<span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>,<span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#    xlim(0, 1)+</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#    ylim(0, 1)+</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">.015</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">y =</span> <span class="fl">0.55</span>, <span class="dt">label =</span> <span class="st">&quot;A&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="st">    </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated Fraction Bioavailable&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In silico&quot;</span>),<span class="st">&quot; predicted &quot;</span>,F[bio]))) <span class="op">+</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#    scale_color_brewer(palette=&quot;Set2&quot;) + </span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="st">    </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb11-21"><a href="#cb11-21"></a></span>
<span id="cb11-22"><a href="#cb11-22"></a></span>
<span id="cb11-23"><a href="#cb11-23"></a>FigFbiob &lt;-<span class="st"> </span><span class="kw">ggplot</span>(FitData, <span class="kw">aes</span>(SelectedFbio, <span class="dt">fill =</span> Chemical)) <span class="op">+</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="st">    </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>,<span class="dv">3</span>)) <span class="op">+</span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">.001</span>, <span class="dt">y =</span> <span class="dv">18</span>, <span class="dt">label =</span> <span class="st">&quot;B&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Number of Chemicals&quot;</span>)<span class="op">+</span></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated Fraction Bioavailable&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb11-29"><a href="#cb11-29"></a><span class="st">    </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">fill=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb11-32"><a href="#cb11-32"></a></span>
<span id="cb11-33"><a href="#cb11-33"></a>     </span>
<span id="cb11-34"><a href="#cb11-34"></a></span>
<span id="cb11-35"><a href="#cb11-35"></a><span class="co">#dev.new(width=10,height=6)</span></span>
<span id="cb11-36"><a href="#cb11-36"></a><span class="kw">multiplot</span>(FigFbioa,FigFbiob,<span class="dt">cols=</span><span class="dv">2</span>,<span class="dt">widths=</span><span class="kw">c</span>(<span class="fl">1.75</span>,<span class="fl">1.75</span>))</span>
<span id="cb11-37"><a href="#cb11-37"></a></span>
<span id="cb11-38"><a href="#cb11-38"></a><span class="kw">summary</span>(<span class="kw">lm</span>(<span class="kw">log</span>(SelectedFbio)<span class="op">~</span><span class="kw">log</span>(Fbio.pred),<span class="dt">data=</span>FitData))</span>
<span id="cb11-39"><a href="#cb11-39"></a></span>
<span id="cb11-40"><a href="#cb11-40"></a><span class="kw">paste</span>(<span class="st">&quot;Fbio ranged from&quot;</span>,<span class="kw">signif</span>(<span class="kw">min</span>(FitData[FitData<span class="op">$</span>Chemical<span class="op">==</span><span class="st">&quot;Pharmaceutical&quot;</span>,<span class="st">&quot;SelectedFbio&quot;</span>],<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dv">2</span>),<span class="st">&quot;to&quot;</span>,<span class="kw">signif</span>(<span class="kw">max</span>(FitData[FitData<span class="op">$</span>Chemical<span class="op">==</span><span class="st">&quot;Pharmaceutical&quot;</span>,<span class="st">&quot;SelectedFbio&quot;</span>],<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dv">2</span>),<span class="st">&quot;for pharmaceutical compounds, but was observed to be as low as&quot;</span>, <span class="kw">signif</span>(<span class="kw">min</span>(FitData[FitData<span class="op">$</span>Chemical<span class="op">==</span><span class="st">&quot;Other&quot;</span>,<span class="st">&quot;SelectedFbio&quot;</span>],<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dv">3</span>),<span class="st">&quot;for other compounds.&quot;</span>)</span>
<span id="cb11-41"><a href="#cb11-41"></a></span>
<span id="cb11-42"><a href="#cb11-42"></a><span class="kw">min</span>(FitData<span class="op">$</span>SelectedFbio,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)                       </span></code></pre></div>
</div>
<div id="figure-eight" class="section level2">
<h2>Figure Eight</h2>
<p>Rat in vivo data were collected for diverse environmental chemicals to evaluate the predictive ability of HTTK, especially with respect to predicting steady-state serum concentration (Css). Chemicals can be identified by their chemical abbreviation given in Table 1. The abbreviations are centered at the measured and predicted values. The solid line indicates the identity line (1:1, perfect predictions). In panel A, the one-compartment model is parameterized with a predicted volume of distribution and clearance, based upon in vitro measured parameters. Fbio is assumed to be 100%. In panel B, the in vivo measured Fbio is used to reduce the amount of the oral dose absorbed in the one-compartment model, to illustrate the improvement possible if Fbio could be predicted accurately.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>FitData<span class="op">$</span>SelectedFbio &lt;-<span class="st"> </span>FitData<span class="op">$</span>Fbio</span>
<span id="cb12-2"><a href="#cb12-2"></a>FitData<span class="op">$</span>SelectedCss &lt;-<span class="st"> </span>FitData<span class="op">$</span>Css</span>
<span id="cb12-3"><a href="#cb12-3"></a>FitData<span class="op">$</span>SelectedCss.sd &lt;-<span class="st"> </span>FitData<span class="op">$</span>Css.sd</span>
<span id="cb12-4"><a href="#cb12-4"></a>FitData<span class="op">$</span>Css<span class="fl">.1</span>comp.pred &lt;-<span class="st"> </span><span class="kw">sapply</span>(FitData<span class="op">$</span>CAS,</span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="cf">function</span>(x) <span class="kw">calc_analytic_css</span>(<span class="dt">chem.cas=</span>x,</span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="dt">species=</span><span class="st">&quot;Rat&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="dt">model=</span><span class="st">&quot;3compartmentss&quot;</span>,</span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="dt">suppress.messages=</span><span class="ot">TRUE</span>,</span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="dt">parameterize.args =</span> <span class="kw">list</span>(</span>
<span id="cb12-10"><a href="#cb12-10"></a>    <span class="dt">default.to.human=</span><span class="ot">TRUE</span>,</span>
<span id="cb12-11"><a href="#cb12-11"></a>    <span class="dt">adjusted.Funbound.plasma=</span><span class="ot">TRUE</span>,</span>
<span id="cb12-12"><a href="#cb12-12"></a>    <span class="dt">regression=</span><span class="ot">TRUE</span>,</span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="dt">minimum.Funbound.plasma=</span><span class="fl">1e-4</span>)))</span>
<span id="cb12-14"><a href="#cb12-14"></a></span>
<span id="cb12-15"><a href="#cb12-15"></a>Fig<span class="fl">.1</span>compCss.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css<span class="fl">.1</span>comp.pred),<span class="dt">data=</span>FitData,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb12-16"><a href="#cb12-16"></a>Fig<span class="fl">.1</span>compCss.fit.weighted &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css<span class="fl">.1</span>comp.pred),<span class="dt">data=</span>FitData,<span class="dt">na.rm=</span><span class="ot">TRUE</span>,<span class="dt">weights=</span><span class="dv">1</span><span class="op">/</span>SelectedCss.sd<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb12-17"><a href="#cb12-17"></a>Fig<span class="fl">.1</span>compCss.fit.pharma &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData,Chemical<span class="op">!=</span><span class="st">&quot;Other&quot;</span>),<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb12-18"><a href="#cb12-18"></a>Fig<span class="fl">.1</span>compCss.fit.other &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css<span class="fl">.1</span>comp.pred),<span class="dt">data=</span><span class="kw">subset</span>(FitData,Chemical<span class="op">==</span><span class="st">&quot;Other&quot;</span>),<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb12-19"><a href="#cb12-19"></a></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="kw">summary</span>(Fig<span class="fl">.1</span>compCss.fit)</span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="kw">summary</span>(Fig<span class="fl">.1</span>compCss.fit.pharma)</span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="kw">summary</span>(Fig<span class="fl">.1</span>compCss.fit.other)</span>
<span id="cb12-23"><a href="#cb12-23"></a></span>
<span id="cb12-24"><a href="#cb12-24"></a></span>
<span id="cb12-25"><a href="#cb12-25"></a>textx &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">3</span></span>
<span id="cb12-26"><a href="#cb12-26"></a>texty &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">1</span></span>
<span id="cb12-27"><a href="#cb12-27"></a></span>
<span id="cb12-28"><a href="#cb12-28"></a>Fig.Cssa &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>FitData) <span class="op">+</span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>,<span class="kw">aes</span>(<span class="dt">x=</span>Css<span class="fl">.1</span>comp.pred,<span class="dt">y=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedCss)<span class="op">-</span>SelectedCss.sd),<span class="dt">xend=</span>Css<span class="fl">.1</span>comp.pred,<span class="dt">yend=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedCss)<span class="op">+</span>SelectedCss.sd)))<span class="op">+</span></span>
<span id="cb12-30"><a href="#cb12-30"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">size=</span><span class="dv">4</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;SelectedCss&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Css.1comp.pred&quot;</span>,<span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,<span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb12-31"><a href="#cb12-31"></a><span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span>, <span class="dv">110</span>)) <span class="op">+</span></span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span>, <span class="dv">110</span>)) <span class="op">+</span></span>
<span id="cb12-33"><a href="#cb12-33"></a><span class="st">  </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-34"><a href="#cb12-34"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated &quot;</span>,C[ss],<span class="st">&quot; (mg/L)&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-36"><a href="#cb12-36"></a><span class="st"> </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vitro&quot;</span>),<span class="st">&quot; predicted &quot;</span>,C[ss],<span class="st">&quot; (mg/L)&quot;</span>))) <span class="op">+</span></span>
<span id="cb12-37"><a href="#cb12-37"></a><span class="co">#  scale_color_brewer(palette=&quot;Set2&quot;) + </span></span>
<span id="cb12-38"><a href="#cb12-38"></a><span class="st">  </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb12-39"><a href="#cb12-39"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb12-40"><a href="#cb12-40"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> textx<span class="op">/</span><span class="dv">15</span>, <span class="dt">y =</span> <span class="dv">5</span><span class="op">*</span>texty, <span class="dt">label =</span> <span class="st">&quot;A&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb12-41"><a href="#cb12-41"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> textx, <span class="dt">y =</span> texty,<span class="dt">size=</span><span class="dv">6</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(Fig<span class="fl">.1</span>compCss.fit),<span class="dt">parse=</span><span class="ot">TRUE</span>)<span class="op">+</span></span>
<span id="cb12-42"><a href="#cb12-42"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>)) </span>
<span id="cb12-43"><a href="#cb12-43"></a><span class="co">#  annotate(&quot;text&quot;,x = textx/3, y = texty/3,size=4, label = lm_R2(Fig.1compCss.fit.weighted,prefix=&quot;Weighted:&quot;),parse=TRUE) </span></span>
<span id="cb12-44"><a href="#cb12-44"></a><span class="co">#  annotate(&quot;text&quot;,x = textx, y = texty,size=4, label = lm_R2(Fig.1compCss.fit.pharma,prefix=&quot;Pharmaceutical:&quot;),parse=TRUE)</span></span>
<span id="cb12-45"><a href="#cb12-45"></a><span class="co">#  annotate(&quot;text&quot;,x = textx, y = texty/3,size=4, label = lm_R2(Fig.1compCss.fit.other,prefix=&quot;Other:&quot;),parse=TRUE) </span></span>
<span id="cb12-46"><a href="#cb12-46"></a></span>
<span id="cb12-47"><a href="#cb12-47"></a>FitData<span class="op">$</span>Css.Bio &lt;-<span class="st"> </span>FitData<span class="op">$</span>Css<span class="fl">.1</span>comp.pred<span class="op">*</span>FitData<span class="op">$</span>SelectedFbio</span>
<span id="cb12-48"><a href="#cb12-48"></a>Fig<span class="fl">.1</span>compCssb.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css.Bio),<span class="dt">data=</span>FitData,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb12-49"><a href="#cb12-49"></a>Fig<span class="fl">.1</span>compCssb.fit.weighted &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css.Bio),<span class="dt">data=</span>FitData,<span class="dt">na.rm=</span><span class="ot">TRUE</span>,<span class="dt">weights=</span><span class="dv">1</span><span class="op">/</span>SelectedCss.sd<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb12-50"><a href="#cb12-50"></a>Fig<span class="fl">.1</span>compCssb.fit.pharma &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css.Bio),<span class="dt">data=</span><span class="kw">subset</span>(FitData,Chemical<span class="op">!=</span><span class="st">&quot;Other&quot;</span>),<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb12-51"><a href="#cb12-51"></a>Fig<span class="fl">.1</span>compCssb.fit.other &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(SelectedCss)<span class="op">~</span><span class="kw">log</span>(Css.Bio),<span class="dt">data=</span><span class="kw">subset</span>(FitData,Chemical<span class="op">==</span><span class="st">&quot;Other&quot;</span>),<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb12-52"><a href="#cb12-52"></a></span>
<span id="cb12-53"><a href="#cb12-53"></a>Fig.Cssb &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>FitData) <span class="op">+</span></span>
<span id="cb12-54"><a href="#cb12-54"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>,<span class="kw">aes</span>(<span class="dt">x=</span>Css.Bio,<span class="dt">y=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedCss)<span class="op">-</span>SelectedCss.sd),<span class="dt">xend=</span>Css.Bio,<span class="dt">yend=</span><span class="kw">exp</span>(<span class="kw">log</span>(SelectedCss)<span class="op">+</span>SelectedCss.sd)))<span class="op">+</span></span>
<span id="cb12-55"><a href="#cb12-55"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">size=</span><span class="dv">4</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;SelectedCss&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Css.Bio&quot;</span>,<span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,<span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb12-56"><a href="#cb12-56"></a><span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span>, <span class="dv">110</span>)) <span class="op">+</span></span>
<span id="cb12-57"><a href="#cb12-57"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">5</span><span class="op">*</span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span>, <span class="dv">110</span>)) <span class="op">+</span></span>
<span id="cb12-58"><a href="#cb12-58"></a><span class="st">  </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-59"><a href="#cb12-59"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-60"><a href="#cb12-60"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated &quot;</span>,C[ss],<span class="st">&quot; (mg/L)&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-61"><a href="#cb12-61"></a><span class="st"> </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vitro&quot;</span>),<span class="st">&quot; predicted &quot;</span>,C[ss],<span class="st">&quot; (mg/L) Using Measured &quot;</span>, F[bio]))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb12-62"><a href="#cb12-62"></a><span class="st"> </span><span class="co"># scale_color_brewer(palette=&quot;Set2&quot;) + </span></span>
<span id="cb12-63"><a href="#cb12-63"></a><span class="st">  </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb12-64"><a href="#cb12-64"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb12-65"><a href="#cb12-65"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> textx<span class="op">/</span><span class="dv">15</span>, <span class="dt">y =</span> <span class="dv">5</span><span class="op">*</span>texty, <span class="dt">label =</span> <span class="st">&quot;B&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb12-66"><a href="#cb12-66"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> textx, <span class="dt">y =</span> texty,<span class="dt">size=</span><span class="dv">6</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(Fig<span class="fl">.1</span>compCssb.fit),<span class="dt">parse=</span><span class="ot">TRUE</span>)<span class="op">+</span></span>
<span id="cb12-67"><a href="#cb12-67"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>)) </span>
<span id="cb12-68"><a href="#cb12-68"></a></span>
<span id="cb12-69"><a href="#cb12-69"></a><span class="co">#dev.new(width=10,height=6)</span></span>
<span id="cb12-70"><a href="#cb12-70"></a><span class="kw">multiplot</span>(Fig.Cssa,Fig.Cssb,<span class="dt">cols=</span><span class="dv">2</span>,<span class="dt">widths=</span><span class="kw">c</span>(<span class="fl">1.75</span>,<span class="fl">1.75</span>))</span></code></pre></div>
</div>
<div id="figure-nine" class="section level2">
<h2>Figure Nine</h2>
<p>Evaluation of Wambaugh et al. (2015) classification scheme for predicting errors made when using HTTK data to predict in vivo steady state plasma concentration (Css). Chemicals were placed into categories, depending upon the size of the error. “On the Order” represented the best case, where errors were within 3.2 times over or under the true value. Some chemicals were determined to be problematic due to limitations in the HTTK methods (e.g., plasma protein binding estimation) or failure to come to steady state. Wherever the chemical names overlap the vertical, gray bands, the observed errors are consistent with predicted error. Chemicals can be identified by their chemical abbreviation given in Table 1.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>FitData<span class="op">$</span>TriageCat &lt;-<span class="st"> </span>FitData<span class="op">$</span>Triage.Call</span>
<span id="cb13-2"><a href="#cb13-2"></a>FitData<span class="op">$</span>CssResidual &lt;-<span class="st"> </span><span class="kw">log10</span>(FitData<span class="op">$</span>Css<span class="fl">.1</span>comp.pred<span class="op">/</span>FitData<span class="op">$</span>Css)</span>
<span id="cb13-3"><a href="#cb13-3"></a>FitData[FitData<span class="op">$</span>TriageCat<span class="op">%in%</span><span class="kw">c</span>(<span class="st">&quot;Does Not Reach Steady State&quot;</span>,<span class="st">&quot;Plasma Binding Assay Failed&quot;</span>),<span class="st">&quot;TriageCat&quot;</span>]&lt;-<span class="st">&quot;Problem&quot;</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>FitData<span class="op">$</span>TriageCat &lt;-<span class="st"> </span><span class="kw">factor</span>(FitData<span class="op">$</span>TriageCat,<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;&gt;10x Underestimated&quot;</span>,<span class="st">&quot;&gt;3.2x Underestimated&quot;</span>,<span class="st">&quot;On the Order&quot;</span>,<span class="st">&quot;&gt;3.2x Overestimated&quot;</span>,<span class="st">&quot;&gt;10x Overestimated&quot;</span>,<span class="st">&quot;Problem&quot;</span>))</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a>Fig.Triage &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="kw">subset</span>(FitData,<span class="op">!</span><span class="kw">is.na</span>(TriageCat)<span class="op">&amp;</span><span class="kw">is.finite</span>(CssResidual))) <span class="op">+</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">size=</span><span class="dv">4</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;CssResidual&quot;</span>, <span class="dt">x=</span><span class="st">&quot;TriageCat&quot;</span>,<span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,<span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="st">&quot;&gt;10x Underestimated&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">y =</span> <span class="kw">log10</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">10</span>), <span class="dt">xend =</span> <span class="kw">factor</span>(<span class="st">&quot;&gt;10x Underestimated&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">yend =</span> <span class="kw">log10</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">30</span>)), <span class="dt">size=</span><span class="dv">3</span>,<span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="st"> </span><span class="co"># geom_segment(aes(x = factor(&quot;&gt;3.2x Underestimated&quot;,levels=levels(FitData$TriageCat)), y = log10(1/10), xend = factor(&quot;&gt;3.2x Underestimated&quot;,levels=levels(FitData$TriageCat)), yend = log10(1/3.2)), size=3,colour = &quot;grey&quot;) +</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="st">&quot;On the Order&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">y =</span> <span class="kw">log10</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.2</span>), <span class="dt">xend =</span> <span class="kw">factor</span>(<span class="st">&quot;On the Order&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">yend =</span> <span class="kw">log10</span>(<span class="fl">3.2</span>)), <span class="dt">size=</span><span class="dv">3</span>,<span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="st">&quot;&gt;3.2x Overestimated&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">y =</span> <span class="kw">log10</span>(<span class="fl">3.2</span>), <span class="dt">xend =</span> <span class="kw">factor</span>(<span class="st">&quot;&gt;3.2x Overestimated&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">yend =</span> <span class="kw">log10</span>(<span class="dv">10</span>)), <span class="dt">size=</span><span class="dv">3</span>,<span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="st">&quot;&gt;10x Overestimated&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">y =</span> <span class="kw">log10</span>(<span class="dv">10</span>), <span class="dt">xend =</span> <span class="kw">factor</span>(<span class="st">&quot;&gt;10x Overestimated&quot;</span>,<span class="dt">levels=</span><span class="kw">levels</span>(FitData<span class="op">$</span>TriageCat)), <span class="dt">yend =</span> <span class="kw">log10</span>(<span class="dv">500</span>)), <span class="dt">size=</span><span class="dv">3</span>,<span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>)<span class="op">+</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="kw">log10</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">10</span>),<span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="kw">log10</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.2</span>),<span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="kw">log10</span>(<span class="fl">3.2</span>),<span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="kw">log10</span>(<span class="dv">10</span>),<span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">size=</span><span class="dv">4</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;CssResidual&quot;</span>, <span class="dt">x=</span><span class="st">&quot;TriageCat&quot;</span>,<span class="dt">label=</span><span class="st">&quot;Compound.abbrev&quot;</span>,<span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Actual error in &quot;</span>,C[ss],<span class="st">&quot; prediction&quot;</span>)),<span class="dt">breaks=</span><span class="kw">c</span>(<span class="kw">log10</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">10</span>),<span class="kw">log10</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.2</span>),<span class="dv">0</span>,<span class="kw">log10</span>(<span class="fl">3.2</span>),<span class="dv">1</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;&gt;10x Under&quot;</span>,<span class="st">&quot;&gt;3.2x Under&quot;</span>,<span class="st">&quot;On the Order&quot;</span>,<span class="st">&quot;&gt;3.2x Over&quot;</span>,<span class="st">&quot;&gt;10x Over&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Predicted Error&quot;</span>) <span class="op">+</span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="st">  </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))<span class="op">+</span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb13-26"><a href="#cb13-26"></a></span>
<span id="cb13-27"><a href="#cb13-27"></a></span>
<span id="cb13-28"><a href="#cb13-28"></a><span class="co">#dev.new(width=6,height=6)</span></span>
<span id="cb13-29"><a href="#cb13-29"></a><span class="kw">print</span>(Fig.Triage)</span></code></pre></div>
</div>
<div id="figure-ten" class="section level2">
<h2>Figure Ten</h2>
<p>Evaluation of the ability of in vitro HTTK data, coupled with a one-compartment model, to predict important TK statistics like the maximum plasma concentration (Cmax) for characterizing tissue exposure. A single point is plotted for each combination of chemical, dose amount, and dose route, either intravenous (iv) or per oral (po). In panel A, the one-compartment model is parameterized with a predicted volume of distribution and clearance, based upon in vitro measured parameters. Fbio is assumed to be 100%. In panel B, the in vivo measured Fbio is used to reduce the amount of the oral dose absorbed in the one-compartment model, to illustrate the improvement possible if Fbio could be predicted accurately.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>PKstats &lt;-<span class="st"> </span>chem.invivo.PK.summary.data</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co"># Add a column indicating chemical type:</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>PKstats<span class="op">$</span>Chemical &lt;-<span class="st"> &quot;Other&quot;</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>PKstats[<span class="kw">sapply</span>(PKstats<span class="op">$</span>CAS,is.pharma),<span class="st">&quot;Chemical&quot;</span>] &lt;-<span class="st"> &quot;Pharmaceutical&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a>FigCmaxa.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(Cmax)<span class="op">~</span><span class="kw">log</span>(Cmax.pred),<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(Cmax)))</span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="kw">summary</span>(FigCmaxa.fit)</span>
<span id="cb14-8"><a href="#cb14-8"></a>                    </span>
<span id="cb14-9"><a href="#cb14-9"></a>FigCmaxa &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(Cmax))) <span class="op">+</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;Cmax&quot;</span>,</span>
<span id="cb14-11"><a href="#cb14-11"></a>                         <span class="dt">x=</span><span class="st">&quot;Cmax.pred&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12"></a>                         <span class="dt">shape=</span><span class="st">&quot;Route&quot;</span>,</span>
<span id="cb14-13"><a href="#cb14-13"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="st">    </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated &quot;</span>,C[max]))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vitro&quot;</span>),<span class="st">&quot; predicted &quot;</span>,C[max]))) <span class="op">+</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#    scale_color_brewer(palette=&quot;Set2&quot;) +</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">300</span>, <span class="dt">label =</span> <span class="st">&quot;A&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(FigCmaxa.fit),<span class="dt">parse=</span><span class="ot">TRUE</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="st">    </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb14-26"><a href="#cb14-26"></a></span>
<span id="cb14-27"><a href="#cb14-27"></a></span>
<span id="cb14-28"><a href="#cb14-28"></a></span>
<span id="cb14-29"><a href="#cb14-29"></a></span>
<span id="cb14-30"><a href="#cb14-30"></a>FigCmaxb.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(Cmax)<span class="op">~</span><span class="kw">log</span>(Cmax.pred.Fbio),<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(Cmax)))</span>
<span id="cb14-31"><a href="#cb14-31"></a><span class="kw">summary</span>(FigCmaxb.fit)</span>
<span id="cb14-32"><a href="#cb14-32"></a></span>
<span id="cb14-33"><a href="#cb14-33"></a>FigCmaxb &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(Cmax))) <span class="op">+</span></span>
<span id="cb14-34"><a href="#cb14-34"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;Cmax&quot;</span>,</span>
<span id="cb14-35"><a href="#cb14-35"></a>                         <span class="dt">x=</span><span class="st">&quot;Cmax.pred.Fbio&quot;</span>,</span>
<span id="cb14-36"><a href="#cb14-36"></a>                         <span class="dt">shape=</span><span class="st">&quot;Route&quot;</span>,</span>
<span id="cb14-37"><a href="#cb14-37"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb14-38"><a href="#cb14-38"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb14-39"><a href="#cb14-39"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">4</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb14-40"><a href="#cb14-40"></a><span class="st">    </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-41"><a href="#cb14-41"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-42"><a href="#cb14-42"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated &quot;</span>,C[max]))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Predicted &quot;</span>, C[max], <span class="st">&quot; Using Measured &quot;</span>, F[bio ]))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-44"><a href="#cb14-44"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">300</span>, <span class="dt">label =</span> <span class="st">&quot;B&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb14-45"><a href="#cb14-45"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(FigCmaxb.fit),<span class="dt">parse=</span><span class="ot">TRUE</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-46"><a href="#cb14-46"></a><span class="co">#    scale_color_brewer(palette=&quot;Set2&quot;) + </span></span>
<span id="cb14-47"><a href="#cb14-47"></a><span class="st">    </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb14-48"><a href="#cb14-48"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb14-49"><a href="#cb14-49"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb14-50"><a href="#cb14-50"></a></span>
<span id="cb14-51"><a href="#cb14-51"></a><span class="co">#dev.new(width=10,height=6)</span></span>
<span id="cb14-52"><a href="#cb14-52"></a><span class="kw">multiplot</span>(FigCmaxa,FigCmaxb,<span class="dt">cols=</span><span class="dv">2</span>,<span class="dt">widths=</span><span class="kw">c</span>(<span class="fl">1.75</span>,<span class="fl">1.75</span>))</span></code></pre></div>
</div>
<div id="figure-eleven" class="section level2">
<h2>Figure Eleven</h2>
<p>Evaluation of predictions for the time integrated plasma concentration (i.e., area under the curve or AUC). A single point is plotted for each combination of chemical, dose amount, and dose route, either intravenous (iv) or per oral (po). In panel A, the one-compartment model is parameterized with a predicted volume of distribution and clearance, based upon in vitro measured parameters. Fbio is assumed to be 100%. In panel B, the in vivo measured Fbio is used to reduce the amount of the oral dose absorbed in the one-compartment model, to illustrate the improvement possible if Fbio could be predicted accurately. The solid line in each panel indicates the identity line (1:1, perfect predictions).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>FigAUCa.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(AUC)<span class="op">~</span><span class="kw">log</span>(AUC.pred),<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(<span class="kw">log</span>(AUC))))</span>
<span id="cb15-2"><a href="#cb15-2"></a>FigAUCb.fit &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(AUC)<span class="op">~</span><span class="kw">log</span>(AUC.pred.Fbio),<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(<span class="kw">log</span>(AUC))))</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="kw">summary</span>(FigAUCa.fit)</span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="kw">summary</span>(FigAUCb.fit)</span>
<span id="cb15-5"><a href="#cb15-5"></a>                                              </span>
<span id="cb15-6"><a href="#cb15-6"></a>FigAUCa &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(<span class="kw">log</span>(AUC)))) <span class="op">+</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;AUC&quot;</span>,</span>
<span id="cb15-8"><a href="#cb15-8"></a>                         <span class="dt">x=</span><span class="st">&quot;AUC.pred&quot;</span>,</span>
<span id="cb15-9"><a href="#cb15-9"></a>                         <span class="dt">shape=</span><span class="st">&quot;Route&quot;</span>,</span>
<span id="cb15-10"><a href="#cb15-10"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="st">    </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated AUC (mg*h/L)&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vitro&quot;</span>),<span class="st">&quot; predicted Area under the Curve (AUC, mg*h/L)&quot;</span>))) <span class="op">+</span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">3000</span>, <span class="dt">label =</span> <span class="st">&quot;A&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(FigAUCa.fit),<span class="dt">parse=</span><span class="ot">TRUE</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="st">    </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb15-22"><a href="#cb15-22"></a></span>
<span id="cb15-23"><a href="#cb15-23"></a></span>
<span id="cb15-24"><a href="#cb15-24"></a>FigAUCb &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span><span class="kw">subset</span>(PKstats,<span class="kw">is.finite</span>(<span class="kw">log</span>(AUC)))) <span class="op">+</span></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>,<span class="kw">aes_string</span>(<span class="dt">y=</span><span class="st">&quot;AUC&quot;</span>,</span>
<span id="cb15-26"><a href="#cb15-26"></a>                         <span class="dt">x=</span><span class="st">&quot;AUC.pred.Fbio&quot;</span>,</span>
<span id="cb15-27"><a href="#cb15-27"></a>                         <span class="dt">shape=</span><span class="st">&quot;Route&quot;</span>,</span>
<span id="cb15-28"><a href="#cb15-28"></a>                         <span class="dt">color=</span><span class="st">&quot;Chemical&quot;</span>))<span class="op">+</span><span class="st"> </span></span>
<span id="cb15-29"><a href="#cb15-29"></a><span class="st">   </span><span class="kw">scale_y_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="st">   </span><span class="kw">scale_x_log10</span>(<span class="dt">label=</span>scientific_<span class="dv">10</span>,<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">3</span>, <span class="dv">10</span><span class="op">^</span><span class="dv">4</span>)) <span class="op">+</span></span>
<span id="cb15-31"><a href="#cb15-31"></a><span class="st">    </span><span class="kw">annotation_logticks</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-32"><a href="#cb15-32"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-33"><a href="#cb15-33"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;In vivo&quot;</span>),<span class="st">&quot; estimated AUC (mg*h/L)&quot;</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-34"><a href="#cb15-34"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Predicted AUC (mg*h/L) Using Measured &quot;</span>, F[bio]))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-35"><a href="#cb15-35"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">3000</span>, <span class="dt">label =</span> <span class="st">&quot;B&quot;</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb15-36"><a href="#cb15-36"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,<span class="dt">x =</span> <span class="dv">3</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span><span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">2</span>, <span class="dt">label =</span> <span class="kw">lm_R2</span>(FigAUCb.fit),<span class="dt">parse=</span><span class="ot">TRUE</span>,<span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb15-37"><a href="#cb15-37"></a><span class="st">    </span><span class="kw">theme_bw</span>()  <span class="op">+</span></span>
<span id="cb15-38"><a href="#cb15-38"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>)<span class="op">+</span></span>
<span id="cb15-39"><a href="#cb15-39"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">shape=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>),<span class="dt">color=</span><span class="kw">guide_legend</span>(<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>))</span>
<span id="cb15-40"><a href="#cb15-40"></a></span>
<span id="cb15-41"><a href="#cb15-41"></a><span class="co">#dev.new(width=10,height=6)</span></span>
<span id="cb15-42"><a href="#cb15-42"></a><span class="kw">multiplot</span>(FigAUCa,FigAUCb,<span class="dt">cols=</span><span class="dv">2</span>,<span class="dt">widths=</span><span class="kw">c</span>(<span class="fl">1.75</span>,<span class="fl">1.75</span>))</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
